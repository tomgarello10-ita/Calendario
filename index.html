<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="apple-mobile-web-app-title" content="Calendario"/>
<title>Calendario</title>

<link rel="manifest" href="manifest.json"/>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",sans-serif;
  background:#f2f2f7;
  -webkit-tap-highlight-color:transparent;
}
.app{
  max-width:430px;
  margin:0 auto;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
.header{
  padding-top:env(safe-area-inset-top);
  background:white;
  border-bottom:1px solid #e5e5ea;
}
.header-inner{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 16px;
}
.month-title{
  font-weight:600;
  font-size:17px;
}
.nav-btn{
  font-size:24px;
  background:none;
  border:none;
  color:#007aff;
}
.calendar{
  padding:12px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}
.day{
  background:white;
  border-radius:10px;
  text-align:center;
  padding:10px 0;
  font-size:14px;
  position:relative;
}
.day.selected{
  background:#007aff;
  color:white;
}
.dot{
  width:6px;
  height:6px;
  background:#ff3b30;
  border-radius:50%;
  position:absolute;
  bottom:4px;
  left:50%;
  transform:translateX(-50%);
}
.event-list{
  background:white;
  margin-top:12px;
  border-radius:14px;
  padding:14px;
}
.event-item{
  padding:10px 0;
  border-bottom:1px solid #e5e5ea;
}
.event-item:last-child{
  border:none;
}
.add-btn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#007aff;
  color:white;
  border:none;
  border-radius:50%;
  width:56px;
  height:56px;
  font-size:30px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.3);
  display:flex;
  align-items:flex-end;
}
.sheet{
  background:white;
  width:100%;
  border-radius:20px 20px 0 0;
  padding:20px;
}
.category{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px;
  background:#f2f2f7;
  border-radius:14px;
  margin-bottom:12px;
}
.category-title{
  font-weight:500;
}
.back{
  color:#007aff;
  margin-bottom:10px;
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

const {useState,useEffect,useRef}=React;

const MONTHS=[
"Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno",
"Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"
];

function getDays(year,month){
  const first=new Date(year,month,1).getDay();
  const total=new Date(year,month+1,0).getDate();
  let arr=[];
  for(let i=0;i<first;i++) arr.push(null);
  for(let i=1;i<=total;i++) arr.push(i);
  return arr;
}function App(){

  const today=new Date();
  const [year,setYear]=useState(today.getFullYear());
  const [month,setMonth]=useState(today.getMonth());
  const [selectedDay,setSelectedDay]=useState(null);

  const [events,setEvents]=useState({});
  const [showModal,setShowModal]=useState(false);
  const [step,setStep]=useState("main");
  const [currentCategory,setCurrentCategory]=useState(null);

  const touchStartX=useRef(null);
  const touchStartY=useRef(null);
  const isSwiping=useRef(false);

  const changeMonth=(offset)=>{
    const d=new Date(year,month+offset,1);
    setYear(d.getFullYear());
    setMonth(d.getMonth());
  };

  const onTouchStart=e=>{
    touchStartX.current=e.touches[0].clientX;
    touchStartY.current=e.touches[0].clientY;
    isSwiping.current=false;
  };

  const onTouchMove=e=>{
    const dx=e.touches[0].clientX-touchStartX.current;
    const dy=e.touches[0].clientY-touchStartY.current;
    if(Math.abs(dx)>30 && Math.abs(dx)>Math.abs(dy)){
      isSwiping.current=true;
    }
  };

  const onTouchEnd=e=>{
    const dx=e.changedTouches[0].clientX-touchStartX.current;
    if(isSwiping.current){
      if(dx>50) changeMonth(-1);
      if(dx<-50) changeMonth(1);
    }
  };

  const addEvent=(text)=>{
    const key=`${year}-${month}-${selectedDay}`;
    setEvents(prev=>{
      const list=prev[key]||[];
      return {...prev,[key]:[...list,text]};
    });
    setShowModal(false);
    setStep("main");
  };

  const days=getDays(year,month);
  const key=`${year}-${month}-${selectedDay}`;
  const dayEvents=events[key]||[];

  return(
    <div className="app">

      <div className="header">
        <div className="header-inner">
          <button className="nav-btn" onClick={()=>changeMonth(-1)}>‚Äπ</button>
          <div className="month-title">{MONTHS[month]} {year}</div>
          <button className="nav-btn" onClick={()=>changeMonth(1)}>‚Ä∫</button>
        </div>
      </div>

      <div className="calendar"
        onTouchStart={onTouchStart}
        onTouchMove={onTouchMove}
        onTouchEnd={onTouchEnd}
      >
        <div className="grid">
          {days.map((d,i)=>{
            const hasEvent=events[`${year}-${month}-${d}`];
            return(
              <div
                key={i}
                className={`day ${selectedDay===d?"selected":""}`}
                onClick={()=>!isSwiping.current && d && setSelectedDay(d)}
              >
                {d}
                {hasEvent && <div className="dot"></div>}
              </div>
            )
          })}
        </div>

        {selectedDay && (
          <div className="event-list">
            <div style={{fontWeight:"600",marginBottom:"8px"}}>
              Eventi del {selectedDay} {MONTHS[month]}
            </div>

            {dayEvents.length===0 && <div>Nessun evento</div>}

            {dayEvents.map((ev,i)=>(
              <div key={i} className="event-item">{ev}</div>
            ))}
          </div>
        )}
      </div>

      {selectedDay && (
        <button className="add-btn" onClick={()=>setShowModal(true)}>+</button>
      )}

      {showModal && (
        <div className="modal">
          <div className="sheet">

            {step==="main" && (
              <>
                <div className="category" onClick={()=>{setCurrentCategory("Verifica");setStep("detail")}}>
                  <div className="category-title">üìò Verifica</div>
                </div>
                <div className="category" onClick={()=>{setCurrentCategory("Compleanno");setStep("detail")}}>
                  <div className="category-title">üéÇ Compleanno</div>
                </div>
                <div className="category" onClick={()=>{setCurrentCategory("Commissione");setStep("detail")}}>
                  <div className="category-title">üõí Commissione</div>
                </div>
                <div className="category" onClick={()=>{setCurrentCategory("Appuntamento");setStep("detail")}}>
                  <div className="category-title">üè• Appuntamento</div>
                </div>
                <div className="category" onClick={()=>{setCurrentCategory("Da fare");setStep("detail")}}>
                  <div className="category-title">‚úÖ Da fare</div>
                </div>
              </>
            )}

            {step==="detail" && (
              <>
                <div className="back" onClick={()=>setStep("main")}>‚Äπ Indietro</div>
                <div style={{marginBottom:"10px",fontWeight:"600"}}>
                  {currentCategory}
                </div>
                <input
                  placeholder="Scrivi qui..."
                  style={{
                    width:"100%",
                    padding:"10px",
                    borderRadius:"10px",
                    border:"1px solid #e5e5ea",
                    marginBottom:"12px"
                  }}
                  onKeyDown={e=>{
                    if(e.key==="Enter" && e.target.value){
                      addEvent(`${currentCategory}: ${e.target.value}`);
                    }
                  }}
                />
              </>
            )}

            <div style={{textAlign:"right"}}>
              <button onClick={()=>setShowModal(false)}>Chiudi</button>
            </div>

          </div>
        </div>
      )}

    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>
</body>
</html>
