<!DOCTYPE html>

<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#ffffff"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="Il Mio Anno"/>
  <title>Il Mio Anno</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
    html,body{height:100%;overflow:hidden}
    body{background:#fff;font-family:-apple-system,'SF Pro Text','Helvetica Neue',sans-serif;overscroll-behavior:none}
    ::-webkit-scrollbar{display:none}
    input,textarea{-webkit-appearance:none;user-select:text;font-family:inherit}
    *{user-select:none}
    @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .tap:active{opacity:0.45}
  </style>
</head>
<body>
<div id="root" style="height:100%"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback} = React;

const MONTHS=[â€œGennaioâ€,â€œFebbraioâ€,â€œMarzoâ€,â€œAprileâ€,â€œMaggioâ€,â€œGiugnoâ€,â€œLuglioâ€,â€œAgostoâ€,â€œSettembreâ€,â€œOttobreâ€,â€œNovembreâ€,â€œDicembreâ€];
const MONTHS_S=[â€œGenâ€,â€œFebâ€,â€œMarâ€,â€œAprâ€,â€œMagâ€,â€œGiuâ€,â€œLugâ€,â€œAgoâ€,â€œSetâ€,â€œOttâ€,â€œNovâ€,â€œDicâ€];
const DAYS=[â€œLâ€,â€œMâ€,â€œMâ€,â€œGâ€,â€œVâ€,â€œSâ€,â€œDâ€];

const CATS=[
{id:â€œverificaâ€,    label:â€œVerificaâ€,    emoji:â€œğŸ“â€,color:â€#FF3B30â€,bg:â€œrgba(255,59,48,0.1)â€},
{id:â€œcompleannoâ€,  label:â€œCompleannoâ€,  emoji:â€œğŸ‚â€,color:â€#FF9500â€,bg:â€œrgba(255,149,0,0.1)â€},
{id:â€œcommissioneâ€, label:â€œCommissioneâ€, emoji:â€œğŸ›’â€,color:â€#34C759â€,bg:â€œrgba(52,199,89,0.1)â€},
{id:â€œappuntamentoâ€,label:â€œAppuntamentoâ€,emoji:â€œğŸ¥â€,color:â€#007AFFâ€,bg:â€œrgba(0,122,255,0.1)â€},
{id:â€œtodoâ€,        label:â€œDa fareâ€,     emoji:â€œâœ…â€,color:â€#AF52DEâ€,bg:â€œrgba(175,82,222,0.1)â€},
];
const getCat=id=>CATS.find(c=>c.id===id)||CATS[4];

const MATERIE=[
{id:â€œmatematicaâ€,label:â€œMatematicaâ€,emoji:â€œğŸ“â€},{id:â€œitalianoâ€,label:â€œItalianoâ€,emoji:â€œğŸ“–â€},
{id:â€œstoriaâ€,label:â€œStoriaâ€,emoji:â€œğŸ›ï¸â€},{id:â€œscienzeâ€,label:â€œScienzeâ€,emoji:â€œğŸ”¬â€},
{id:â€œingleseâ€,label:â€œIngleseâ€,emoji:â€œğŸ‡¬ğŸ‡§â€},{id:â€œfisicaâ€,label:â€œFisicaâ€,emoji:â€œâš¡â€},
{id:â€œchimicaâ€,label:â€œChimicaâ€,emoji:â€œğŸ§ªâ€},{id:â€œgeografiaâ€,label:â€œGeografiaâ€,emoji:â€œğŸŒâ€},
{id:â€œarteâ€,label:â€œArteâ€,emoji:â€œğŸ¨â€},{id:â€œmusicaâ€,label:â€œMusicaâ€,emoji:â€œğŸµâ€},
{id:â€œfilosofiaâ€,label:â€œFilosofiaâ€,emoji:â€œğŸ¤”â€},{id:â€œinformaticaâ€,label:â€œInformaticaâ€,emoji:â€œğŸ’»â€},
{id:â€œed_fisicaâ€,label:â€œEd. Fisicaâ€,emoji:â€œâš½â€},{id:â€œlatinoâ€,label:â€œLatinoâ€,emoji:â€œğŸ“œâ€},
{id:â€œaltraâ€,label:â€œAltraâ€,emoji:â€œğŸ“šâ€},
];
const SUGG={
commissione:[{label:â€œFare la spesaâ€,emoji:â€œğŸ›’â€},{label:â€œFarmaciaâ€,emoji:â€œğŸ’Šâ€},{label:â€œPagare bolletteâ€,emoji:â€œğŸ’°â€},{label:â€œPostaâ€,emoji:â€œğŸ“®â€},{label:â€œRitirare paccoâ€,emoji:â€œğŸ“¦â€},{label:â€œBanca / ATMâ€,emoji:â€œğŸ¦â€},{label:â€œMeccanicoâ€,emoji:â€œğŸ”§â€},{label:â€œShoppingâ€,emoji:â€œğŸ›ï¸â€},{label:â€œVeterinarioâ€,emoji:â€œğŸ¾â€},{label:â€œReferti mediciâ€,emoji:â€œğŸ“‹â€},{label:â€œAltroâ€,emoji:â€œâœï¸â€}],
appuntamento:[{label:â€œMedicoâ€,emoji:â€œğŸ‘¨â€âš•ï¸â€},{label:â€œDentistaâ€,emoji:â€œğŸ¦·â€},{label:â€œSpecialistaâ€,emoji:â€œğŸ¥â€},{label:â€œFisioterapiaâ€,emoji:â€œğŸ’†â€},{label:â€œAnalisi sangueâ€,emoji:â€œğŸ©¸â€},{label:â€œOculistaâ€,emoji:â€œğŸ‘ï¸â€},{label:â€œColloquio scuolaâ€,emoji:â€œğŸ«â€},{label:â€œRiunioneâ€,emoji:â€œğŸ’¼â€},{label:â€œColloquio lavoroâ€,emoji:â€œğŸ‘”â€},{label:â€œParrucchiereâ€,emoji:â€œâœ‚ï¸â€},{label:â€œAltroâ€,emoji:â€œâœï¸â€}],
todo:[{label:â€œStudiareâ€,emoji:â€œğŸ“šâ€},{label:â€œFare sportâ€,emoji:â€œğŸƒâ€},{label:â€œChiamare qualcunoâ€,emoji:â€œğŸ“â€},{label:â€œPulire casaâ€,emoji:â€œğŸ§¹â€},{label:â€œLavanderiaâ€,emoji:â€œğŸ‘•â€},{label:â€œCucinareâ€,emoji:â€œğŸ³â€},{label:â€œLeggereâ€,emoji:â€œğŸ“–â€},{label:â€œOrganizzareâ€,emoji:â€œğŸ—‚ï¸â€},{label:â€œMeditareâ€,emoji:â€œğŸ§˜â€},{label:â€œProgettoâ€,emoji:â€œğŸ’¡â€},{label:â€œAltroâ€,emoji:â€œâœï¸â€}],
};
const TIPI=[â€œScrittoâ€,â€œOraleâ€,â€œTestâ€,â€œCompitoâ€,â€œPresentazioneâ€];

const today=new Date();
const todayStr=fmt(today.getFullYear(),today.getMonth(),today.getDate());
function fmt(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`}
function daysIn(y,m){return new Date(y,m+1,0).getDate()}
function firstDay(y,m){const d=new Date(y,m,1).getDay();return d===0?6:d-1}
function addMonths(y,m,delta){let nm=m+delta,ny=y;while(nm>11){nm-=12;ny++;}while(nm<0){nm+=12;nyâ€“;}return{year:ny,month:nm};}
function daysBetween(s){const[y,m,d]=s.split(â€-â€).map(Number);return Math.round((new Date(y,m-1,d)-new Date(today.getFullYear(),today.getMonth(),today.getDate()))/(864e5))}

const SK=â€œilmioanno_v5â€;
function loadEv(){try{return JSON.parse(localStorage.getItem(SK))||{}}catch{return{}}}
function saveEv(e){try{localStorage.setItem(SK,JSON.stringify(e))}catch{}}

function getAlerts(ev){
const a=[];
Object.entries(ev).forEach(([day,evs])=>evs.forEach(e=>{
const d=daysBetween(day),c=getCat(e.category);
if(e.category===â€œverificaâ€){
if(d===15)a.push({e,day,d,msg:â€œInizia a ripassare!â€,u:â€œlowâ€,icon:â€œğŸ“–â€});
else if(d===10)a.push({e,day,d,msg:â€œRipassa con costanzaâ€,u:â€œmediumâ€,icon:â€œğŸ“šâ€});
else if(d===5)a.push({e,day,d,msg:â€œUltimi giorni!â€,u:â€œhighâ€,icon:â€œâš¡â€});
else if(d===2)a.push({e,day,d,msg:â€œDopodomani! Rivedi tuttoâ€,u:â€œhighâ€,icon:â€œğŸ”¥â€});
else if(d===1)a.push({e,day,d,msg:â€œDOMANI! Sei pronto?â€,u:â€œurgentâ€,icon:â€œğŸš¨â€});
else if(d===0)a.push({e,day,d,msg:â€œOGGI! In bocca al lupo! ğŸ€â€,u:â€œurgentâ€,icon:â€œğŸ¯â€});
} else if(e.category===â€œcompleannoâ€){
if(d===7)a.push({e,day,d,msg:â€œTra una settimana!â€,u:â€œlowâ€,icon:â€œğŸâ€});
else if(d===3)a.push({e,day,d,msg:â€œTra 3 giorni!â€,u:â€œmediumâ€,icon:â€œğŸ‚â€});
else if(d===1)a.push({e,day,d,msg:â€œDOMANI! Non dimenticare!â€,u:â€œhighâ€,icon:â€œğŸ‰â€});
else if(d===0)a.push({e,day,d,msg:â€œOGGI Ã¨ il suo compleanno! ğŸ¥³â€,u:â€œurgentâ€,icon:â€œğŸ‚â€});
} else {
if(d===3)a.push({e,day,d,msg:â€œTra 3 giorniâ€,u:â€œlowâ€,icon:c.emoji});
else if(d===1)a.push({e,day,d,msg:â€œDOMANI! Non dimenticareâ€,u:â€œhighâ€,icon:â€œâ°â€});
else if(d===0)a.push({e,day,d,msg:â€œOGGI!â€,u:â€œurgentâ€,icon:â€œğŸ””â€});
}
}));
const o={urgent:0,high:1,medium:2,low:3};
return a.sort((a,b)=>o[a.u]-o[b.u]);
}

// â”€â”€ SWIPEABLE CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Renders 3 months side by side, user drags to reveal prev/next
function SwipeCalendar({year,month,events,alerts,onDay,onMonthChange}){
const containerRef=useRef(null);
const startX=useRef(null);
const startY=useRef(null);
const currentX=useRef(0);
const isDragging=useRef(false);
const [offset,setOffset]=useState(0); // px offset while dragging
const [animating,setAnimating]=useState(false);
const W=useRef(0);

useEffect(()=>{
if(containerRef.current) W.current=containerRef.current.offsetWidth;
},[]);

const onTouchStart=e=>{
if(animating)return;
startX.current=e.touches[0].clientX;
startY.current=e.touches[0].clientY;
isDragging.current=false;
};
const onTouchMove=e=>{
if(startX.current===null)return;
const dx=e.touches[0].clientX-startX.current;
const dy=Math.abs(e.touches[0].clientY-startY.current);
if(!isDragging.current){
if(dy>Math.abs(dx))return; // vertical scroll, ignore
isDragging.current=true;
}
e.preventDefault();
currentX.current=dx;
setOffset(dx);
};
const onTouchEnd=e=>{
if(!isDragging.current){startX.current=null;return;}
const dx=currentX.current;
const threshold=W.current*0.3;
setAnimating(true);
if(dx<-threshold){
// snap to next month
setOffset(-W.current);
setTimeout(()=>{
const n=addMonths(year,month,1);
onMonthChange(n.year,n.month);
setOffset(0);
setAnimating(false);
},280);
} else if(dx>threshold){
// snap to prev month
setOffset(W.current);
setTimeout(()=>{
const n=addMonths(year,month,-1);
onMonthChange(n.year,n.month);
setOffset(0);
setAnimating(false);
},280);
} else {
// snap back
setOffset(0);
setTimeout(()=>setAnimating(false),280);
}
startX.current=null;
isDragging.current=false;
currentX.current=0;
};

const prev=addMonths(year,month,-1);
const next=addMonths(year,month,1);

return (
<div ref={containerRef}
style={{overflow:â€œhiddenâ€,position:â€œrelativeâ€,touchAction:â€œpan-yâ€}}
onTouchStart={onTouchStart}
onTouchMove={onTouchMove}
onTouchEnd={onTouchEnd}>
<div style={{
display:â€œflexâ€,
width:â€œ300%â€,
transform:`translateX(calc(-33.333% + ${offset}px))`,
transition:animating?â€œtransform 0.28s cubic-bezier(0.25,0.46,0.45,0.94)â€:â€œnoneâ€,
willChange:â€œtransformâ€,
}}>
<div style={{width:â€œ33.333%â€,flexShrink:0}}>
<MonthGrid year={prev.year} month={prev.month} events={events} alerts={alerts} onDay={onDay}/>
</div>
<div style={{width:â€œ33.333%â€,flexShrink:0}}>
<MonthGrid year={year} month={month} events={events} alerts={alerts} onDay={onDay}/>
</div>
<div style={{width:â€œ33.333%â€,flexShrink:0}}>
<MonthGrid year={next.year} month={next.month} events={events} alerts={alerts} onDay={onDay}/>
</div>
</div>
</div>
);
}

function MonthGrid({year,month,events,alerts,onDay}){
const fd=firstDay(year,month),td=daysIn(year,month);
const getDay=k=>events[k]||[];
return (
<div style={{padding:â€œ0 4pxâ€}}>
<div style={{display:â€œgridâ€,gridTemplateColumns:â€œrepeat(7,1fr)â€,marginBottom:â€œ4pxâ€}}>
{DAYS.map((d,i)=>(
<div key={i} style={{textAlign:â€œcenterâ€,fontSize:â€œ11pxâ€,fontWeight:â€œ600â€,
color:i>=5?â€#FF9500â€:â€œrgba(60,60,67,0.38)â€,padding:â€œ3px 0â€,letterSpacing:â€œ0.01emâ€}}>{d}</div>
))}
</div>
<div style={{display:â€œgridâ€,gridTemplateColumns:â€œrepeat(7,1fr)â€,rowGap:â€œ1pxâ€}}>
{Array.from({length:fd},(*,i)=><div key={`e${i}`}/>)}
{Array.from({length:td},(*,i)=>{
const day=i+1,key=fmt(year,month,day);
const evs=getDay(key),isT=key===todayStr,isW=(fd+i)%7>=5;
const isPast=key<todayStr;
const cats=[â€¦new Set(evs.map(e=>e.category))].slice(0,3);
const hasAl=alerts.some(a=>a.day===key);
return (
<div key={key} onClick={()=>onDay(key)}
style={{aspectRatio:â€œ1â€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,alignItems:â€œcenterâ€,
justifyContent:â€œcenterâ€,cursor:â€œpointerâ€,position:â€œrelativeâ€,
borderRadius:â€œ50%â€,transition:â€œbackground 0.1s easeâ€,WebkitTapHighlightColor:â€œtransparentâ€}}
onTouchStart={e=>!isT&&(e.currentTarget.style.background=â€œrgba(60,60,67,0.07)â€)}
onTouchEnd={e=>{e.currentTarget.style.background=â€œtransparentâ€;onDay(key);}}>
{/* Today: red circle */}
{isT&&<div style={{position:â€œabsoluteâ€,inset:â€œ8%â€,borderRadius:â€œ50%â€,background:â€#FF3B30â€}}/>}
{/* Alert ring */}
{hasAl&&!isT&&<div style={{position:â€œabsoluteâ€,inset:â€œ8%â€,borderRadius:â€œ50%â€,border:â€œ1.5px solid #FF3B30â€}}/>}
<div style={{fontSize:â€œ15pxâ€,fontWeight:isT?â€œ600â€:â€œ400â€,
color:isT?â€#fffâ€:isPast?â€œrgba(60,60,67,0.22)â€:isW?â€#FF9500â€:â€#1C1C1Eâ€,
position:â€œrelativeâ€,zIndex:1,lineHeight:1,
marginBottom:cats.length?â€œ3pxâ€:â€œ0â€}}>{day}</div>
{cats.length>0&&(
<div style={{display:â€œflexâ€,gap:â€œ2pxâ€,position:â€œrelativeâ€,zIndex:1}}>
{cats.map(cid=>(
<div key={cid} style={{width:â€œ4pxâ€,height:â€œ4pxâ€,borderRadius:â€œ50%â€,
background:isT?â€œrgba(255,255,255,0.85)â€:getCat(cid).color}}/>
))}
</div>
)}
</div>
);
})}
</div>
</div>
);
}

// â”€â”€ ALERTS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AlertsPanel({alerts,onClose,onGo}){
const [vis,setVis]=useState(false);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const US={urgent:{color:â€#FF3B30â€,label:â€œURGENTEâ€},high:{color:â€#FF9500â€,label:â€œIMPORTANTEâ€},medium:{color:â€#FFCC00â€,label:â€œATTENZIONEâ€},low:{color:â€#007AFFâ€,label:â€œPROMEMORIAâ€}};
return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:500,background:vis?â€œrgba(0,0,0,0.4)â€:â€œrgba(0,0,0,0)â€,transition:â€œbackground 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:â€#1C1C1Eâ€,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ88vhâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€,paddingBottom:â€œenv(safe-area-inset-bottom,24px)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:â€œrgba(255,255,255,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ16px 20px 14pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€}}>
<div>
<div style={{fontSize:â€œ22pxâ€,fontWeight:â€œ700â€,color:â€#fffâ€,letterSpacing:â€-0.5pxâ€}}>Promemoria</div>
<div style={{fontSize:â€œ13pxâ€,color:â€œrgba(255,255,255,0.35)â€,marginTop:â€œ2pxâ€}}>{alerts.length} avvisi</div>
</div>
<button onClick={close} style={{background:â€œrgba(255,255,255,0.1)â€,border:â€œnoneâ€,borderRadius:â€œ50%â€,width:â€œ30pxâ€,height:â€œ30pxâ€,cursor:â€œpointerâ€,color:â€œrgba(255,255,255,0.5)â€,fontSize:â€œ16pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€}}>Ã—</button>
</div>
<div style={{overflowY:â€œautoâ€,flex:1,padding:â€œ0 16px 16pxâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,gap:â€œ8pxâ€}}>
{alerts.map((a,i)=>{
const s=US[a.u],[,am,ad]=a.day.split(â€-â€);
const dl=a.d===0?â€œOggiâ€:a.d===1?â€œDomaniâ€:`${parseInt(ad)} ${MONTHS_S[parseInt(am)-1]}`;
return (
<div key={i} className=â€œtapâ€ onClick={()=>{onGo(a.day);close();}} style={{background:â€#2C2C2Eâ€,borderRadius:â€œ14pxâ€,padding:â€œ14px 16pxâ€,cursor:â€œpointerâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ14pxâ€}}>
<div style={{width:â€œ40pxâ€,height:â€œ40pxâ€,borderRadius:â€œ12pxâ€,background:s.color+â€œ20â€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€,fontSize:â€œ20pxâ€,flexShrink:0}}>{a.icon}</div>
<div style={{flex:1,minWidth:0}}>
<div style={{display:â€œflexâ€,gap:â€œ6pxâ€,alignItems:â€œcenterâ€,marginBottom:â€œ3pxâ€}}>
<span style={{fontSize:â€œ10pxâ€,fontWeight:â€œ700â€,color:s.color,letterSpacing:â€œ0.05emâ€}}>{s.label}</span>
<span style={{fontSize:â€œ11pxâ€,color:â€œrgba(255,255,255,0.3)â€}}>Â· {dl}</span>
</div>
<div style={{fontWeight:â€œ600â€,fontSize:â€œ14pxâ€,color:â€#fffâ€,overflow:â€œhiddenâ€,textOverflow:â€œellipsisâ€,whiteSpace:â€œnowrapâ€}}>{a.e.title}</div>
<div style={{fontSize:â€œ12pxâ€,color:â€œrgba(255,255,255,0.35)â€,marginTop:â€œ2pxâ€}}>{a.msg}</div>
</div>
<span style={{color:â€œrgba(255,255,255,0.2)â€,fontSize:â€œ16pxâ€}}>â€º</span>
</div>
);
})}
</div>
<div style={{padding:â€œ0 16pxâ€}}><button onClick={close} style={{width:â€œ100%â€,padding:â€œ15pxâ€,borderRadius:â€œ14pxâ€,border:â€œnoneâ€,background:â€#007AFFâ€,color:â€#fffâ€,fontFamily:â€œinheritâ€,fontSize:â€œ16pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€}}>OK</button></div>
</div>
</div>
);
}

// â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Modal({dayKey,onClose,onSave,editEvent}){
const [step,setStep]=useState(editEvent?â€œdetailsâ€:â€œcategoryâ€);
const [cat,setCat]=useState(editEvent?.category||null);
const [materia,setMat]=useState(editEvent?.materia||null);
const [cMat,setCMat]=useState(editEvent?.customMateria||â€â€);
const [arg,setArg]=useState(editEvent?.argomento||â€â€);
const [tipo,setTipo]=useState(editEvent?.tipoVerifica||â€â€);
const [name,setName]=useState(editEvent?.personName||â€â€);
const [age,setAge]=useState(editEvent?.personAge||â€â€);
const [sugg,setSugg]=useState(editEvent?.selectedSugg||null);
const [ctitle,setCtitle]=useState(editEvent?.customTitle||â€â€);
const [time,setTime]=useState(editEvent?.time||â€â€);
const [note,setNote]=useState(editEvent?.note||â€â€);
const [vis,setVis]=useState(false);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const C=CATS.find(c=>c.id===cat);
const [,km,kd]=dayKey.split(â€-â€);
const steps=cat===â€œverificaâ€?[â€œcategoryâ€,â€œmateriaâ€,â€œargomentoâ€,â€œdetailsâ€]:cat===â€œcompleannoâ€?[â€œcategoryâ€,â€œcompleannoâ€,â€œdetailsâ€]:[â€œcategoryâ€,â€œsuggerimentiâ€,â€œdetailsâ€];
const si=steps.indexOf(step);
const title=()=>{
if(cat===â€œverificaâ€){const m=MATERIE.find(x=>x.id===materia);const ml=materia===â€œaltraâ€?cMat:m?.label;return arg?`${m?.emoji||"ğŸ“š"} ${tipo||"Verifica"} ${ml} â€” ${arg}`:`${m?.emoji||"ğŸ“š"} ${tipo||"Verifica"} di ${ml}`;}
if(cat===â€œcompleannoâ€)return `ğŸ‚ Compleanno di ${name}${age?` (${age} anni)`:""}`;
return sugg===â€œAltroâ€?ctitle:(sugg||â€â€);
};
const ok=()=>{
if(step===â€œargomentoâ€)return materia!==â€œaltraâ€||cMat.trim();
if(step===â€œcompleannoâ€)return name.trim();
if(step===â€œsuggerimentiâ€)return sugg&&(sugg!==â€œAltroâ€||ctitle.trim());
return true;
};
const save=()=>{const t=title();if(!t.trim())return;onSave({id:editEvent?.id||Date.now(),category:cat,title:t,time,note,materia,customMateria:cMat,argomento:arg,tipoVerifica:tipo,personName:name,personAge:age,selectedSugg:sugg,customTitle:ctitle});close();};
const go=s=>setStep(s);
return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:400,background:vis?â€œrgba(0,0,0,0.4)â€:â€œrgba(0,0,0,0)â€,backdropFilter:â€œblur(8px)â€,transition:â€œall 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:â€#F2F2F7â€,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ92vhâ€,overflowY:â€œautoâ€,paddingBottom:â€œenv(safe-area-inset-bottom,20px)â€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:â€œrgba(60,60,67,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ14px 20px 10pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€}}>
<div>
<div style={{fontSize:â€œ12pxâ€,color:â€œrgba(60,60,67,0.4)â€,fontWeight:â€œ500â€}}>{parseInt(kd)} {MONTHS[parseInt(km)-1]}</div>
<div style={{fontSize:â€œ20pxâ€,fontWeight:â€œ700â€,color:â€#1C1C1Eâ€,letterSpacing:â€-0.3pxâ€,marginTop:â€œ2pxâ€}}>{C?`${C.emoji} ${C.label}`:â€œNuovo eventoâ€}</div>
</div>
<button onClick={close} style={{background:â€œrgba(60,60,67,0.1)â€,border:â€œnoneâ€,borderRadius:â€œ50%â€,width:â€œ30pxâ€,height:â€œ30pxâ€,cursor:â€œpointerâ€,color:â€œrgba(60,60,67,0.5)â€,fontSize:â€œ18pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€}}>Ã—</button>
</div>
{cat&&<div style={{display:â€œflexâ€,gap:â€œ3pxâ€,padding:â€œ0 20px 12pxâ€}}>{steps.map((s,i)=><div key={s} style={{height:â€œ3pxâ€,flex:1,borderRadius:â€œ2pxâ€,background:i<=si?(C?.color||â€#007AFFâ€):â€œrgba(60,60,67,0.1)â€,transition:â€œbackground 0.3sâ€}}/>)}</div>}
<div style={{padding:â€œ0 16px 20pxâ€}}>
{step===â€œcategoryâ€&&<div style={{animation:â€œfadeUp 0.2s easeâ€}}>
<div style={{fontSize:â€œ13pxâ€,color:â€œrgba(60,60,67,0.4)â€,marginBottom:â€œ10pxâ€,paddingLeft:â€œ4pxâ€}}>Seleziona categoria</div>
{CATS.map(c=>(
<div key={c.id} className=â€œtapâ€ onClick={()=>{setCat(c.id);c.id===â€œverificaâ€?go(â€œmateriaâ€):c.id===â€œcompleannoâ€?go(â€œcompleannoâ€):go(â€œsuggerimentiâ€)}} style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ14px 16pxâ€,marginBottom:â€œ8pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ14pxâ€,cursor:â€œpointerâ€}}>
<div style={{width:â€œ44pxâ€,height:â€œ44pxâ€,borderRadius:â€œ12pxâ€,background:c.bg,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€,fontSize:â€œ22pxâ€}}>{c.emoji}</div>
<div style={{flex:1}}>
<div style={{fontWeight:â€œ600â€,fontSize:â€œ16pxâ€,color:â€#1C1C1Eâ€}}>{c.label}</div>
<div style={{fontSize:â€œ12pxâ€,color:â€œrgba(60,60,67,0.4)â€,marginTop:â€œ2pxâ€}}>
{c.id===â€œverificaâ€&&â€œMateria + argomentoâ€}{c.id===â€œcompleannoâ€&&â€œNome di chi festeggiaâ€}
{c.id===â€œcommissioneâ€&&â€œSpesa, farmacia, shoppingâ€¦â€}{c.id===â€œappuntamentoâ€&&â€œMedico, dentistaâ€¦â€}
{c.id===â€œtodoâ€&&â€œCose da non dimenticareâ€}
</div>
</div>
<span style={{color:â€œrgba(60,60,67,0.2)â€,fontSize:â€œ20pxâ€}}>â€º</span>
</div>
))}
</div>}
{step===â€œmateriaâ€&&<div style={{animation:â€œfadeUp 0.18s easeâ€}}>
<button onClick={()=>go(â€œcategoryâ€)} style={BK}>â€¹ Indietro</button>
<div style={{display:â€œgridâ€,gridTemplateColumns:â€œ1fr 1fr 1frâ€,gap:â€œ8pxâ€}}>
{MATERIE.map(m=>(
<div key={m.id} className=â€œtapâ€ onClick={()=>{setMat(m.id);go(â€œargomentoâ€)}} style={{background:materia===m.id?â€#007AFFâ€:â€#fffâ€,borderRadius:â€œ12pxâ€,padding:â€œ12px 8pxâ€,cursor:â€œpointerâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,alignItems:â€œcenterâ€,gap:â€œ5pxâ€,transition:â€œall 0.15sâ€}}>
<span style={{fontSize:â€œ22pxâ€}}>{m.emoji}</span>
<span style={{fontSize:â€œ11pxâ€,textAlign:â€œcenterâ€,color:materia===m.id?â€#fffâ€:â€#1C1C1Eâ€,fontWeight:â€œ500â€,lineHeight:1.2}}>{m.label}</span>
</div>
))}
</div>
</div>}
{step===â€œargomentoâ€&&<div style={{animation:â€œfadeUp 0.18s easeâ€}}>
<button onClick={()=>go(â€œmateriaâ€)} style={BK}>â€¹ Indietro</button>
{materia===â€œaltraâ€&&<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ10pxâ€}}><label style={LB}>Materia</label><input value={cMat} onChange={e=>setCMat(e.target.value)} placeholder=â€œEs. Dirittoâ€¦â€ style={IP} autoFocus/></div>}
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ14px 16pxâ€,marginBottom:â€œ10pxâ€}}>
<label style={LB}>Tipo di verifica</label>
<div style={{display:â€œflexâ€,gap:â€œ6pxâ€,flexWrap:â€œwrapâ€,marginTop:â€œ8pxâ€}}>{TIPI.map(t=><button key={t} onClick={()=>setTipo(tipo===t?â€â€:t)} style={{padding:â€œ7px 14pxâ€,borderRadius:â€œ20pxâ€,fontFamily:â€œinheritâ€,border:â€œnoneâ€,background:tipo===t?â€#FF3B30â€:â€œrgba(60,60,67,0.08)â€,color:tipo===t?â€#fffâ€:â€#1C1C1Eâ€,fontSize:â€œ14pxâ€,fontWeight:â€œ500â€,cursor:â€œpointerâ€,transition:â€œall 0.15sâ€}}>{t}</button>)}</div>
</div>
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ16pxâ€}}><label style={LB}>Argomento <span style={{fontWeight:â€œ400â€,color:â€œrgba(60,60,67,0.3)â€}}>(opzionale)</span></label><input value={arg} onChange={e=>setArg(e.target.value)} placeholder=â€œEs. Equazioni, Risorgimentoâ€¦â€ style={IP}/></div>
<button onClick={()=>ok()&&go(â€œdetailsâ€)} style={{â€¦BB,background:ok()?â€#FF3B30â€:â€œrgba(60,60,67,0.1)â€,color:ok()?â€#fffâ€:â€œrgba(60,60,67,0.3)â€}}>Continua</button>
</div>}
{step===â€œcompleannoâ€&&<div style={{animation:â€œfadeUp 0.18s easeâ€}}>
<button onClick={()=>go(â€œcategoryâ€)} style={BK}>â€¹ Indietro</button>
<div style={{textAlign:â€œcenterâ€,fontSize:â€œ50pxâ€,margin:â€œ8px 0 14pxâ€}}>ğŸ‚</div>
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ10pxâ€}}><label style={LB}>Nome</label><input value={name} onChange={e=>setName(e.target.value)} placeholder=â€œEs. Marcoâ€¦â€ style={IP} autoFocus/></div>
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ16pxâ€}}><label style={LB}>Quanti anni? <span style={{fontWeight:â€œ400â€,color:â€œrgba(60,60,67,0.3)â€}}>(opzionale)</span></label><input value={age} onChange={e=>setAge(e.target.value)} placeholder=â€œEs. 18â€¦â€ style={IP} type=â€œnumberâ€/></div>
<button onClick={()=>name.trim()&&go(â€œdetailsâ€)} style={{â€¦BB,background:name.trim()?â€#FF9500â€:â€œrgba(60,60,67,0.1)â€,color:name.trim()?â€#fffâ€:â€œrgba(60,60,67,0.3)â€}}>Continua</button>
</div>}
{step===â€œsuggerimentiâ€&&<div style={{animation:â€œfadeUp 0.18s easeâ€}}>
<button onClick={()=>go(â€œcategoryâ€)} style={BK}>â€¹ Indietro</button>
<div style={{fontSize:â€œ13pxâ€,color:â€œrgba(60,60,67,0.4)â€,marginBottom:â€œ10pxâ€,paddingLeft:â€œ4pxâ€}}>{cat===â€œcommissioneâ€&&â€œCosa devi fare?â€}{cat===â€œappuntamentoâ€&&â€œChe tipo di appuntamento?â€}{cat===â€œtodoâ€&&â€œCosa vuoi ricordarti?â€}</div>
<div style={{display:â€œgridâ€,gridTemplateColumns:â€œ1fr 1frâ€,gap:â€œ8pxâ€,marginBottom:â€œ10pxâ€}}>
{SUGG[cat]?.map(s=>(
<div key={s.label} className=â€œtapâ€ onClick={()=>setSugg(s.label)} style={{background:sugg===s.label?(C?.color||â€#007AFFâ€):â€#fffâ€,borderRadius:â€œ12pxâ€,padding:â€œ12pxâ€,cursor:â€œpointerâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ10pxâ€,transition:â€œall 0.15sâ€}}>
<span style={{fontSize:â€œ20pxâ€}}>{s.emoji}</span>
<span style={{fontSize:â€œ13pxâ€,fontWeight:â€œ500â€,color:sugg===s.label?â€#fffâ€:â€#1C1C1Eâ€,lineHeight:1.2}}>{s.label}</span>
</div>
))}
</div>
{sugg===â€œAltroâ€&&<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ10pxâ€}}><input value={ctitle} onChange={e=>setCtitle(e.target.value)} placeholder=â€œScrivi cosa devi fareâ€¦â€ style={IP} autoFocus/></div>}
<button onClick={()=>ok()&&go(â€œdetailsâ€)} style={{â€¦BB,background:ok()?(C?.color||â€#007AFFâ€):â€œrgba(60,60,67,0.1)â€,color:ok()?â€#fffâ€:â€œrgba(60,60,67,0.3)â€}}>Continua</button>
</div>}
{step===â€œdetailsâ€&&<div style={{animation:â€œfadeUp 0.18s easeâ€}}>
<button onClick={()=>cat===â€œverificaâ€?go(â€œargomentoâ€):cat===â€œcompleannoâ€?go(â€œcompleannoâ€):go(â€œsuggerimentiâ€)} style={BK}>â€¹ Indietro</button>
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ14px 16pxâ€,marginBottom:â€œ10pxâ€,borderLeft:`4px solid ${C?.color||"#007AFF"}`}}>
<div style={{fontSize:â€œ11pxâ€,color:â€œrgba(60,60,67,0.35)â€,fontWeight:â€œ600â€,marginBottom:â€œ4pxâ€,textTransform:â€œuppercaseâ€,letterSpacing:â€œ0.04emâ€}}>{C?.label}</div>
<div style={{fontWeight:â€œ600â€,fontSize:â€œ15pxâ€,color:â€#1C1C1Eâ€}}>{title()}</div>
</div>
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ10pxâ€}}><label style={LB}>Orario <span style={{fontWeight:â€œ400â€,color:â€œrgba(60,60,67,0.3)â€}}>(opzionale)</span></label><input type=â€œtimeâ€ value={time} onChange={e=>setTime(e.target.value)} style={IP}/></div>
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,padding:â€œ4px 16pxâ€,marginBottom:â€œ16pxâ€}}><label style={LB}>Note <span style={{fontWeight:â€œ400â€,color:â€œrgba(60,60,67,0.3)â€}}>(opzionale)</span></label><textarea value={note} onChange={e=>setNote(e.target.value)} placeholder=â€œAggiungi dettagliâ€¦â€ style={{â€¦IP,height:â€œ72pxâ€,resize:â€œnoneâ€,paddingTop:â€œ8pxâ€}}/></div>
<button onClick={save} style={{â€¦BB,background:C?.color||â€#007AFFâ€}}>Salva evento</button>
</div>}
</div>
</div>
</div>
);
}

// â”€â”€ DAY SHEET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DaySheet({dayKey,events,onAdd,onEdit,onDel,onClose}){
const [vis,setVis]=useState(false);
const [,km,kd]=dayKey.split(â€-â€);
const isT=dayKey===todayStr;
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:300,background:vis?â€œrgba(0,0,0,0.25)â€:â€œrgba(0,0,0,0)â€,transition:â€œbackground 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:â€#F2F2F7â€,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ70vhâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€,paddingBottom:â€œenv(safe-area-inset-bottom,16px)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:â€œrgba(60,60,67,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ12px 20px 14pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€,borderBottom:â€œ1px solid rgba(60,60,67,0.1)â€}}>
<div>
<div style={{fontSize:â€œ21pxâ€,fontWeight:â€œ700â€,color:â€#1C1C1Eâ€,letterSpacing:â€-0.4pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ8pxâ€}}>
{parseInt(kd)} {MONTHS[parseInt(km)-1]}
{isT&&<span style={{fontSize:â€œ12pxâ€,background:â€#FF3B30â€,color:â€#fffâ€,padding:â€œ2px 10pxâ€,borderRadius:â€œ10pxâ€,fontWeight:â€œ600â€}}>oggi</span>}
</div>
<div style={{fontSize:â€œ13pxâ€,color:â€œrgba(60,60,67,0.4)â€,marginTop:â€œ2pxâ€}}>{events.length} {events.length===1?â€œeventoâ€:â€œeventiâ€}</div>
</div>
<button onClick={onAdd} style={{background:â€#007AFFâ€,color:â€#fffâ€,border:â€œnoneâ€,borderRadius:â€œ20pxâ€,padding:â€œ8px 18pxâ€,fontSize:â€œ14pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€}}>+ Aggiungi</button>
</div>
<div style={{overflowY:â€œautoâ€,flex:1,padding:â€œ12px 16pxâ€}}>
{events.length===0?(
<div style={{textAlign:â€œcenterâ€,padding:â€œ32px 0â€}}>
<div style={{fontSize:â€œ38pxâ€,marginBottom:â€œ8pxâ€}}>ğŸ“‹</div>
<div style={{color:â€œrgba(60,60,67,0.35)â€,fontSize:â€œ15pxâ€,fontWeight:â€œ500â€}}>Nessun evento</div>
<div style={{color:â€œrgba(60,60,67,0.25)â€,fontSize:â€œ13pxâ€,marginTop:â€œ4pxâ€}}>Tocca + Aggiungi</div>
</div>
):(
<div style={{background:â€#fffâ€,borderRadius:â€œ14pxâ€,overflow:â€œhiddenâ€}}>
{events.map((ev,i)=>{
const c=getCat(ev.category);
return (
<div key={ev.id} style={{padding:â€œ12px 14pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ12pxâ€,borderBottom:i<events.length-1?â€œ1px solid rgba(60,60,67,0.08)â€:â€œnoneâ€}}>
<div style={{width:â€œ10pxâ€,height:â€œ10pxâ€,borderRadius:â€œ50%â€,background:c.color,flexShrink:0}}/>
<div style={{flex:1,minWidth:0}}>
<div style={{fontWeight:â€œ500â€,fontSize:â€œ15pxâ€,color:â€#1C1C1Eâ€,overflow:â€œhiddenâ€,textOverflow:â€œellipsisâ€,whiteSpace:â€œnowrapâ€}}>{ev.title}</div>
<div style={{fontSize:â€œ12pxâ€,color:â€œrgba(60,60,67,0.4)â€,marginTop:â€œ2pxâ€}}>{c.label}{ev.time?` Â· ${ev.time}`:â€â€}</div>
</div>
<button onClick={()=>onEdit(ev)} style={{background:â€œnoneâ€,border:â€œnoneâ€,cursor:â€œpointerâ€,color:â€œrgba(60,60,67,0.3)â€,fontSize:â€œ15pxâ€,padding:â€œ4pxâ€}}>âœï¸</button>
<button onClick={()=>onDel(ev.id)} style={{background:â€œnoneâ€,border:â€œnoneâ€,cursor:â€œpointerâ€,color:â€œrgba(60,60,67,0.2)â€,fontSize:â€œ20pxâ€,padding:â€œ4pxâ€}}>Ã—</button>
</div>
);
})}
</div>
)}
</div>
</div>
</div>
);
}

// â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App(){
const [year,setYear]=useState(today.getFullYear());
const [month,setMonth]=useState(today.getMonth());
const [events,setEvents]=useState(loadEv);
const [selDay,setSelDay]=useState(null);
const [showModal,setShowModal]=useState(false);
const [editEv,setEditEv]=useState(null);
const [view,setView]=useState(â€œmonthâ€);
const [fCat,setFCat]=useState(null);
const [showAl,setShowAl]=useState(false);

useEffect(()=>{saveEv(events)},[events]);
useEffect(()=>{const a=getAlerts(events);if(a.length>0)setTimeout(()=>setShowAl(true),700);},[]);

const alerts=getAlerts(events);
const getDay=k=>events[k]||[];
const handleSave=ev=>{setEvents(p=>{const d=p[selDay]||[];if(editEv)return{â€¦p,[selDay]:d.map(e=>e.id===ev.id?ev:e)};return{â€¦p,[selDay]:[â€¦d,ev]};});};
const delEv=(k,id)=>setEvents(p=>({â€¦p,[k]:(p[k]||[]).filter(e=>e.id!==id)}));

const totM=Object.entries(events).filter(([k])=>k.startsWith(`${year}-${String(month+1).padStart(2,'0')}`)).flatMap(([,e])=>e).length;
const allEv=Object.entries(events).flatMap(([day,evs])=>evs.map(e=>({â€¦e,day}))).filter(e=>e.day.startsWith(String(year))).filter(e=>!fCat||e.category===fCat).sort((a,b)=>a.day.localeCompare(b.day));
const upcoming=Object.entries(events).flatMap(([day,evs])=>evs.map(e=>({â€¦e,day}))).filter(e=>e.day>=todayStr).sort((a,b)=>a.day.localeCompare(b.day)).slice(0,5);
const wDays=Array.from({length:7},(_,i)=>{const d=new Date(),dow=d.getDay()===0?6:d.getDay()-1,dd=new Date(d);dd.setDate(d.getDate()-dow+i);return dd;});

return (
<div style={{fontFamily:â€-apple-system,â€˜SF Pro Textâ€™,â€˜Helvetica Neueâ€™,sans-serifâ€,background:â€#fffâ€,height:â€œ100vhâ€,maxWidth:â€œ430pxâ€,margin:â€œ0 autoâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,overflow:â€œhiddenâ€}}>

```
  {/* HEADER â€” compact, below notch */}
  <div style={{background:"rgba(255,255,255,0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",paddingTop:"env(safe-area-inset-top,44px)",flexShrink:0,borderBottom:"1px solid rgba(60,60,67,0.1)"}}>
    <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px 6px"}}>
      <button className="tap" onClick={()=>{const n=addMonths(year,month,-1);setYear(n.year);setMonth(n.month);}} style={{background:"none",border:"none",cursor:"pointer",fontSize:"24px",color:"#007AFF",padding:"2px 8px",lineHeight:1}}>â€¹</button>
      <button onClick={()=>{setYear(today.getFullYear());setMonth(today.getMonth());}} style={{background:"none",border:"none",cursor:"pointer",textAlign:"center",padding:"2px 8px"}}>
        <div style={{fontSize:"17px",fontWeight:"700",color:"#1C1C1E",letterSpacing:"-0.3px",lineHeight:1}}>{MONTHS[month]} {year}</div>
        {totM>0&&<div style={{fontSize:"11px",color:"rgba(60,60,67,0.4)",marginTop:"1px"}}>{totM} eventi</div>}
      </button>
      <div style={{display:"flex",alignItems:"center"}}>
        <button className="tap" onClick={()=>setShowAl(true)} style={{background:"none",border:"none",cursor:"pointer",padding:"2px 8px",position:"relative"}}>
          <span style={{fontSize:"19px"}}>ğŸ””</span>
          {alerts.length>0&&<div style={{position:"absolute",top:"-2px",right:"4px",minWidth:"15px",height:"15px",background:"#FF3B30",borderRadius:"8px",fontSize:"9px",color:"#fff",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 3px",border:"1.5px solid #fff"}}>{alerts.length}</div>}
        </button>
        <button className="tap" onClick={()=>{const n=addMonths(year,month,1);setYear(n.year);setMonth(n.month);}} style={{background:"none",border:"none",cursor:"pointer",fontSize:"24px",color:"#007AFF",padding:"2px 8px",lineHeight:1}}>â€º</button>
      </div>
    </div>
    <div style={{display:"flex",padding:"0 16px"}}>
      {[["month","Calendario"],["list","Lista"]].map(([v,l])=>(
        <button key={v} onClick={()=>setView(v)} style={{flex:1,padding:"6px 0 8px",border:"none",background:"transparent",fontFamily:"inherit",fontSize:"13px",fontWeight:view===v?"600":"400",color:view===v?"#007AFF":"rgba(60,60,67,0.45)",cursor:"pointer",borderBottom:view===v?"2px solid #007AFF":"2px solid transparent",transition:"all 0.2s"}}>{l}</button>
      ))}
    </div>
  </div>

  {/* CONTENT */}
  <div style={{flex:1,overflowY:"auto",paddingBottom:"80px"}}>

    {view==="month"&&(
      <div>
        {/* Swipeable grid */}
        <div style={{padding:"8px 8px 4px"}}>
          <SwipeCalendar year={year} month={month} events={events} alerts={alerts}
            onDay={setSelDay}
            onMonthChange={(y,m)=>{setYear(y);setMonth(m);}}/>
        </div>

        {/* Prossimi eventi */}
        {upcoming.length>0&&(
          <div style={{padding:"0 12px",marginTop:"8px"}}>
            <div style={{fontSize:"11px",fontWeight:"600",color:"rgba(60,60,67,0.35)",letterSpacing:"0.06em",marginBottom:"8px",paddingLeft:"4px"}}>PROSSIMI EVENTI</div>
            <div style={{background:"#F2F2F7",borderRadius:"14px",overflow:"hidden"}}>
              {upcoming.map((ev,i)=>{
                const c=getCat(ev.category),d=daysBetween(ev.day),[,em,ed]=ev.day.split("-");
                return (
                  <div key={`${ev.day}-${ev.id}`} className="tap" onClick={()=>setSelDay(ev.day)} style={{padding:"10px 14px",display:"flex",alignItems:"center",gap:"12px",cursor:"pointer",borderBottom:i<upcoming.length-1?"1px solid rgba(60,60,67,0.08)":"none",background:"#fff"}}>
                    <div style={{width:"32px",height:"32px",borderRadius:"8px",background:c.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                      <div style={{fontSize:"13px",fontWeight:"700",color:c.color,lineHeight:1}}>{parseInt(ed)}</div>
                      <div style={{fontSize:"8px",color:c.color,fontWeight:"500"}}>{MONTHS_S[parseInt(em)-1]}</div>
                    </div>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontWeight:"500",fontSize:"14px",color:"#1C1C1E",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                      <div style={{fontSize:"11px",color:"rgba(60,60,67,0.4)",marginTop:"1px"}}>
                        {d===0?<span style={{color:c.color,fontWeight:"600"}}>Oggi</span>:d===1?<span style={{color:"#FF9500",fontWeight:"600"}}>Domani</span>:<span>{c.label}</span>}
                        {ev.time&&` Â· ${ev.time}`}
                      </div>
                    </div>
                    <span style={{color:"rgba(60,60,67,0.2)",fontSize:"14px"}}>â€º</span>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* Legenda */}
        <div style={{margin:"10px 12px 0",background:"#F2F2F7",borderRadius:"14px",padding:"12px 14px"}}>
          <div style={{fontSize:"10px",fontWeight:"600",color:"rgba(60,60,67,0.3)",letterSpacing:"0.06em",marginBottom:"8px"}}>CATEGORIE</div>
          <div style={{display:"flex",flexWrap:"wrap",gap:"6px 18px"}}>
            {CATS.map(c=><div key={c.id} style={{display:"flex",alignItems:"center",gap:"5px"}}><div style={{width:"7px",height:"7px",borderRadius:"50%",background:c.color}}/><span style={{fontSize:"12px",color:"rgba(60,60,67,0.55)"}}>{c.label}</span></div>)}
          </div>
        </div>
      </div>
    )}

    {view==="list"&&(
      <div style={{padding:"12px 12px 0"}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"}}>
          <button className="tap" onClick={()=>setYear(y=>y-1)} style={{background:"none",border:"none",fontSize:"22px",color:"#007AFF",cursor:"pointer",padding:"4px 10px"}}>â€¹</button>
          <span style={{fontSize:"17px",fontWeight:"700",color:"#1C1C1E",letterSpacing:"-0.3px"}}>{year}</span>
          <button className="tap" onClick={()=>setYear(y=>y+1)} style={{background:"none",border:"none",fontSize:"22px",color:"#007AFF",cursor:"pointer",padding:"4px 10px"}}>â€º</button>
        </div>
        <div style={{display:"flex",gap:"6px",overflowX:"auto",paddingBottom:"4px",marginBottom:"12px"}}>
          <button onClick={()=>setFCat(null)} style={{padding:"5px 14px",borderRadius:"20px",border:"none",flexShrink:0,background:!fCat?"#007AFF":"#F2F2F7",color:!fCat?"#fff":"rgba(60,60,67,0.5)",fontSize:"13px",fontWeight:"500",cursor:"pointer",fontFamily:"inherit"}}>Tutti</button>
          {CATS.map(c=><button key={c.id} onClick={()=>setFCat(fCat===c.id?null:c.id)} style={{padding:"5px 12px",borderRadius:"20px",border:"none",flexShrink:0,background:fCat===c.id?c.color:"#F2F2F7",color:fCat===c.id?"#fff":c.color,fontSize:"13px",fontWeight:"500",cursor:"pointer",fontFamily:"inherit"}}>{c.emoji} {c.label}</button>)}
        </div>
        {allEv.length===0?(
          <div style={{textAlign:"center",padding:"50px 0"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>ğŸ“‹</div><div style={{color:"rgba(60,60,67,0.35)",fontSize:"15px"}}>Nessun evento</div></div>
        ):(
          <div style={{background:"#fff",borderRadius:"14px",overflow:"hidden"}}>
            {allEv.map((ev,i)=>{
              const c=getCat(ev.category),[,em,ed]=ev.day.split("-");
              return (
                <div key={`${ev.day}-${ev.id}`} style={{padding:"11px 14px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<allEv.length-1?"1px solid rgba(60,60,67,0.08)":"none"}}>
                  <div style={{width:"32px",height:"32px",borderRadius:"8px",background:c.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                    <div style={{fontSize:"13px",fontWeight:"700",color:c.color,lineHeight:1}}>{parseInt(ed)}</div>
                    <div style={{fontSize:"8px",color:c.color,fontWeight:"500"}}>{MONTHS_S[parseInt(em)-1]}</div>
                  </div>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontWeight:"500",fontSize:"14px",color:"#1C1C1E",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                    <div style={{fontSize:"11px",color:"rgba(60,60,67,0.4)",marginTop:"1px"}}>{c.label}{ev.time?` Â· ${ev.time}`:""}</div>
                  </div>
                  <button onClick={()=>delEv(ev.day,ev.id)} style={{background:"none",border:"none",cursor:"pointer",color:"rgba(60,60,67,0.2)",fontSize:"20px",padding:"4px"}}>Ã—</button>
                </div>
              );
            })}
          </div>
        )}
      </div>
    )}
  </div>

  {/* BOTTOM WEEK STRIP */}
  <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:"430px",background:"rgba(255,255,255,0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:"1px solid rgba(60,60,67,0.1)",padding:"6px 10px env(safe-area-inset-bottom,16px)",zIndex:150}}>
    <div style={{display:"flex",justifyContent:"space-between"}}>
      {wDays.map((d,i)=>{
        const key=fmt(d.getFullYear(),d.getMonth(),d.getDate()),evs=getDay(key),isT=key===todayStr,hasAl=alerts.some(a=>a.day===key);
        return (
          <div key={i} className="tap" onClick={()=>setSelDay(key)} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"3px 1px",cursor:"pointer",position:"relative"}}>
            {hasAl&&!isT&&<div style={{position:"absolute",top:"0",right:"4px",width:"5px",height:"5px",borderRadius:"50%",background:"#FF3B30"}}/>}
            <div style={{fontSize:"10px",fontWeight:"500",color:isT?"#FF3B30":"rgba(60,60,67,0.4)",marginBottom:"3px"}}>{DAYS[i]}</div>
            <div style={{width:"30px",height:"30px",borderRadius:"50%",background:isT?"#FF3B30":"transparent",display:"flex",alignItems:"center",justifyContent:"center"}}>
              <div style={{fontSize:"15px",fontWeight:isT?"700":"400",color:isT?"#fff":i>=5?"#FF9500":"#1C1C1E"}}>{d.getDate()}</div>
            </div>
            <div style={{width:"4px",height:"4px",borderRadius:"50%",marginTop:"2px",background:evs.length>0?(isT?"rgba(255,255,255,0.8)":getCat(evs[0].category).color):"transparent"}}/>
          </div>
        );
      })}
    </div>
  </div>

  {showAl&&<AlertsPanel alerts={alerts} onClose={()=>setShowAl(false)} onGo={day=>{setSelDay(day);setMonth(parseInt(day.split("-")[1])-1);setYear(parseInt(day.split("-")[0]));setView("month");}}/>}
  {selDay&&!showModal&&!showAl&&<DaySheet dayKey={selDay} events={getDay(selDay)} onAdd={()=>{setEditEv(null);setShowModal(true)}} onEdit={ev=>{setEditEv(ev);setShowModal(true)}} onDel={id=>delEv(selDay,id)} onClose={()=>setSelDay(null)}/>}
  {showModal&&selDay&&<Modal dayKey={selDay} onClose={()=>setShowModal(false)} onSave={handleSave} editEvent={editEv}/>}
</div>
```

);
}

const BK={background:â€œnoneâ€,border:â€œnoneâ€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€,fontSize:â€œ15pxâ€,color:â€#007AFFâ€,padding:â€œ0 0 14px 0â€,display:â€œblockâ€};
const LB={display:â€œblockâ€,fontSize:â€œ11pxâ€,fontWeight:â€œ600â€,color:â€œrgba(60,60,67,0.4)â€,padding:â€œ10px 0 0â€,textTransform:â€œuppercaseâ€,letterSpacing:â€œ0.05emâ€};
const IP={width:â€œ100%â€,padding:â€œ8px 0 12pxâ€,border:â€œnoneâ€,fontSize:â€œ16pxâ€,fontFamily:â€œinheritâ€,outline:â€œnoneâ€,background:â€œtransparentâ€,color:â€#1C1C1Eâ€,display:â€œblockâ€};
const BB={width:â€œ100%â€,padding:â€œ15pxâ€,borderRadius:â€œ14pxâ€,border:â€œnoneâ€,fontFamily:â€œinheritâ€,fontSize:â€œ16pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€,transition:â€œall 0.15sâ€,letterSpacing:â€-0.2pxâ€,color:â€#fffâ€};

ReactDOM.createRoot(document.getElementById(â€˜rootâ€™)).render(<App/>);
</script>

</body>
</html>
