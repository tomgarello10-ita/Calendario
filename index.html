<!DOCTYPE html>

<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#ffffff"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="Il Mio Anno"/>
  <title>Il Mio Anno</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
    html,body{height:100%;overflow:hidden}
    body{font-family:-apple-system,'SF Pro Text','Helvetica Neue',sans-serif;overscroll-behavior:none;transition:background 0.3s,color 0.3s}
    body.dark{background:#000;color:#fff}
    body.light{background:#fff;color:#1C1C1E}
    ::-webkit-scrollbar{display:none}
    input,textarea{-webkit-appearance:none;user-select:text;font-family:inherit}
    *{user-select:none}
    @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
    .tap:active{opacity:0.45}
    .spin{animation:spin 1s linear infinite}
    .pulse{animation:pulse 1.5s ease infinite}
  </style>
</head>
<body class="light">
<div id="root" style="height:100%"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback} = React;

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ThemeCtx = React.createContext({dark:false,toggle:()=>{}});

const MONTHS=[â€œGennaioâ€,â€œFebbraioâ€,â€œMarzoâ€,â€œAprileâ€,â€œMaggioâ€,â€œGiugnoâ€,â€œLuglioâ€,â€œAgostoâ€,â€œSettembreâ€,â€œOttobreâ€,â€œNovembreâ€,â€œDicembreâ€];
const MONTHS_S=[â€œGenâ€,â€œFebâ€,â€œMarâ€,â€œAprâ€,â€œMagâ€,â€œGiuâ€,â€œLugâ€,â€œAgoâ€,â€œSetâ€,â€œOttâ€,â€œNovâ€,â€œDicâ€];
const DAYS=[â€œLâ€,â€œMâ€,â€œMâ€,â€œGâ€,â€œVâ€,â€œSâ€,â€œDâ€];

const CATS=[
{id:â€œverificaâ€,    label:â€œVerificaâ€,    emoji:â€œğŸ“â€,color:â€#FF3B30â€,bg:â€œrgba(255,59,48,0.1)â€},
{id:â€œcompleannoâ€,  label:â€œCompleannoâ€,  emoji:â€œğŸ‚â€,color:â€#FF9500â€,bg:â€œrgba(255,149,0,0.1)â€},
{id:â€œcommissioneâ€, label:â€œCommissioneâ€, emoji:â€œğŸ›’â€,color:â€#34C759â€,bg:â€œrgba(52,199,89,0.1)â€},
{id:â€œappuntamentoâ€,label:â€œAppuntamentoâ€,emoji:â€œğŸ¥â€,color:â€#007AFFâ€,bg:â€œrgba(0,122,255,0.1)â€},
{id:â€œtodoâ€,        label:â€œDa fareâ€,     emoji:â€œâœ…â€,color:â€#AF52DEâ€,bg:â€œrgba(175,82,222,0.1)â€},
];
const getCat=id=>CATS.find(c=>c.id===id)||CATS[4];

const MATERIE=[
{id:â€œmatematicaâ€,label:â€œMatematicaâ€,emoji:â€œğŸ“â€},{id:â€œitalianoâ€,label:â€œItalianoâ€,emoji:â€œğŸ“–â€},
{id:â€œstoriaâ€,label:â€œStoriaâ€,emoji:â€œğŸ›ï¸â€},{id:â€œscienzeâ€,label:â€œScienzeâ€,emoji:â€œğŸ”¬â€},
{id:â€œingleseâ€,label:â€œIngleseâ€,emoji:â€œğŸ‡¬ğŸ‡§â€},{id:â€œfisicaâ€,label:â€œFisicaâ€,emoji:â€œâš¡â€},
{id:â€œchimicaâ€,label:â€œChimicaâ€,emoji:â€œğŸ§ªâ€},{id:â€œgeografiaâ€,label:â€œGeografiaâ€,emoji:â€œğŸŒâ€},
{id:â€œarteâ€,label:â€œArteâ€,emoji:â€œğŸ¨â€},{id:â€œmusicaâ€,label:â€œMusicaâ€,emoji:â€œğŸµâ€},
{id:â€œfilosofiaâ€,label:â€œFilosofiaâ€,emoji:â€œğŸ¤”â€},{id:â€œinformaticaâ€,label:â€œInformaticaâ€,emoji:â€œğŸ’»â€},
{id:â€œed_fisicaâ€,label:â€œEd. Fisicaâ€,emoji:â€œâš½â€},{id:â€œlatinoâ€,label:â€œLatinoâ€,emoji:â€œğŸ“œâ€},
{id:â€œaltraâ€,label:â€œAltraâ€,emoji:â€œğŸ“šâ€},
];

const TIPI=[â€œScrittoâ€,â€œOraleâ€,â€œTestâ€,â€œCompitoâ€,â€œPresentazioneâ€];

const today=new Date();
const todayStr=fmt(today.getFullYear(),today.getMonth(),today.getDate());
function fmt(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`}
function daysIn(y,m){return new Date(y,m+1,0).getDate()}
function firstDay(y,m){const d=new Date(y,m,1).getDay();return d===0?6:d-1}
function addMonths(y,m,delta){let nm=m+delta,ny=y;while(nm>11){nm-=12;ny++;}while(nm<0){nm+=12;nyâ€“;}return{year:ny,month:nm};}
function daysBetween(s){const[y,m,d]=s.split(â€-â€).map(Number);return Math.round((new Date(y,m-1,d)-new Date(today.getFullYear(),today.getMonth(),today.getDate()))/(864e5))}

const SK=â€œilmioanno_v6â€;
function loadEv(){try{return JSON.parse(localStorage.getItem(SK))||{}}catch{return{}}}
function saveEv(e){try{localStorage.setItem(SK,JSON.stringify(e))}catch{}}
function loadPref(){try{return JSON.parse(localStorage.getItem(SK+â€_prefâ€))||{dark:false}}catch{return{dark:false}}}
function savePref(p){try{localStorage.setItem(SK+â€_prefâ€,JSON.stringify(p))}catch{}}

function getAlerts(ev){
const a=[];
Object.entries(ev).forEach(([day,evs])=>evs.forEach(e=>{
const d=daysBetween(day),c=getCat(e.category);
if(e.category===â€œverificaâ€){
if(d===15)a.push({e,day,d,msg:â€œInizia a ripassare!â€,u:â€œlowâ€,icon:â€œğŸ“–â€});
else if(d===10)a.push({e,day,d,msg:â€œRipassa con costanzaâ€,u:â€œmediumâ€,icon:â€œğŸ“šâ€});
else if(d===5)a.push({e,day,d,msg:â€œUltimi giorni!â€,u:â€œhighâ€,icon:â€œâš¡â€});
else if(d===2)a.push({e,day,d,msg:â€œDopodomani! Rivedi tuttoâ€,u:â€œhighâ€,icon:â€œğŸ”¥â€});
else if(d===1)a.push({e,day,d,msg:â€œDOMANI! Sei pronto?â€,u:â€œurgentâ€,icon:â€œğŸš¨â€});
else if(d===0)a.push({e,day,d,msg:â€œOGGI! In bocca al lupo!â€,u:â€œurgentâ€,icon:â€œğŸ¯â€});
} else if(e.category===â€œcompleannoâ€){
if(d===7)a.push({e,day,d,msg:â€œTra una settimana!â€,u:â€œlowâ€,icon:â€œğŸâ€});
else if(d===3)a.push({e,day,d,msg:â€œTra 3 giorni!â€,u:â€œmediumâ€,icon:â€œğŸ‚â€});
else if(d===1)a.push({e,day,d,msg:â€œDOMANI! Non dimenticare!â€,u:â€œhighâ€,icon:â€œğŸ‰â€});
else if(d===0)a.push({e,day,d,msg:â€œOGGI Ã¨ il compleanno! ğŸ¥³â€,u:â€œurgentâ€,icon:â€œğŸ‚â€});
} else {
if(d===3)a.push({e,day,d,msg:â€œTra 3 giorniâ€,u:â€œlowâ€,icon:c.emoji});
else if(d===1)a.push({e,day,d,msg:â€œDOMANI! Non dimenticareâ€,u:â€œhighâ€,icon:â€œâ°â€});
else if(d===0)a.push({e,day,d,msg:â€œOGGI!â€,u:â€œurgentâ€,icon:â€œğŸ””â€});
}
}));
const o={urgent:0,high:1,medium:2,low:3};
return a.sort((a,b)=>o[a.u]-o[b.u]);
}

// â”€â”€ AI CALL (Gemini) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GEMINI_KEY_SK=â€œilmioanno_gemini_keyâ€;
function getGeminiKey(){try{return localStorage.getItem(GEMINI_KEY_SK)||â€â€}catch{returnâ€â€}}
function saveGeminiKey(k){try{localStorage.setItem(GEMINI_KEY_SK,k)}catch{}}

async function callAI(prompt){
const key=getGeminiKey();
if(!key)throw new Error(â€œNO_KEYâ€);
const res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`,{
method:â€œPOSTâ€,
headers:{â€œContent-Typeâ€:â€œapplication/jsonâ€},
body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
});
if(!res.ok){
const err=await res.json().catch(()=>({}));
throw new Error(err?.error?.message||â€œAPI_ERRORâ€);
}
const data=await res.json();
return data.candidates?.[0]?.content?.parts?.[0]?.text||â€â€;
}

// â”€â”€ METEO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function useMeteo(){
const [meteo,setMeteo]=useState(null);
useEffect(()=>{
if(!navigator.geolocation){return;}
navigator.geolocation.getCurrentPosition(async pos=>{
try{
const {latitude:lat,longitude:lon}=pos.coords;
const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`);
const d=await r.json();
const temp=Math.round(d.current.temperature_2m);
const code=d.current.weather_code;
const icon=code<=1?â€œâ˜€ï¸â€:code<=3?â€œâ›…â€:code<=48?â€œğŸŒ«ï¸â€:code<=67?â€œğŸŒ§ï¸â€:code<=77?â€œğŸŒ¨ï¸â€:code<=82?â€œğŸŒ§ï¸â€:â€œâ›ˆï¸â€;
setMeteo({temp,icon});
}catch{}
},()=>{},{timeout:5000});
},[]);
return meteo;
}

// â”€â”€ SWIPEABLE CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SwipeCalendar({year,month,events,alerts,onDay,onMonthChange}){
const containerRef=useRef(null);
const startX=useRef(null);
const startY=useRef(null);
const currentX=useRef(0);
const isDragging=useRef(false);
const hasMoved=useRef(false);
const [offset,setOffset]=useState(0);
const [animating,setAnimating]=useState(false);
const W=useRef(375);

useEffect(()=>{if(containerRef.current)W.current=containerRef.current.offsetWidth;},[]);

const onTouchStart=e=>{
if(animating)return;
startX.current=e.touches[0].clientX;
startY.current=e.touches[0].clientY;
isDragging.current=false;
hasMoved.current=false;
};
const onTouchMove=e=>{
if(startX.current===null)return;
const dx=e.touches[0].clientX-startX.current;
const dy=Math.abs(e.touches[0].clientY-startY.current);
if(!isDragging.current){
if(dy>Math.abs(dx)||Math.abs(dx)<8)return;
isDragging.current=true;
}
e.preventDefault();
hasMoved.current=Math.abs(dx)>12;
currentX.current=dx;
setOffset(dx);
};
const onTouchEnd=e=>{
if(!isDragging.current){startX.current=null;return;}
const dx=currentX.current;
const threshold=W.current*0.28;
setAnimating(true);
if(dx<-threshold){
setOffset(-W.current);
setTimeout(()=>{const n=addMonths(year,month,1);onMonthChange(n.year,n.month);setOffset(0);setAnimating(false);},280);
} else if(dx>threshold){
setOffset(W.current);
setTimeout(()=>{const n=addMonths(year,month,-1);onMonthChange(n.year,n.month);setOffset(0);setAnimating(false);},280);
} else {
setOffset(0);
setTimeout(()=>setAnimating(false),280);
}
startX.current=null;
isDragging.current=false;
currentX.current=0;
};

// Only fire onDay if swipe did NOT move significantly
const handleDayClick=useCallback((key)=>{
if(!hasMoved.current&&!animating) onDay(key);
},[animating]);

const prev=addMonths(year,month,-1);
const next=addMonths(year,month,1);

return (
<div ref={containerRef} style={{overflow:â€œhiddenâ€,touchAction:â€œpan-yâ€}}
onTouchStart={onTouchStart} onTouchMove={onTouchMove} onTouchEnd={onTouchEnd}>
<div style={{display:â€œflexâ€,width:â€œ300%â€,transform:`translateX(calc(-33.333% + ${offset}px))`,transition:animating?â€œtransform 0.28s cubic-bezier(0.25,0.46,0.45,0.94)â€:â€œnoneâ€,willChange:â€œtransformâ€}}>
<div style={{width:â€œ33.333%â€,flexShrink:0}}><MonthGrid year={prev.year} month={prev.month} events={events} alerts={alerts} onDay={handleDayClick}/></div>
<div style={{width:â€œ33.333%â€,flexShrink:0}}><MonthGrid year={year} month={month} events={events} alerts={alerts} onDay={handleDayClick}/></div>
<div style={{width:â€œ33.333%â€,flexShrink:0}}><MonthGrid year={next.year} month={next.month} events={events} alerts={alerts} onDay={handleDayClick}/></div>
</div>
</div>
);
}

function MonthGrid({year,month,events,alerts,onDay}){
const {dark}=React.useContext(ThemeCtx);
const fd=firstDay(year,month),td=daysIn(year,month);
const getDay=k=>events[k]||[];
return (
<div style={{padding:â€œ0 4pxâ€}}>
<div style={{display:â€œgridâ€,gridTemplateColumns:â€œrepeat(7,1fr)â€,marginBottom:â€œ4pxâ€}}>
{DAYS.map((d,i)=><div key={i} style={{textAlign:â€œcenterâ€,fontSize:â€œ11pxâ€,fontWeight:â€œ600â€,color:i>=5?â€#FF9500â€:dark?â€œrgba(255,255,255,0.3)â€:â€œrgba(60,60,67,0.38)â€,padding:â€œ3px 0â€}}>{d}</div>)}
</div>
<div style={{display:â€œgridâ€,gridTemplateColumns:â€œrepeat(7,1fr)â€,rowGap:â€œ1pxâ€}}>
{Array.from({length:fd},(*,i)=><div key={`e${i}`}/>)}
{Array.from({length:td},(*,i)=>{
const day=i+1,key=fmt(year,month,day);
const evs=getDay(key),isT=key===todayStr,isW=(fd+i)%7>=5;
const isPast=key<todayStr;
const cats=[â€¦new Set(evs.map(e=>e.category))].slice(0,3);
const hasAl=alerts.some(a=>a.day===key);
const diff=daysBetween(key);
return (
<div key={key} onClick={()=>onDay(key)}
style={{aspectRatio:â€œ1â€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€,cursor:â€œpointerâ€,position:â€œrelativeâ€,borderRadius:â€œ50%â€,WebkitTapHighlightColor:â€œtransparentâ€}}>
{isT&&<div style={{position:â€œabsoluteâ€,inset:â€œ8%â€,borderRadius:â€œ50%â€,background:â€#FF3B30â€}}/>}
{hasAl&&!isT&&<div style={{position:â€œabsoluteâ€,inset:â€œ8%â€,borderRadius:â€œ50%â€,border:â€œ1.5px solid #FF3B30â€}}/>}
<div style={{fontSize:â€œ15pxâ€,fontWeight:isT?â€œ600â€:â€œ400â€,color:isT?â€#fffâ€:isPast?(dark?â€œrgba(255,255,255,0.18)â€:â€œrgba(60,60,67,0.22)â€):isW?â€#FF9500â€:dark?â€#fffâ€:â€#1C1C1Eâ€,position:â€œrelativeâ€,zIndex:1,lineHeight:1,marginBottom:cats.length?â€œ3pxâ€:â€œ0â€}}>{day}</div>
{cats.length>0&&<div style={{display:â€œflexâ€,gap:â€œ2pxâ€,position:â€œrelativeâ€,zIndex:1}}>{cats.map(cid=><div key={cid} style={{width:â€œ4pxâ€,height:â€œ4pxâ€,borderRadius:â€œ50%â€,background:isT?â€œrgba(255,255,255,0.85)â€:getCat(cid).color}}/>)}</div>}
{/* Countdown badge for verifiche */}
{!isT&&diff>0&&diff<=5&&evs.some(e=>e.category===â€œverificaâ€)&&(
<div style={{position:â€œabsoluteâ€,top:â€-1pxâ€,right:â€-1pxâ€,background:â€#FF3B30â€,borderRadius:â€œ6pxâ€,padding:â€œ1px 3pxâ€,fontSize:â€œ8pxâ€,fontWeight:â€œ700â€,color:â€#fffâ€,zIndex:2,lineHeight:1}}>{diff}g</div>
)}
</div>
);
})}
</div>
</div>
);
}

// â”€â”€ GEMINI KEY SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function GeminiSetup({onDone,onClose,dark}){
const [key,setKey]=useState(getGeminiKey());
const [testing,setTesting]=useState(false);
const [err,setErr]=useState(â€â€);
const bg=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;
const card=dark?â€#2C2C2Eâ€:â€#fffâ€;
const txt=dark?â€#fffâ€:â€#1C1C1Eâ€;
const sub=dark?â€œrgba(255,255,255,0.4)â€:â€œrgba(60,60,67,0.45)â€;

const test=async()=>{
if(!key.trim())return;
setTesting(true);setErr(â€â€);
try{
await callAI(â€œRispondi solo con: OKâ€);
saveGeminiKey(key.trim());
onDone();
}catch(e){
if(e.message===â€œNO_KEYâ€||e.message.includes(â€œAPI_KEYâ€)||e.message.includes(â€œkeyâ€))
setErr(â€œâŒ Chiave non valida. Controlla di averla copiata bene.â€);
else
setErr(â€œâŒ Errore: â€œ+e.message);
}
setTesting(false);
};

return (
<div style={{padding:â€œ0 16px 16pxâ€}}>
<div style={{background:card,borderRadius:â€œ16pxâ€,padding:â€œ16pxâ€,marginBottom:â€œ14pxâ€}}>
<div style={{fontSize:â€œ15pxâ€,fontWeight:â€œ700â€,color:txt,marginBottom:â€œ6pxâ€}}>ğŸ”‘ Configura Gemini AI</div>
<div style={{fontSize:â€œ13pxâ€,color:sub,lineHeight:1.5,marginBottom:â€œ14pxâ€}}>
Per usare il Ripasso AI e la Lista Spesa ti serve una chiave gratuita di Google Gemini.
</div>
<div style={{background:dark?â€œrgba(0,122,255,0.15)â€:â€œrgba(0,122,255,0.08)â€,borderRadius:â€œ12pxâ€,padding:â€œ12pxâ€,marginBottom:â€œ14pxâ€}}>
<div style={{fontSize:â€œ13pxâ€,fontWeight:â€œ600â€,color:â€#007AFFâ€,marginBottom:â€œ6pxâ€}}>Come ottenerla (2 min):</div>
<div style={{fontSize:â€œ13pxâ€,color:txt,lineHeight:1.7}}>
1. Vai su <span style={{fontWeight:â€œ600â€}}>aistudio.google.com</span>{â€\nâ€}
2. Accedi con Google{â€\nâ€}
3. Clicca <span style={{fontWeight:â€œ600â€}}>â€œGet API Keyâ€</span> â†’ <span style={{fontWeight:â€œ600â€}}>â€œCreate API keyâ€</span>{â€\nâ€}
4. Copia la chiave e incollala qui sotto
</div>
</div>
<input
value={key}
onChange={e=>setKey(e.target.value)}
placeholder=â€œAIzaSyâ€¦â€
style={{width:â€œ100%â€,padding:â€œ12px 14pxâ€,border:`1.5px solid ${err?"#FF3B30":dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.15)"}`,borderRadius:â€œ12pxâ€,fontSize:â€œ14pxâ€,fontFamily:â€œmonospaceâ€,color:txt,background:dark?â€œrgba(255,255,255,0.05)â€:â€#fffâ€,outline:â€œnoneâ€,display:â€œblockâ€,userSelect:â€œtextâ€}}
/>
{err&&<div style={{fontSize:â€œ12pxâ€,color:â€#FF3B30â€,marginTop:â€œ8pxâ€}}>{err}</div>}
</div>
<button onClick={test} disabled={!key.trim()||testing} style={{width:â€œ100%â€,padding:â€œ14pxâ€,borderRadius:â€œ14pxâ€,border:â€œnoneâ€,background:key.trim()?â€#007AFFâ€:â€œrgba(60,60,67,0.1)â€,color:key.trim()?â€#fffâ€:â€œrgba(60,60,67,0.3)â€,fontFamily:â€œinheritâ€,fontSize:â€œ15pxâ€,fontWeight:â€œ600â€,cursor:key.trim()?â€œpointerâ€:â€œdefaultâ€,marginBottom:â€œ8pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€,gap:â€œ8pxâ€}}>
{testing?<><span className="pulse">â³</span>Verifico la chiaveâ€¦</>:â€œSalva e continua â†’â€}
</button>
<button onClick={onClose} style={{width:â€œ100%â€,padding:â€œ12pxâ€,borderRadius:â€œ14pxâ€,border:â€œnoneâ€,background:â€œtransparentâ€,color:sub,fontFamily:â€œinheritâ€,fontSize:â€œ14pxâ€,cursor:â€œpointerâ€}}>Annulla</button>
</div>
);
}

// â”€â”€ AI PANEL: ESERCIZI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function EserciziPanel({event,onClose}){
const {dark}=React.useContext(ThemeCtx);
const [livello,setLivello]=useState(3);
const [step,setStep]=useState(getGeminiKey()?â€œlivelloâ€:â€œsetupâ€);
const [esercizi,setEsercizi]=useState(â€â€);
const [vis,setVis]=useState(false);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const bg=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;
const card=dark?â€#2C2C2Eâ€:â€#fffâ€;
const txt=dark?â€#fffâ€:â€#1C1C1Eâ€;
const sub=dark?â€œrgba(255,255,255,0.4)â€:â€œrgba(60,60,67,0.45)â€;

const livelli=[â€œğŸ˜´ Per nienteâ€,â€œğŸ˜Ÿ Pocoâ€,â€œğŸ˜ Abbastanzaâ€,â€œğŸ˜Š Beneâ€,â€œğŸ”¥ Pronto!â€];

const genera=async()=>{
setStep(â€œloadingâ€);
const mat=event.materia?(MATERIE.find(m=>m.id===event.materia)?.label||event.customMateria):â€œla materiaâ€;
const arg=event.argomento||â€â€;
const tipo=event.tipoVerifica||â€œverificaâ€;
const prompt=`Sei un tutor scolastico italiano. Uno studente ha una ${tipo} di ${mat}${arg?` sullâ€™argomento â€œ${arg}â€`:â€â€}. Si sente preparato: ${livelli[livello-1]}.

Crea un piano di ripasso personalizzato con:

1. 3-4 esercizi pratici specifici per il livello
1. Suggerimenti su cosa ripassare
1. Un consiglio motivazionale finale

Sii conciso, pratico e incoraggiante. Usa emoji. Rispondi in italiano.`;
try{
const r=await callAI(prompt);
setEsercizi(r);
setStep(â€œeserciziâ€);
}catch(e){
if(e.message===â€œNO_KEYâ€)setStep(â€œsetupâ€);
else{setEsercizi(â€œâš ï¸ Errore: â€œ+e.message+â€\nControlla la connessione e riprova.â€);setStep(â€œeserciziâ€);}
}
};

return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:600,background:vis?â€œrgba(0,0,0,0.5)â€:â€œrgba(0,0,0,0)â€,backdropFilter:â€œblur(8px)â€,transition:â€œbackground 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:bg,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ90vhâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€,paddingBottom:â€œenv(safe-area-inset-bottom,24px)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:dark?â€œrgba(255,255,255,0.15)â€:â€œrgba(60,60,67,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ14px 20px 10pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€,flexShrink:0}}>
<div>
<div style={{fontSize:â€œ20pxâ€,fontWeight:â€œ700â€,color:txt,letterSpacing:â€-0.3pxâ€}}>ğŸ§  Ripasso AI</div>
<div style={{fontSize:â€œ13pxâ€,color:sub,marginTop:â€œ2pxâ€,overflow:â€œhiddenâ€,textOverflow:â€œellipsisâ€,whiteSpace:â€œnowrapâ€,maxWidth:â€œ240pxâ€}}>{event.title}</div>
</div>
<button onClick={close} style={{background:dark?â€œrgba(255,255,255,0.1)â€:â€œrgba(60,60,67,0.1)â€,border:â€œnoneâ€,borderRadius:â€œ50%â€,width:â€œ30pxâ€,height:â€œ30pxâ€,cursor:â€œpointerâ€,color:sub,fontSize:â€œ18pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€}}>Ã—</button>
</div>

```
    <div style={{overflowY:"auto",flex:1,padding:"0 16px 16px"}}>
      {step==="setup"&&<GeminiSetup dark={dark} onDone={()=>setStep("livello")} onClose={close}/>}
      {step==="livello"&&(
        <div style={{animation:"fadeUp 0.2s ease"}}>
          <div style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"16px"}}>
            <div style={{fontSize:"14px",fontWeight:"600",color:txt,marginBottom:"12px"}}>Come ti senti preparato?</div>
            <div style={{display:"flex",flexDirection:"column",gap:"8px"}}>
              {livelli.map((l,i)=>(
                <div key={i} onClick={()=>setLivello(i+1)} style={{padding:"12px 16px",borderRadius:"12px",border:`2px solid ${livello===i+1?"#FF3B30":"transparent"}`,background:livello===i+1?"rgba(255,59,48,0.1)":dark?"rgba(255,255,255,0.05)":"rgba(60,60,67,0.04)",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",transition:"all 0.15s"}}>
                  <span style={{fontSize:"20px"}}>{l.split(" ")[0]}</span>
                  <span style={{fontSize:"15px",fontWeight:livello===i+1?"600":"400",color:livello===i+1?"#FF3B30":txt}}>{l.split(" ").slice(1).join(" ")}</span>
                  {livello===i+1&&<div style={{marginLeft:"auto",width:"20px",height:"20px",borderRadius:"50%",background:"#FF3B30",display:"flex",alignItems:"center",justifyContent:"center"}}><span style={{color:"#fff",fontSize:"12px"}}>âœ“</span></div>}
                </div>
              ))}
            </div>
          </div>
          <button onClick={genera} style={{width:"100%",padding:"15px",borderRadius:"14px",border:"none",background:"#FF3B30",color:"#fff",fontFamily:"inherit",fontSize:"16px",fontWeight:"600",cursor:"pointer"}}>
            Genera piano di ripasso âœ¨
          </button>
        </div>
      )}

      {step==="loading"&&(
        <div style={{textAlign:"center",padding:"50px 0"}}>
          <div style={{fontSize:"40px",marginBottom:"16px"}} className="pulse">ğŸ§ </div>
          <div style={{fontSize:"15px",fontWeight:"600",color:txt,marginBottom:"8px"}}>L'AI sta preparando il tuo pianoâ€¦</div>
          <div style={{fontSize:"13px",color:sub}}>Ci vuole qualche secondo</div>
        </div>
      )}

      {step==="esercizi"&&(
        <div style={{animation:"fadeUp 0.2s ease"}}>
          <div style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"16px"}}>
            <div style={{fontSize:"14px",lineHeight:1.6,color:txt,whiteSpace:"pre-wrap"}}>{esercizi}</div>
          </div>
          <button onClick={()=>setStep("livello")} style={{width:"100%",padding:"14px",borderRadius:"14px",border:`2px solid ${dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)"}`,background:"transparent",color:dark?"#fff":"#1C1C1E",fontFamily:"inherit",fontSize:"15px",fontWeight:"600",cursor:"pointer",marginBottom:"8px"}}>
            Rigenera piano â†º
          </button>
          <button onClick={close} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:"#007AFF",color:"#fff",fontFamily:"inherit",fontSize:"15px",fontWeight:"600",cursor:"pointer"}}>
            OK, ho capito! ğŸ’ª
          </button>
        </div>
      )}
    </div>
  </div>
</div>
```

);
}

// â”€â”€ AI PANEL: LISTA SPESA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ListaSpesaPanel({event,onClose,onSaveNote}){
const {dark}=React.useContext(ThemeCtx);
const [piatti,setPiatti]=useState(â€â€);
const [step,setStep]=useState(getGeminiKey()?â€œinputâ€:â€œsetupâ€);
const [lista,setLista]=useState([]);
const [vis,setVis]=useState(false);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const bg=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;
const card=dark?â€#2C2C2Eâ€:â€#fffâ€;
const txt=dark?â€#fffâ€:â€#1C1C1Eâ€;
const sub=dark?â€œrgba(255,255,255,0.4)â€:â€œrgba(60,60,67,0.45)â€;

const genera=async()=>{
if(!piatti.trim())return;
setStep(â€œloadingâ€);
const prompt=`Sei un assistente per la spesa. Lâ€™utente vuole cucinare: â€œ${piatti}â€.

Crea una lista della spesa completa e intelligente. Per ogni ingrediente metti:

- quantitÃ  tipica per 2-4 persone
- categoria (ğŸ¥© Carne/Pesce, ğŸ¥¬ Verdure, ğŸ Frutta, ğŸ¥› Latticini, ğŸ¥« Dispensa, ğŸ§ Altro)

Poi aggiungi 3-5 â€œpotresti aggiungereâ€ come suggerimenti extra utili.

Formato risposta JSON puro, nessun testo fuori:
{â€œlistaâ€:[{â€œnomeâ€:â€â€¦â€,â€œquantitaâ€:â€â€¦â€,â€œcategoriaâ€:â€â€¦â€}],â€œsuggerimentiâ€:[{â€œnomeâ€:â€â€¦â€,â€œmotivoâ€:â€â€¦â€}]}`;
try{
const r=await callAI(prompt);
const clean=r.replace(/`json|`/g,â€â€).trim();
const parsed=JSON.parse(clean);
setLista(parsed);
setStep(â€œlistaâ€);
}catch(e){
if(e.message===â€œNO_KEYâ€)setStep(â€œsetupâ€);
else{setStep(â€œinputâ€);alert(â€œErrore: â€œ+e.message);}
}
};

const [checked,setChecked]=useState({});
const toggle=n=>setChecked(p=>({â€¦p,[n]:!p[n]}));

return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:600,background:vis?â€œrgba(0,0,0,0.5)â€:â€œrgba(0,0,0,0)â€,backdropFilter:â€œblur(8px)â€,transition:â€œbackground 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:bg,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ90vhâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€,paddingBottom:â€œenv(safe-area-inset-bottom,24px)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:dark?â€œrgba(255,255,255,0.15)â€:â€œrgba(60,60,67,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ14px 20px 10pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€,flexShrink:0}}>
<div>
<div style={{fontSize:â€œ20pxâ€,fontWeight:â€œ700â€,color:txt,letterSpacing:â€-0.3pxâ€}}>ğŸ›’ Lista della spesa</div>
<div style={{fontSize:â€œ13pxâ€,color:sub,marginTop:â€œ2pxâ€}}>Generata dallâ€™AI</div>
</div>
<button onClick={close} style={{background:dark?â€œrgba(255,255,255,0.1)â€:â€œrgba(60,60,67,0.1)â€,border:â€œnoneâ€,borderRadius:â€œ50%â€,width:â€œ30pxâ€,height:â€œ30pxâ€,cursor:â€œpointerâ€,color:sub,fontSize:â€œ18pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€}}>Ã—</button>
</div>

```
    <div style={{overflowY:"auto",flex:1,padding:"0 16px 16px"}}>
      {step==="setup"&&<GeminiSetup dark={dark} onDone={()=>setStep("input")} onClose={close}/>}
      {step==="input"&&(
        <div style={{animation:"fadeUp 0.2s ease"}}>
          <div style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"16px"}}>
            <div style={{fontSize:"14px",fontWeight:"600",color:txt,marginBottom:"10px"}}>Cosa vuoi cucinare? ğŸ³</div>
            <textarea value={piatti} onChange={e=>setPiatti(e.target.value)} placeholder="Es. pasta al pomodoro, insalata di pollo, tiramisuâ€¦" style={{width:"100%",minHeight:"80px",border:"none",background:dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)",borderRadius:"12px",padding:"12px",fontSize:"15px",fontFamily:"inherit",color:txt,outline:"none",resize:"none",display:"block",userSelect:"text"}}/>
          </div>
          <button onClick={genera} disabled={!piatti.trim()} style={{width:"100%",padding:"15px",borderRadius:"14px",border:"none",background:piatti.trim()?"#34C759":"rgba(60,60,67,0.1)",color:piatti.trim()?"#fff":"rgba(60,60,67,0.3)",fontFamily:"inherit",fontSize:"16px",fontWeight:"600",cursor:piatti.trim()?"pointer":"default"}}>
            Genera lista ğŸ›’
          </button>
        </div>
      )}

      {step==="loading"&&(
        <div style={{textAlign:"center",padding:"50px 0"}}>
          <div style={{fontSize:"40px",marginBottom:"16px"}} className="pulse">ğŸ›’</div>
          <div style={{fontSize:"15px",fontWeight:"600",color:txt,marginBottom:"8px"}}>Preparo la listaâ€¦</div>
          <div style={{fontSize:"13px",color:sub}}>Sto pensando agli ingredienti</div>
        </div>
      )}

      {step==="lista"&&lista.lista&&(
        <div style={{animation:"fadeUp 0.2s ease"}}>
          {/* Lista principale */}
          <div style={{background:card,borderRadius:"16px",overflow:"hidden",marginBottom:"12px"}}>
            <div style={{padding:"12px 16px",borderBottom:`1px solid ${dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.08)"}`,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
              <span style={{fontSize:"13px",fontWeight:"700",color:sub,letterSpacing:"0.04em"}}>DA COMPRARE</span>
              <span style={{fontSize:"12px",color:sub}}>{Object.values(checked).filter(Boolean).length}/{lista.lista.length}</span>
            </div>
            {lista.lista.map((item,i)=>(
              <div key={i} onClick={()=>toggle(item.nome)} style={{padding:"11px 16px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<lista.lista.length-1?`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`:"none",cursor:"pointer",background:checked[item.nome]?(dark?"rgba(255,255,255,0.03)":"rgba(60,60,67,0.02)"):"transparent"}}>
                <div style={{width:"22px",height:"22px",borderRadius:"50%",border:`2px solid ${checked[item.nome]?"#34C759":"rgba(60,60,67,0.25)"}`,background:checked[item.nome]?"#34C759":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,transition:"all 0.15s"}}>
                  {checked[item.nome]&&<span style={{color:"#fff",fontSize:"12px",fontWeight:"700"}}>âœ“</span>}
                </div>
                <div style={{flex:1}}>
                  <span style={{fontSize:"15px",fontWeight:"500",color:checked[item.nome]?sub:txt,textDecoration:checked[item.nome]?"line-through":"none"}}>{item.categoria} {item.nome}</span>
                </div>
                <span style={{fontSize:"12px",color:sub}}>{item.quantita}</span>
              </div>
            ))}
          </div>

          {/* Suggerimenti */}
          {lista.suggerimenti?.length>0&&(
            <div style={{marginBottom:"12px"}}>
              <div style={{fontSize:"11px",fontWeight:"600",color:sub,letterSpacing:"0.05em",marginBottom:"8px",paddingLeft:"4px"}}>POTRESTI AGGIUNGERE</div>
              <div style={{background:card,borderRadius:"16px",overflow:"hidden"}}>
                {lista.suggerimenti.map((s,i)=>(
                  <div key={i} onClick={()=>toggle("sugg_"+s.nome)} style={{padding:"11px 16px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<lista.suggerimenti.length-1?`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`:"none",cursor:"pointer"}}>
                    <div style={{width:"22px",height:"22px",borderRadius:"50%",border:`2px solid ${checked["sugg_"+s.nome]?"#34C759":"rgba(52,199,89,0.4)"}`,background:checked["sugg_"+s.nome]?"#34C759":"rgba(52,199,89,0.08)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                      {checked["sugg_"+s.nome]?<span style={{color:"#fff",fontSize:"12px"}}>âœ“</span>:<span style={{color:"#34C759",fontSize:"14px"}}>+</span>}
                    </div>
                    <div style={{flex:1}}>
                      <div style={{fontSize:"14px",fontWeight:"500",color:txt}}>{s.nome}</div>
                      <div style={{fontSize:"11px",color:sub,marginTop:"1px"}}>{s.motivo}</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          <div style={{display:"flex",gap:"8px"}}>
            <button onClick={()=>{setStep("input");setChecked({});}} style={{flex:1,padding:"13px",borderRadius:"14px",border:`2px solid ${dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)"}`,background:"transparent",color:txt,fontFamily:"inherit",fontSize:"14px",fontWeight:"600",cursor:"pointer"}}>â†º Ricomincia</button>
            <button onClick={close} style={{flex:1,padding:"13px",borderRadius:"14px",border:"none",background:"#34C759",color:"#fff",fontFamily:"inherit",fontSize:"14px",fontWeight:"600",cursor:"pointer"}}>âœ“ Fatto!</button>
          </div>
        </div>
      )}
    </div>
  </div>
</div>
```

);
}

// â”€â”€ NOTE VOCALI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function VoiceNoteBtn({onNote}){
const {dark}=React.useContext(ThemeCtx);
const [recording,setRecording]=useState(false);
const [supported]=useState(()=>â€˜SpeechRecognitionâ€™ in window||â€˜webkitSpeechRecognitionâ€™ in window);
const recRef=useRef(null);

const start=()=>{
if(!supported)return alert(â€œIl riconoscimento vocale non Ã¨ supportato su questo browser.â€);
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
const rec=new SR();
rec.lang=â€œit-ITâ€;
rec.continuous=false;
rec.interimResults=false;
rec.onresult=e=>{const text=e.results[0][0].transcript;onNote(text);};
rec.onend=()=>setRecording(false);
rec.onerror=()=>setRecording(false);
recRef.current=rec;
rec.start();
setRecording(true);
};
const stop=()=>{recRef.current?.stop();setRecording(false);};

if(!supported)return null;
return (
<button onClick={recording?stop:start} style={{background:recording?â€#FF3B30â€:â€œrgba(60,60,67,0.08)â€,border:â€œnoneâ€,borderRadius:â€œ20pxâ€,padding:â€œ7px 14pxâ€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€,fontSize:â€œ13pxâ€,fontWeight:â€œ600â€,color:recording?â€#fffâ€:dark?â€#fffâ€:â€#1C1C1Eâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ6pxâ€,transition:â€œall 0.2sâ€}}>
{recording?<><span className="pulse">ğŸ”´</span>Stop</>:<><span>ğŸ¤</span>Voce</>}
</button>
);
}

// â”€â”€ ALERTS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AlertsPanel({alerts,onClose,onGo}){
const {dark}=React.useContext(ThemeCtx);
const [vis,setVis]=useState(false);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const US={urgent:{color:â€#FF3B30â€,label:â€œURGENTEâ€},high:{color:â€#FF9500â€,label:â€œIMPORTANTEâ€},medium:{color:â€#FFCC00â€,label:â€œATTENZIONEâ€},low:{color:â€#007AFFâ€,label:â€œPROMEMORIAâ€}};
return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:500,background:vis?â€œrgba(0,0,0,0.4)â€:â€œrgba(0,0,0,0)â€,transition:â€œbackground 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:â€#1C1C1Eâ€,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ88vhâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€,paddingBottom:â€œenv(safe-area-inset-bottom,24px)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:â€œrgba(255,255,255,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ16px 20px 14pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€}}>
<div>
<div style={{fontSize:â€œ22pxâ€,fontWeight:â€œ700â€,color:â€#fffâ€,letterSpacing:â€-0.5pxâ€}}>Promemoria</div>
<div style={{fontSize:â€œ13pxâ€,color:â€œrgba(255,255,255,0.35)â€,marginTop:â€œ2pxâ€}}>{alerts.length} avvisi</div>
</div>
<button onClick={close} style={{background:â€œrgba(255,255,255,0.1)â€,border:â€œnoneâ€,borderRadius:â€œ50%â€,width:â€œ30pxâ€,height:â€œ30pxâ€,cursor:â€œpointerâ€,color:â€œrgba(255,255,255,0.5)â€,fontSize:â€œ16pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€}}>Ã—</button>
</div>
<div style={{overflowY:â€œautoâ€,flex:1,padding:â€œ0 16px 16pxâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,gap:â€œ8pxâ€}}>
{alerts.map((a,i)=>{
const s=US[a.u],[,am,ad]=a.day.split(â€-â€);
const dl=a.d===0?â€œOggiâ€:a.d===1?â€œDomaniâ€:`${parseInt(ad)} ${MONTHS_S[parseInt(am)-1]}`;
return (
<div key={i} className=â€œtapâ€ onClick={()=>{onGo(a.day);close();}} style={{background:â€#2C2C2Eâ€,borderRadius:â€œ14pxâ€,padding:â€œ14px 16pxâ€,cursor:â€œpointerâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ14pxâ€}}>
<div style={{width:â€œ40pxâ€,height:â€œ40pxâ€,borderRadius:â€œ12pxâ€,background:s.color+â€œ20â€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€,fontSize:â€œ20pxâ€,flexShrink:0}}>{a.icon}</div>
<div style={{flex:1,minWidth:0}}>
<div style={{display:â€œflexâ€,gap:â€œ6pxâ€,alignItems:â€œcenterâ€,marginBottom:â€œ3pxâ€}}>
<span style={{fontSize:â€œ10pxâ€,fontWeight:â€œ700â€,color:s.color,letterSpacing:â€œ0.05emâ€}}>{s.label}</span>
<span style={{fontSize:â€œ11pxâ€,color:â€œrgba(255,255,255,0.3)â€}}>Â· {dl}</span>
</div>
<div style={{fontWeight:â€œ600â€,fontSize:â€œ14pxâ€,color:â€#fffâ€,overflow:â€œhiddenâ€,textOverflow:â€œellipsisâ€,whiteSpace:â€œnowrapâ€}}>{a.e.title}</div>
<div style={{fontSize:â€œ12pxâ€,color:â€œrgba(255,255,255,0.35)â€,marginTop:â€œ2pxâ€}}>{a.msg}</div>
</div>
<span style={{color:â€œrgba(255,255,255,0.2)â€,fontSize:â€œ16pxâ€}}>â€º</span>
</div>
);
})}
</div>
<div style={{padding:â€œ0 16pxâ€}}><button onClick={close} style={{width:â€œ100%â€,padding:â€œ15pxâ€,borderRadius:â€œ14pxâ€,border:â€œnoneâ€,background:â€#007AFFâ€,color:â€#fffâ€,fontFamily:â€œinheritâ€,fontSize:â€œ16pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€}}>OK</button></div>
</div>
</div>
);
}

// â”€â”€ MODAL EVENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Modal({dayKey,onClose,onSave,editEvent}){
const {dark}=React.useContext(ThemeCtx);
const [step,setStep]=useState(editEvent?â€œdetailsâ€:â€œcategoryâ€);
const [cat,setCat]=useState(editEvent?.category||null);
const [materia,setMat]=useState(editEvent?.materia||null);
const [cMat,setCMat]=useState(editEvent?.customMateria||â€â€);
const [arg,setArg]=useState(editEvent?.argomento||â€â€);
const [tipo,setTipo]=useState(editEvent?.tipoVerifica||â€â€);
const [name,setName]=useState(editEvent?.personName||â€â€);
const [age,setAge]=useState(editEvent?.personAge||â€â€);
const [sugg,setSugg]=useState(editEvent?.selectedSugg||null);
const [ctitle,setCtitle]=useState(editEvent?.customTitle||â€â€);
const [time,setTime]=useState(editEvent?.time||â€â€);
const [note,setNote]=useState(editEvent?.note||â€â€);
const [vis,setVis]=useState(false);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const C=CATS.find(c=>c.id===cat);
const [,km,kd]=dayKey.split(â€-â€);
const bg=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;
const card=dark?â€#2C2C2Eâ€:â€#fffâ€;
const txt=dark?â€#fffâ€:â€#1C1C1Eâ€;
const sub=dark?â€œrgba(255,255,255,0.4)â€:â€œrgba(60,60,67,0.45)â€;
const steps=cat===â€œverificaâ€?[â€œcategoryâ€,â€œmateriaâ€,â€œargomentoâ€,â€œdetailsâ€]:cat===â€œcompleannoâ€?[â€œcategoryâ€,â€œcompleannoâ€,â€œdetailsâ€]:[â€œcategoryâ€,â€œsuggerimentiâ€,â€œdetailsâ€];
const si=steps.indexOf(step);

const SUGG_MAP={
commissione:[{label:â€œFare la spesaâ€,emoji:â€œğŸ›’â€},{label:â€œFarmaciaâ€,emoji:â€œğŸ’Šâ€},{label:â€œPagare bolletteâ€,emoji:â€œğŸ’°â€},{label:â€œPostaâ€,emoji:â€œğŸ“®â€},{label:â€œRitirare paccoâ€,emoji:â€œğŸ“¦â€},{label:â€œBanca / ATMâ€,emoji:â€œğŸ¦â€},{label:â€œMeccanicoâ€,emoji:â€œğŸ”§â€},{label:â€œShoppingâ€,emoji:â€œğŸ›ï¸â€},{label:â€œVeterinarioâ€,emoji:â€œğŸ¾â€},{label:â€œReferti mediciâ€,emoji:â€œğŸ“‹â€},{label:â€œAltroâ€,emoji:â€œâœï¸â€}],
appuntamento:[{label:â€œMedicoâ€,emoji:â€œğŸ‘¨â€âš•ï¸â€},{label:â€œDentistaâ€,emoji:â€œğŸ¦·â€},{label:â€œSpecialistaâ€,emoji:â€œğŸ¥â€},{label:â€œFisioterapiaâ€,emoji:â€œğŸ’†â€},{label:â€œAnalisi sangueâ€,emoji:â€œğŸ©¸â€},{label:â€œOculistaâ€,emoji:â€œğŸ‘ï¸â€},{label:â€œColloquio scuolaâ€,emoji:â€œğŸ«â€},{label:â€œRiunioneâ€,emoji:â€œğŸ’¼â€},{label:â€œColloquio lavoroâ€,emoji:â€œğŸ‘”â€},{label:â€œParrucchiereâ€,emoji:â€œâœ‚ï¸â€},{label:â€œAltroâ€,emoji:â€œâœï¸â€}],
todo:[{label:â€œStudiareâ€,emoji:â€œğŸ“šâ€},{label:â€œFare sportâ€,emoji:â€œğŸƒâ€},{label:â€œChiamare qualcunoâ€,emoji:â€œğŸ“â€},{label:â€œPulire casaâ€,emoji:â€œğŸ§¹â€},{label:â€œLavanderiaâ€,emoji:â€œğŸ‘•â€},{label:â€œCucinareâ€,emoji:â€œğŸ³â€},{label:â€œLeggereâ€,emoji:â€œğŸ“–â€},{label:â€œOrganizzareâ€,emoji:â€œğŸ—‚ï¸â€},{label:â€œMeditareâ€,emoji:â€œğŸ§˜â€},{label:â€œProgettoâ€,emoji:â€œğŸ’¡â€},{label:â€œAltroâ€,emoji:â€œâœï¸â€}],
};

const buildTitle=()=>{
if(cat===â€œverificaâ€){const m=MATERIE.find(x=>x.id===materia);const ml=materia===â€œaltraâ€?cMat:m?.label;return arg?`${m?.emoji||"ğŸ“š"} ${tipo||"Verifica"} ${ml} â€” ${arg}`:`${m?.emoji||"ğŸ“š"} ${tipo||"Verifica"} di ${ml}`;}
if(cat===â€œcompleannoâ€)return `ğŸ‚ Compleanno di ${name}${age?` (${age} anni)`:""}`;
return sugg===â€œAltroâ€?ctitle:(sugg||â€â€);
};
const ok=()=>{
if(step===â€œargomentoâ€)return materia!==â€œaltraâ€||cMat.trim();
if(step===â€œcompleannoâ€)return name.trim();
if(step===â€œsuggerimentiâ€)return sugg&&(sugg!==â€œAltroâ€||ctitle.trim());
return true;
};
const save=()=>{const t=buildTitle();if(!t.trim())return;onSave({id:editEvent?.id||Date.now(),category:cat,title:t,time,note,materia,customMateria:cMat,argomento:arg,tipoVerifica:tipo,personName:name,personAge:age,selectedSugg:sugg,customTitle:ctitle});close();};
const go=s=>setStep(s);

return (
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:400,background:vis?â€œrgba(0,0,0,0.4)â€:â€œrgba(0,0,0,0)â€,backdropFilter:â€œblur(8px)â€,transition:â€œall 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:bg,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ92vhâ€,overflowY:â€œautoâ€,paddingBottom:â€œenv(safe-area-inset-bottom,20px)â€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:dark?â€œrgba(255,255,255,0.15)â€:â€œrgba(60,60,67,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ14px 20px 10pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€}}>
<div>
<div style={{fontSize:â€œ12pxâ€,color:sub}}>{parseInt(kd)} {MONTHS[parseInt(km)-1]}</div>
<div style={{fontSize:â€œ20pxâ€,fontWeight:â€œ700â€,color:txt,letterSpacing:â€-0.3pxâ€,marginTop:â€œ2pxâ€}}>{C?`${C.emoji} ${C.label}`:â€œNuovo eventoâ€}</div>
</div>
<button onClick={close} style={{background:dark?â€œrgba(255,255,255,0.1)â€:â€œrgba(60,60,67,0.1)â€,border:â€œnoneâ€,borderRadius:â€œ50%â€,width:â€œ30pxâ€,height:â€œ30pxâ€,cursor:â€œpointerâ€,color:sub,fontSize:â€œ18pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œcenterâ€}}>Ã—</button>
</div>
{cat&&<div style={{display:â€œflexâ€,gap:â€œ3pxâ€,padding:â€œ0 20px 12pxâ€}}>{steps.map((s,i)=><div key={s} style={{height:â€œ3pxâ€,flex:1,borderRadius:â€œ2pxâ€,background:i<=si?(C?.color||â€#007AFFâ€):dark?â€œrgba(255,255,255,0.1)â€:â€œrgba(60,60,67,0.1)â€,transition:â€œbackground 0.3sâ€}}/>)}</div>}

```
    <div style={{padding:"0 16px 20px"}}>
      {step==="category"&&<div style={{animation:"fadeUp 0.2s ease"}}>
        <div style={{fontSize:"13px",color:sub,marginBottom:"10px",paddingLeft:"4px"}}>Seleziona categoria</div>
        {CATS.map(c=>(
          <div key={c.id} className="tap" onClick={()=>{setCat(c.id);c.id==="verifica"?go("materia"):c.id==="compleanno"?go("compleanno"):go("suggerimenti")}} style={{background:card,borderRadius:"14px",padding:"14px 16px",marginBottom:"8px",display:"flex",alignItems:"center",gap:"14px",cursor:"pointer"}}>
            <div style={{width:"44px",height:"44px",borderRadius:"12px",background:c.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px"}}>{c.emoji}</div>
            <div style={{flex:1}}>
              <div style={{fontWeight:"600",fontSize:"16px",color:txt}}>{c.label}</div>
              <div style={{fontSize:"12px",color:sub,marginTop:"2px"}}>
                {c.id==="verifica"&&"Materia + esercizi AI"}{c.id==="compleanno"&&"Nome di chi festeggia"}
                {c.id==="commissione"&&"Lista spesa AI inclusa"}{c.id==="appuntamento"&&"Medico, dentistaâ€¦"}
                {c.id==="todo"&&"Cose da non dimenticare"}
              </div>
            </div>
            <span style={{color:sub,fontSize:"20px"}}>â€º</span>
          </div>
        ))}
      </div>}

      {step==="materia"&&<div style={{animation:"fadeUp 0.18s ease"}}>
        <button onClick={()=>go("category")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}>
          {MATERIE.map(m=>(
            <div key={m.id} className="tap" onClick={()=>{setMat(m.id);go("argomento")}} style={{background:materia===m.id?"#007AFF":card,borderRadius:"12px",padding:"12px 8px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",transition:"all 0.15s"}}>
              <span style={{fontSize:"22px"}}>{m.emoji}</span>
              <span style={{fontSize:"11px",textAlign:"center",color:materia===m.id?"#fff":txt,fontWeight:"500",lineHeight:1.2}}>{m.label}</span>
            </div>
          ))}
        </div>
      </div>}

      {step==="argomento"&&<div style={{animation:"fadeUp 0.18s ease"}}>
        <button onClick={()=>go("materia")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
        {materia==="altra"&&<div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><label style={{...LB,color:sub}}>Materia</label><input value={cMat} onChange={e=>setCMat(e.target.value)} placeholder="Es. Dirittoâ€¦" style={{...IP,color:txt}} autoFocus/></div>}
        <div style={{background:card,borderRadius:"14px",padding:"14px 16px",marginBottom:"10px"}}>
          <label style={{...LB,color:sub}}>Tipo di verifica</label>
          <div style={{display:"flex",gap:"6px",flexWrap:"wrap",marginTop:"8px"}}>{TIPI.map(t=><button key={t} onClick={()=>setTipo(tipo===t?"":t)} style={{padding:"7px 14px",borderRadius:"20px",fontFamily:"inherit",border:"none",background:tipo===t?"#FF3B30":dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.08)",color:tipo===t?"#fff":txt,fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"}}>{t}</button>)}</div>
        </div>
        <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"8px"}}>
          <label style={{...LB,color:sub}}>Argomento <span style={{fontWeight:"400",opacity:0.5}}>(opzionale)</span></label>
          <input value={arg} onChange={e=>setArg(e.target.value)} placeholder="Es. Equazioni, Risorgimentoâ€¦" style={{...IP,color:txt}}/>
        </div>
        <div style={{display:"flex",gap:"8px",marginBottom:"16px",alignItems:"center"}}>
          <VoiceNoteBtn onNote={v=>setArg(v)}/>
          <span style={{fontSize:"12px",color:sub}}>Ditta l'argomento</span>
        </div>
        <button onClick={()=>ok()&&go("details")} style={{...BB,background:ok()?"#FF3B30":"rgba(60,60,67,0.1)",color:ok()?"#fff":sub}}>Continua</button>
      </div>}

      {step==="compleanno"&&<div style={{animation:"fadeUp 0.18s ease"}}>
        <button onClick={()=>go("category")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
        <div style={{textAlign:"center",fontSize:"50px",margin:"8px 0 14px"}}>ğŸ‚</div>
        <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><label style={{...LB,color:sub}}>Nome</label><input value={name} onChange={e=>setName(e.target.value)} placeholder="Es. Marcoâ€¦" style={{...IP,color:txt}} autoFocus/></div>
        <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"16px"}}><label style={{...LB,color:sub}}>Quanti anni?</label><input value={age} onChange={e=>setAge(e.target.value)} placeholder="Es. 18â€¦" style={{...IP,color:txt}} type="number"/></div>
        <button onClick={()=>name.trim()&&go("details")} style={{...BB,background:name.trim()?"#FF9500":"rgba(60,60,67,0.1)",color:name.trim()?"#fff":sub}}>Continua</button>
      </div>}

      {step==="suggerimenti"&&<div style={{animation:"fadeUp 0.18s ease"}}>
        <button onClick={()=>go("category")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
        <div style={{fontSize:"13px",color:sub,marginBottom:"10px",paddingLeft:"4px"}}>{cat==="commissione"&&"Cosa devi fare?"}{cat==="appuntamento"&&"Che tipo di appuntamento?"}{cat==="todo"&&"Cosa vuoi ricordarti?"}</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"10px"}}>
          {SUGG_MAP[cat]?.map(s=>(
            <div key={s.label} className="tap" onClick={()=>setSugg(s.label)} style={{background:sugg===s.label?(C?.color||"#007AFF"):card,borderRadius:"12px",padding:"12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",transition:"all 0.15s"}}>
              <span style={{fontSize:"20px"}}>{s.emoji}</span>
              <span style={{fontSize:"13px",fontWeight:"500",color:sugg===s.label?"#fff":txt,lineHeight:1.2}}>{s.label}</span>
            </div>
          ))}
        </div>
        {sugg==="Altro"&&<div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><input value={ctitle} onChange={e=>setCtitle(e.target.value)} placeholder="Scrivi cosa devi fareâ€¦" style={{...IP,color:txt}} autoFocus/></div>}
        <button onClick={()=>ok()&&go("details")} style={{...BB,background:ok()?(C?.color||"#007AFF"):"rgba(60,60,67,0.1)",color:ok()?"#fff":sub}}>Continua</button>
      </div>}

      {step==="details"&&<div style={{animation:"fadeUp 0.18s ease"}}>
        <button onClick={()=>cat==="verifica"?go("argomento"):cat==="compleanno"?go("compleanno"):go("suggerimenti")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
        <div style={{background:card,borderRadius:"14px",padding:"14px 16px",marginBottom:"10px",borderLeft:`4px solid ${C?.color||"#007AFF"}`}}>
          <div style={{fontSize:"11px",color:sub,fontWeight:"600",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.04em"}}>{C?.label}</div>
          <div style={{fontWeight:"600",fontSize:"15px",color:txt}}>{buildTitle()}</div>
        </div>
        <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><label style={{...LB,color:sub}}>Orario</label><input type="time" value={time} onChange={e=>setTime(e.target.value)} style={{...IP,color:txt}}/></div>
        <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"8px"}}><label style={{...LB,color:sub}}>Note</label><textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Aggiungi dettagliâ€¦" style={{...IP,color:txt,height:"60px",resize:"none",paddingTop:"8px"}}/></div>
        <div style={{display:"flex",gap:"8px",marginBottom:"16px",alignItems:"center"}}>
          <VoiceNoteBtn onNote={v=>setNote(v)}/>
          <span style={{fontSize:"12px",color:sub}}>Ditta le note</span>
        </div>
        <button onClick={save} style={{...BB,background:C?.color||"#007AFF"}}>Salva evento</button>
      </div>}
    </div>
  </div>
</div>
```

);
}

// â”€â”€ DAY SHEET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DaySheet({dayKey,events,onAdd,onEdit,onDel,onClose}){
const {dark}=React.useContext(ThemeCtx);
const [vis,setVis]=useState(false);
const [aiEvent,setAiEvent]=useState(null);
const [aiType,setAiType]=useState(null);
const [,km,kd]=dayKey.split(â€-â€);
const isT=dayKey===todayStr;
const diff=daysBetween(dayKey);
useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
const close=()=>{setVis(false);setTimeout(onClose,320)};
const bg=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;
const card=dark?â€#2C2C2Eâ€:â€#fffâ€;
const txt=dark?â€#fffâ€:â€#1C1C1Eâ€;
const sub=dark?â€œrgba(255,255,255,0.4)â€:â€œrgba(60,60,67,0.45)â€;
return (
<>
<div onClick={e=>e.target===e.currentTarget&&close()} style={{position:â€œfixedâ€,inset:0,zIndex:300,background:vis?â€œrgba(0,0,0,0.25)â€:â€œrgba(0,0,0,0)â€,transition:â€œbackground 0.3sâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,justifyContent:â€œflex-endâ€}}>
<div style={{background:bg,borderRadius:â€œ20px 20px 0 0â€,maxHeight:â€œ75vhâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,transform:vis?â€œtranslateY(0)â€:â€œtranslateY(100%)â€,transition:â€œtransform 0.4s cubic-bezier(0.32,0.72,0,1)â€,paddingBottom:â€œenv(safe-area-inset-bottom,16px)â€}}>
<div style={{display:â€œflexâ€,justifyContent:â€œcenterâ€,padding:â€œ10px 0 0â€}}><div style={{width:â€œ36pxâ€,height:â€œ4pxâ€,background:dark?â€œrgba(255,255,255,0.15)â€:â€œrgba(60,60,67,0.15)â€,borderRadius:â€œ2pxâ€}}/></div>
<div style={{padding:â€œ12px 20px 12pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,justifyContent:â€œspace-betweenâ€,borderBottom:`1px solid ${dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.1)"}`}}>
<div>
<div style={{fontSize:â€œ21pxâ€,fontWeight:â€œ700â€,color:txt,letterSpacing:â€-0.4pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ8pxâ€}}>
{parseInt(kd)} {MONTHS[parseInt(km)-1]}
{isT&&<span style={{fontSize:â€œ12pxâ€,background:â€#FF3B30â€,color:â€#fffâ€,padding:â€œ2px 10pxâ€,borderRadius:â€œ10pxâ€,fontWeight:â€œ600â€}}>oggi</span>}
</div>
<div style={{fontSize:â€œ13pxâ€,color:sub,marginTop:â€œ2pxâ€}}>{events.length} {events.length===1?â€œeventoâ€:â€œeventiâ€}</div>
</div>
<button onClick={onAdd} style={{background:â€#007AFFâ€,color:â€#fffâ€,border:â€œnoneâ€,borderRadius:â€œ20pxâ€,padding:â€œ8px 18pxâ€,fontSize:â€œ14pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€}}>+ Aggiungi</button>
</div>
<div style={{overflowY:â€œautoâ€,flex:1,padding:â€œ12px 16pxâ€}}>
{events.length===0?(
<div style={{textAlign:â€œcenterâ€,padding:â€œ32px 0â€}}>
<div style={{fontSize:â€œ38pxâ€,marginBottom:â€œ8pxâ€}}>ğŸ“‹</div>
<div style={{color:sub,fontSize:â€œ15pxâ€,fontWeight:â€œ500â€}}>Nessun evento</div>
<div style={{color:dark?â€œrgba(255,255,255,0.2)â€:â€œrgba(60,60,67,0.25)â€,fontSize:â€œ13pxâ€,marginTop:â€œ4pxâ€}}>Tocca + Aggiungi</div>
</div>
):(
<div style={{background:card,borderRadius:â€œ14pxâ€,overflow:â€œhiddenâ€}}>
{events.map((ev,i)=>{
const c=getCat(ev.category);
const evDiff=daysBetween(dayKey);
const showAiBtn=ev.category===â€œverificaâ€||(ev.category===â€œcommissioneâ€&&ev.title?.includes(â€œspesaâ€));
return (
<div key={ev.id}>
<div style={{padding:â€œ12px 14pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ12pxâ€,borderBottom:`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`}}>
<div style={{width:â€œ10pxâ€,height:â€œ10pxâ€,borderRadius:â€œ50%â€,background:c.color,flexShrink:0}}/>
<div style={{flex:1,minWidth:0}}>
<div style={{fontWeight:â€œ500â€,fontSize:â€œ15pxâ€,color:txt,overflow:â€œhiddenâ€,textOverflow:â€œellipsisâ€,whiteSpace:â€œnowrapâ€}}>{ev.title}</div>
<div style={{fontSize:â€œ12pxâ€,color:sub,marginTop:â€œ2pxâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ6pxâ€}}>
<span>{c.label}{ev.time?` Â· ${ev.time}`:â€â€}</span>
{ev.category===â€œverificaâ€&&evDiff>0&&<span style={{background:â€#FF3B30â€,color:â€#fffâ€,borderRadius:â€œ6pxâ€,padding:â€œ1px 5pxâ€,fontSize:â€œ10pxâ€,fontWeight:â€œ700â€}}>-{evDiff}g</span>}
</div>
</div>
<button onClick={()=>onEdit(ev)} style={{background:â€œnoneâ€,border:â€œnoneâ€,cursor:â€œpointerâ€,color:sub,fontSize:â€œ15pxâ€,padding:â€œ4pxâ€}}>âœï¸</button>
<button onClick={()=>onDel(ev.id)} style={{background:â€œnoneâ€,border:â€œnoneâ€,cursor:â€œpointerâ€,color:dark?â€œrgba(255,255,255,0.2)â€:â€œrgba(60,60,67,0.2)â€,fontSize:â€œ20pxâ€,padding:â€œ4pxâ€}}>Ã—</button>
</div>
{/* AI buttons */}
{showAiBtn&&(
<div style={{padding:â€œ8px 14px 10pxâ€,display:â€œflexâ€,gap:â€œ8pxâ€,borderBottom:i<events.length-1?`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`:â€œnoneâ€}}>
{ev.category===â€œverificaâ€&&(
<button onClick={()=>{setAiEvent(ev);setAiType(â€œeserciziâ€);}} style={{padding:â€œ6px 12pxâ€,borderRadius:â€œ12pxâ€,border:â€œnoneâ€,background:â€œrgba(255,59,48,0.1)â€,color:â€#FF3B30â€,fontSize:â€œ12pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ4pxâ€}}>
ğŸ§  Ripasso AI
</button>
)}
{ev.category===â€œcommissioneâ€&&(ev.selectedSugg===â€œFare la spesaâ€||ev.title?.toLowerCase().includes(â€œspesaâ€))&&(
<button onClick={()=>{setAiEvent(ev);setAiType(â€œspesaâ€);}} style={{padding:â€œ6px 12pxâ€,borderRadius:â€œ12pxâ€,border:â€œnoneâ€,background:â€œrgba(52,199,89,0.1)â€,color:â€#34C759â€,fontSize:â€œ12pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€,display:â€œflexâ€,alignItems:â€œcenterâ€,gap:â€œ4pxâ€}}>
ğŸ›’ Lista spesa AI
</button>
)}
</div>
)}
</div>
);
})}
</div>
)}
</div>
</div>
</div>
{aiEvent&&aiType===â€œeserciziâ€&&<EserciziPanel event={aiEvent} onClose={()=>setAiEvent(null)}/>}
{aiEvent&&aiType===â€œspesaâ€&&<ListaSpesaPanel event={aiEvent} onClose={()=>setAiEvent(null)}/>}
</>
);
}

// â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App(){
const [pref,setPref]=useState(loadPref);
const [year,setYear]=useState(today.getFullYear());
const [month,setMonth]=useState(today.getMonth());
const [events,setEvents]=useState(loadEv);
const [selDay,setSelDay]=useState(null);
const [showModal,setShowModal]=useState(false);
const [editEv,setEditEv]=useState(null);
const [view,setView]=useState(â€œmonthâ€);
const [fCat,setFCat]=useState(null);
const [showAl,setShowAl]=useState(false);
const meteo=useMeteo();
const dark=pref.dark;

const toggleDark=()=>{const np={â€¦pref,dark:!dark};setPref(np);savePref(np);document.body.className=np.dark?â€œdarkâ€:â€œlightâ€;};
useEffect(()=>{document.body.className=dark?â€œdarkâ€:â€œlightâ€;},[dark]);
useEffect(()=>{saveEv(events)},[events]);
useEffect(()=>{const a=getAlerts(events);if(a.length>0)setTimeout(()=>setShowAl(true),700);},[]);

const alerts=getAlerts(events);
const getDay=k=>events[k]||[];
const handleSave=ev=>{setEvents(p=>{const d=p[selDay]||[];if(editEv)return{â€¦p,[selDay]:d.map(e=>e.id===ev.id?ev:e)};return{â€¦p,[selDay]:[â€¦d,ev]};});};
const delEv=(k,id)=>setEvents(p=>({â€¦p,[k]:(p[k]||[]).filter(e=>e.id!==id)}));

const bg=dark?â€#000â€:â€#fffâ€;
const bgSub=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;
const txt=dark?â€#fffâ€:â€#1C1C1Eâ€;
const sub=dark?â€œrgba(255,255,255,0.35)â€:â€œrgba(60,60,67,0.45)â€;
const border=dark?â€œrgba(255,255,255,0.08)â€:â€œrgba(60,60,67,0.1)â€;
const card=dark?â€#1C1C1Eâ€:â€#F2F2F7â€;

const totM=Object.entries(events).filter(([k])=>k.startsWith(`${year}-${String(month+1).padStart(2,'0')}`)).flatMap(([,e])=>e).length;
const allEv=Object.entries(events).flatMap(([day,evs])=>evs.map(e=>({â€¦e,day}))).filter(e=>e.day.startsWith(String(year))).filter(e=>!fCat||e.category===fCat).sort((a,b)=>a.day.localeCompare(b.day));
const upcoming=Object.entries(events).flatMap(([day,evs])=>evs.map(e=>({â€¦e,day}))).filter(e=>e.day>=todayStr).sort((a,b)=>a.day.localeCompare(b.day)).slice(0,5);
const wDays=Array.from({length:7},(_,i)=>{const d=new Date(),dow=d.getDay()===0?6:d.getDay()-1,dd=new Date(d);dd.setDate(d.getDate()-dow+i);return dd;});

return (
<ThemeCtx.Provider value={{dark,toggle:toggleDark}}>
<div style={{fontFamily:â€-apple-system,â€˜SF Pro Textâ€™,â€˜Helvetica Neueâ€™,sans-serifâ€,background:bg,height:â€œ100vhâ€,maxWidth:â€œ430pxâ€,margin:â€œ0 autoâ€,display:â€œflexâ€,flexDirection:â€œcolumnâ€,overflow:â€œhiddenâ€,transition:â€œbackground 0.3s,color 0.3sâ€}}>

```
  {/* HEADER */}
  <div style={{background:dark?"rgba(0,0,0,0.95)":"rgba(255,255,255,0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",paddingTop:"env(safe-area-inset-top,44px)",flexShrink:0,borderBottom:`1px solid ${border}`}}>
    <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px 6px"}}>
      <div style={{display:"flex",alignItems:"center",gap:"6px"}}>
        <button className="tap" onClick={()=>{const n=addMonths(year,month,-1);setYear(n.year);setMonth(n.month);}} style={{background:"none",border:"none",cursor:"pointer",fontSize:"24px",color:"#007AFF",padding:"2px 6px",lineHeight:1}}>â€¹</button>
        {/* Meteo */}
        {meteo&&<div style={{fontSize:"13px",color:sub,display:"flex",alignItems:"center",gap:"3px"}}><span>{meteo.icon}</span><span>{meteo.temp}Â°</span></div>}
      </div>
      <button onClick={()=>{setYear(today.getFullYear());setMonth(today.getMonth());}} style={{background:"none",border:"none",cursor:"pointer",textAlign:"center",padding:"2px 8px"}}>
        <div style={{fontSize:"17px",fontWeight:"700",color:txt,letterSpacing:"-0.3px",lineHeight:1}}>{MONTHS[month]} {year}</div>
        {totM>0&&<div style={{fontSize:"11px",color:sub,marginTop:"1px"}}>{totM} eventi</div>}
      </button>
      <div style={{display:"flex",alignItems:"center",gap:"2px"}}>
        <button className="tap" onClick={toggleDark} style={{background:"none",border:"none",cursor:"pointer",padding:"2px 6px",fontSize:"18px"}}>{dark?"â˜€ï¸":"ğŸŒ™"}</button>
        <button className="tap" onClick={()=>setShowAl(true)} style={{background:"none",border:"none",cursor:"pointer",padding:"2px 6px",position:"relative"}}>
          <span style={{fontSize:"18px"}}>ğŸ””</span>
          {alerts.length>0&&<div style={{position:"absolute",top:"-2px",right:"2px",minWidth:"15px",height:"15px",background:"#FF3B30",borderRadius:"8px",fontSize:"9px",color:"#fff",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 3px",border:`1.5px solid ${bg}`}}>{alerts.length}</div>}
        </button>
        <button className="tap" onClick={()=>{const n=addMonths(year,month,1);setYear(n.year);setMonth(n.month);}} style={{background:"none",border:"none",cursor:"pointer",fontSize:"24px",color:"#007AFF",padding:"2px 6px",lineHeight:1}}>â€º</button>
      </div>
    </div>
    <div style={{display:"flex",padding:"0 16px"}}>
      {[["month","Calendario"],["list","Lista"]].map(([v,l])=>(
        <button key={v} onClick={()=>setView(v)} style={{flex:1,padding:"6px 0 8px",border:"none",background:"transparent",fontFamily:"inherit",fontSize:"13px",fontWeight:view===v?"600":"400",color:view===v?"#007AFF":sub,cursor:"pointer",borderBottom:view===v?"2px solid #007AFF":"2px solid transparent",transition:"all 0.2s"}}>{l}</button>
      ))}
    </div>
  </div>

  {/* CONTENT */}
  <div style={{flex:1,overflowY:"auto",paddingBottom:"80px"}}>
    {view==="month"&&(
      <div>
        <div style={{padding:"8px 8px 4px"}}>
          <SwipeCalendar year={year} month={month} events={events} alerts={alerts}
            onDay={setSelDay} onMonthChange={(y,m)=>{setYear(y);setMonth(m);}}/>
        </div>

        {upcoming.length>0&&(
          <div style={{padding:"0 12px",marginTop:"8px"}}>
            <div style={{fontSize:"11px",fontWeight:"600",color:sub,letterSpacing:"0.06em",marginBottom:"8px",paddingLeft:"4px"}}>PROSSIMI EVENTI</div>
            <div style={{background:dark?"#1C1C1E":"#F2F2F7",borderRadius:"14px",overflow:"hidden"}}>
              {upcoming.map((ev,i)=>{
                const c=getCat(ev.category),d=daysBetween(ev.day),[,em,ed]=ev.day.split("-");
                return (
                  <div key={`${ev.day}-${ev.id}`} className="tap" onClick={()=>setSelDay(ev.day)} style={{padding:"10px 14px",display:"flex",alignItems:"center",gap:"12px",cursor:"pointer",borderBottom:i<upcoming.length-1?`1px solid ${border}`:"none",background:dark?"#2C2C2E":"#fff"}}>
                    <div style={{width:"32px",height:"32px",borderRadius:"8px",background:c.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                      <div style={{fontSize:"13px",fontWeight:"700",color:c.color,lineHeight:1}}>{parseInt(ed)}</div>
                      <div style={{fontSize:"8px",color:c.color,fontWeight:"500"}}>{MONTHS_S[parseInt(em)-1]}</div>
                    </div>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontWeight:"500",fontSize:"14px",color:txt,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                      <div style={{fontSize:"11px",color:sub,marginTop:"1px",display:"flex",alignItems:"center",gap:"5px"}}>
                        {d===0?<span style={{color:c.color,fontWeight:"600"}}>Oggi</span>:d===1?<span style={{color:"#FF9500",fontWeight:"600"}}>Domani</span>:<span>{c.label}</span>}
                        {ev.time&&` Â· ${ev.time}`}
                        {ev.category==="verifica"&&d>0&&d<=15&&<span style={{background:"#FF3B30",color:"#fff",borderRadius:"5px",padding:"1px 5px",fontSize:"10px",fontWeight:"700"}}>-{d}g</span>}
                      </div>
                    </div>
                    <span style={{color:sub,fontSize:"14px"}}>â€º</span>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        <div style={{margin:"10px 12px 0",background:dark?"#1C1C1E":"#F2F2F7",borderRadius:"14px",padding:"12px 14px"}}>
          <div style={{fontSize:"10px",fontWeight:"600",color:sub,letterSpacing:"0.06em",marginBottom:"8px"}}>CATEGORIE</div>
          <div style={{display:"flex",flexWrap:"wrap",gap:"6px 18px"}}>
            {CATS.map(c=><div key={c.id} style={{display:"flex",alignItems:"center",gap:"5px"}}><div style={{width:"7px",height:"7px",borderRadius:"50%",background:c.color}}/><span style={{fontSize:"12px",color:sub}}>{c.label}</span></div>)}
          </div>
        </div>
      </div>
    )}

    {view==="list"&&(
      <div style={{padding:"12px"}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"}}>
          <button className="tap" onClick={()=>setYear(y=>y-1)} style={{background:"none",border:"none",fontSize:"22px",color:"#007AFF",cursor:"pointer",padding:"4px 10px"}}>â€¹</button>
          <span style={{fontSize:"17px",fontWeight:"700",color:txt}}>{year}</span>
          <button className="tap" onClick={()=>setYear(y=>y+1)} style={{background:"none",border:"none",fontSize:"22px",color:"#007AFF",cursor:"pointer",padding:"4px 10px"}}>â€º</button>
        </div>
        <div style={{display:"flex",gap:"6px",overflowX:"auto",paddingBottom:"4px",marginBottom:"12px"}}>
          <button onClick={()=>setFCat(null)} style={{padding:"5px 14px",borderRadius:"20px",border:"none",flexShrink:0,background:!fCat?"#007AFF":dark?"#2C2C2E":"#F2F2F7",color:!fCat?"#fff":sub,fontSize:"13px",fontWeight:"500",cursor:"pointer",fontFamily:"inherit"}}>Tutti</button>
          {CATS.map(c=><button key={c.id} onClick={()=>setFCat(fCat===c.id?null:c.id)} style={{padding:"5px 12px",borderRadius:"20px",border:"none",flexShrink:0,background:fCat===c.id?c.color:dark?"#2C2C2E":"#F2F2F7",color:fCat===c.id?"#fff":c.color,fontSize:"13px",fontWeight:"500",cursor:"pointer",fontFamily:"inherit"}}>{c.emoji} {c.label}</button>)}
        </div>
        {allEv.length===0?(
          <div style={{textAlign:"center",padding:"50px 0"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>ğŸ“‹</div><div style={{color:sub,fontSize:"15px"}}>Nessun evento</div></div>
        ):(
          <div style={{background:dark?"#1C1C1E":"#fff",borderRadius:"14px",overflow:"hidden"}}>
            {allEv.map((ev,i)=>{
              const c=getCat(ev.category),[,em,ed]=ev.day.split("-"),d=daysBetween(ev.day);
              return (
                <div key={`${ev.day}-${ev.id}`} style={{padding:"11px 14px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<allEv.length-1?`1px solid ${border}`:"none"}}>
                  <div style={{width:"32px",height:"32px",borderRadius:"8px",background:c.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                    <div style={{fontSize:"13px",fontWeight:"700",color:c.color,lineHeight:1}}>{parseInt(ed)}</div>
                    <div style={{fontSize:"8px",color:c.color,fontWeight:"500"}}>{MONTHS_S[parseInt(em)-1]}</div>
                  </div>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontWeight:"500",fontSize:"14px",color:txt,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                    <div style={{fontSize:"11px",color:sub,marginTop:"1px",display:"flex",alignItems:"center",gap:"5px"}}>
                      <span>{c.label}{ev.time?` Â· ${ev.time}`:""}</span>
                      {ev.category==="verifica"&&d>0&&d<=15&&<span style={{background:"#FF3B30",color:"#fff",borderRadius:"5px",padding:"1px 5px",fontSize:"10px",fontWeight:"700"}}>-{d}g</span>}
                    </div>
                  </div>
                  <button onClick={()=>delEv(ev.day,ev.id)} style={{background:"none",border:"none",cursor:"pointer",color:sub,fontSize:"20px",padding:"4px"}}>Ã—</button>
                </div>
              );
            })}
          </div>
        )}
      </div>
    )}
  </div>

  {/* BOTTOM WEEK */}
  <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:"430px",background:dark?"rgba(0,0,0,0.95)":"rgba(255,255,255,0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:`1px solid ${border}`,padding:"6px 10px env(safe-area-inset-bottom,16px)",zIndex:150}}>
    <div style={{display:"flex",justifyContent:"space-between"}}>
      {wDays.map((d,i)=>{
        const key=fmt(d.getFullYear(),d.getMonth(),d.getDate()),evs=getDay(key),isT=key===todayStr,hasAl=alerts.some(a=>a.day===key);
        return (
          <div key={i} className="tap" onClick={()=>setSelDay(key)} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"3px 1px",cursor:"pointer",position:"relative"}}>
            {hasAl&&!isT&&<div style={{position:"absolute",top:"0",right:"4px",width:"5px",height:"5px",borderRadius:"50%",background:"#FF3B30"}}/>}
            <div style={{fontSize:"10px",fontWeight:"500",color:isT?"#FF3B30":sub,marginBottom:"3px"}}>{DAYS[i]}</div>
            <div style={{width:"30px",height:"30px",borderRadius:"50%",background:isT?"#FF3B30":"transparent",display:"flex",alignItems:"center",justifyContent:"center"}}>
              <div style={{fontSize:"15px",fontWeight:isT?"700":"400",color:isT?"#fff":i>=5?"#FF9500":txt}}>{d.getDate()}</div>
            </div>
            <div style={{width:"4px",height:"4px",borderRadius:"50%",marginTop:"2px",background:evs.length>0?(isT?"rgba(255,255,255,0.8)":getCat(evs[0].category).color):"transparent"}}/>
          </div>
        );
      })}
    </div>
  </div>

  {showAl&&<AlertsPanel alerts={alerts} onClose={()=>setShowAl(false)} onGo={day=>{setSelDay(day);setMonth(parseInt(day.split("-")[1])-1);setYear(parseInt(day.split("-")[0]));setView("month");}}/>}
  {selDay&&!showModal&&!showAl&&<DaySheet dayKey={selDay} events={getDay(selDay)} onAdd={()=>{setEditEv(null);setShowModal(true)}} onEdit={ev=>{setEditEv(ev);setShowModal(true)}} onDel={id=>delEv(selDay,id)} onClose={()=>setSelDay(null)}/>}
  {showModal&&selDay&&<Modal dayKey={selDay} onClose={()=>setShowModal(false)} onSave={handleSave} editEvent={editEv}/>}
</div>
</ThemeCtx.Provider>
```

);
}

const BK={background:â€œnoneâ€,border:â€œnoneâ€,cursor:â€œpointerâ€,fontFamily:â€œinheritâ€,fontSize:â€œ15pxâ€,padding:â€œ0 0 14px 0â€,display:â€œblockâ€};
const LB={display:â€œblockâ€,fontSize:â€œ11pxâ€,fontWeight:â€œ600â€,padding:â€œ10px 0 0â€,textTransform:â€œuppercaseâ€,letterSpacing:â€œ0.05emâ€};
const IP={width:â€œ100%â€,padding:â€œ8px 0 12pxâ€,border:â€œnoneâ€,fontSize:â€œ16pxâ€,fontFamily:â€œinheritâ€,outline:â€œnoneâ€,background:â€œtransparentâ€,display:â€œblockâ€};
const BB={width:â€œ100%â€,padding:â€œ15pxâ€,borderRadius:â€œ14pxâ€,border:â€œnoneâ€,fontFamily:â€œinheritâ€,fontSize:â€œ16pxâ€,fontWeight:â€œ600â€,cursor:â€œpointerâ€,transition:â€œall 0.15sâ€,color:â€#fffâ€};

ReactDOM.createRoot(document.getElementById(â€˜rootâ€™)).render(<App/>);
</script>

</body>
</html>
