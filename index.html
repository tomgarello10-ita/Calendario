<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#ffffff"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="Il Mio Anno"/>
  <title>Il Mio Anno</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
    html,body{height:100%;overflow:hidden}
    body{font-family:-apple-system,'SF Pro Text','Helvetica Neue',sans-serif;overscroll-behavior:none;transition:background 0.3s,color 0.3s}
    body.dark{background:#000;color:#fff}
    body.light{background:#fff;color:#1C1C1E}
    ::-webkit-scrollbar{display:none}
    input,textarea{-webkit-appearance:none;user-select:text;font-family:inherit}
    *{user-select:none}
    @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
    .tap:active{opacity:0.45}
    .spin{animation:spin 1s linear infinite}
    .pulse{animation:pulse 1.5s ease infinite}
  </style>
</head>
<body class="light">
<div id="root" style="height:100%"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback} = React;

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ThemeCtx = React.createContext({dark:false,toggle:()=>{}});

const MONTHS=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];
const MONTHS_S=["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"];
const DAYS=["L","M","M","G","V","S","D"];

const CATS=[
  {id:"verifica",    label:"Verifica",    emoji:"ğŸ“",color:"#FF3B30",bg:"rgba(255,59,48,0.1)"},
  {id:"compleanno",  label:"Compleanno",  emoji:"ğŸ‚",color:"#FF9500",bg:"rgba(255,149,0,0.1)"},
  {id:"commissione", label:"Commissione", emoji:"ğŸ›’",color:"#34C759",bg:"rgba(52,199,89,0.1)"},
  {id:"appuntamento",label:"Appuntamento",emoji:"ğŸ¥",color:"#007AFF",bg:"rgba(0,122,255,0.1)"},
  {id:"todo",        label:"Da fare",     emoji:"âœ…",color:"#AF52DE",bg:"rgba(175,82,222,0.1)"},
];
const getCat=id=>CATS.find(c=>c.id===id)||CATS[4];

const MATERIE=[
  {id:"matematica",label:"Matematica",emoji:"ğŸ“"},{id:"italiano",label:"Italiano",emoji:"ğŸ“–"},
  {id:"storia",label:"Storia",emoji:"ğŸ›ï¸"},{id:"scienze",label:"Scienze",emoji:"ğŸ”¬"},
  {id:"inglese",label:"Inglese",emoji:"ğŸ‡¬ğŸ‡§"},{id:"fisica",label:"Fisica",emoji:"âš¡"},
  {id:"chimica",label:"Chimica",emoji:"ğŸ§ª"},{id:"geografia",label:"Geografia",emoji:"ğŸŒ"},
  {id:"arte",label:"Arte",emoji:"ğŸ¨"},{id:"musica",label:"Musica",emoji:"ğŸµ"},
  {id:"filosofia",label:"Filosofia",emoji:"ğŸ¤”"},{id:"informatica",label:"Informatica",emoji:"ğŸ’»"},
  {id:"ed_fisica",label:"Ed. Fisica",emoji:"âš½"},{id:"latino",label:"Latino",emoji:"ğŸ“œ"},
  {id:"altra",label:"Altra",emoji:"ğŸ“š"},
];

const TIPI=["Scritto","Orale","Test","Compito","Presentazione"];

const today=new Date();
const todayStr=fmt(today.getFullYear(),today.getMonth(),today.getDate());
function fmt(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`}
function daysIn(y,m){return new Date(y,m+1,0).getDate()}
function firstDay(y,m){const d=new Date(y,m,1).getDay();return d===0?6:d-1}
function addMonths(y,m,delta){let nm=m+delta,ny=y;while(nm>11){nm-=12;ny++;}while(nm<0){nm+=12;ny--;}return{year:ny,month:nm};}
function daysBetween(s){const[y,m,d]=s.split("-").map(Number);return Math.round((new Date(y,m-1,d)-new Date(today.getFullYear(),today.getMonth(),today.getDate()))/(864e5))}

const SK="ilmioanno_v6";
function loadEv(){try{return JSON.parse(localStorage.getItem(SK))||{}}catch{return{}}}
function saveEv(e){try{localStorage.setItem(SK,JSON.stringify(e))}catch{}}
function loadPref(){try{return JSON.parse(localStorage.getItem(SK+"_pref"))||{dark:false}}catch{return{dark:false}}}
function savePref(p){try{localStorage.setItem(SK+"_pref",JSON.stringify(p))}catch{}}

function getAlerts(ev){
  const a=[];
  Object.entries(ev).forEach(([day,evs])=>evs.forEach(e=>{
    const d=daysBetween(day),c=getCat(e.category);
    if(e.category==="verifica"){
      if(d===15)a.push({e,day,d,msg:"Inizia a ripassare!",u:"low",icon:"ğŸ“–"});
      else if(d===10)a.push({e,day,d,msg:"Ripassa con costanza",u:"medium",icon:"ğŸ“š"});
      else if(d===5)a.push({e,day,d,msg:"Ultimi giorni!",u:"high",icon:"âš¡"});
      else if(d===2)a.push({e,day,d,msg:"Dopodomani! Rivedi tutto",u:"high",icon:"ğŸ”¥"});
      else if(d===1)a.push({e,day,d,msg:"DOMANI! Sei pronto?",u:"urgent",icon:"ğŸš¨"});
      else if(d===0)a.push({e,day,d,msg:"OGGI! In bocca al lupo!",u:"urgent",icon:"ğŸ¯"});
    } else if(e.category==="compleanno"){
      if(d===7)a.push({e,day,d,msg:"Tra una settimana!",u:"low",icon:"ğŸ"});
      else if(d===3)a.push({e,day,d,msg:"Tra 3 giorni!",u:"medium",icon:"ğŸ‚"});
      else if(d===1)a.push({e,day,d,msg:"DOMANI! Non dimenticare!",u:"high",icon:"ğŸ‰"});
      else if(d===0)a.push({e,day,d,msg:"OGGI Ã¨ il compleanno! ğŸ¥³",u:"urgent",icon:"ğŸ‚"});
    } else {
      if(d===3)a.push({e,day,d,msg:"Tra 3 giorni",u:"low",icon:c.emoji});
      else if(d===1)a.push({e,day,d,msg:"DOMANI! Non dimenticare",u:"high",icon:"â°"});
      else if(d===0)a.push({e,day,d,msg:"OGGI!",u:"urgent",icon:"ğŸ””"});
    }
  }));
  const o={urgent:0,high:1,medium:2,low:3};
  return a.sort((a,b)=>o[a.u]-o[b.u]);
}

// â”€â”€ AI CALL (Gemini) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ SISTEMA RIPASSO OFFLINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RIPASSO_DB={
  matematica:{
    esercizi_base:[
      "Risolvi: 2xÂ² - 5x + 3 = 0",
      "Risolvi il sistema: { 2x + y = 7 / x - y = 2 }",
      "Calcola l'area di un triangolo con base 8cm e altezza 5cm",
      "Semplifica la frazione: 36/48",
      "Risolvi: 3(x - 2) = 2x + 4",
      "Calcola: (2Â³ Ã— 4Â²) Ã· 2â´",
      "Trova il MCD e mcm di 12 e 18",
      "Risolvi la proporzione: 3 : x = 6 : 10"
    ],
    esercizi_avanzati:[
      "Studia il segno di: f(x) = xÂ² - 4x + 3",
      "Calcola il discriminante e le soluzioni di: xÂ² + 3x - 10 = 0",
      "Dimostra che la diagonale di un quadrato di lato 'a' Ã¨ aâˆš2",
      "Risolvi: |2x - 1| < 5",
      "Dato un cerchio di raggio 6, calcola area e circonferenza"
    ],
    teoria:["Ripassa le formule quadratiche","Studia i teoremi sulle figure piane","Rileggi le proprietÃ  delle potenze"],
    tips:["Sostituisci sempre per verificare","Disegna prima di calcolare","Controlla il segno del discriminante"]
  },
  italiano:{
    esercizi_base:[
      "Analizza grammaticalmente: 'Il gatto grigio dorme sul divano morbido'",
      "Individua soggetto, predicato e complementi in: 'Maria ha regalato un libro alla sua amica'",
      "Scrivi il contrario di: felice, lento, caldo, grande, chiaro",
      "Trasforma al passivo: 'Il professore spiega la lezione agli studenti'",
      "Trova le figure retoriche in: 'Il mare era una lastra di acciaio lucente'",
      "Dividi in sillabe: straordinario, psicologia, aeroplano, scienza",
      "Scrivi 3 sinonimi per: bello, camminare, dire, paura"
    ],
    esercizi_avanzati:[
      "Analisi del periodo: 'Sebbene fosse stanco, continuÃ² a lavorare finchÃ© non finÃ¬ il progetto'",
      "Scrivi un testo argomentativo di 15 righe su: 'I social media fanno piÃ¹ bene o male?'",
      "Commenta questa metafora: 'La vita Ã¨ un viaggio senza mappa'",
      "Trasforma dal discorso diretto all'indiretto: 'Marco disse: Vengo domani alla festa'"
    ],
    teoria:["Ripassa le congiunzioni subordinanti","Studia le figure retoriche principali","Rileggi la struttura del testo argomentativo"],
    tips:["Leggi le frasi ad alta voce","Fai schemi per i periodi complessi","Usa la matita per segnare gli elementi"]
  },
  storia:{
    esercizi_base:[
      "Metti in ordine cronologico: Rivoluzione Francese, Prima Guerra Mondiale, Rivoluzione Industriale, Caduta dell'Impero Romano",
      "Scrivi 3 cause della Prima Guerra Mondiale",
      "Chi era Napoleone Bonaparte? Scrivi 5 informazioni chiave",
      "In quale anno cadde il Muro di Berlino? E cosa rappresentava?",
      "Collega: Mussolini â†’ __, Hitler â†’ __, Stalin â†’ __ (fascismo/nazismo/comunismo)",
      "Quali paesi formavano la Triplice Alleanza nel 1914?",
      "Quando e dove fu firmata la Dichiarazione d'Indipendenza americana?"
    ],
    esercizi_avanzati:[
      "Confronta la Rivoluzione Francese e quella Americana: somiglianze e differenze",
      "Spiega il concetto di 'imperialismo' e fai 2 esempi storici",
      "Analizza le conseguenze del Trattato di Versailles sulla Germania",
      "PerchÃ© scoppiÃ² la Seconda Guerra Mondiale? Elenca le 4 cause principali"
    ],
    teoria:["Ripassa le date fondamentali del programma","Studia i personaggi chiave","Rileggi le mappe geografiche storiche"],
    tips:["Usa una linea del tempo visiva","Collega sempre causa â†’ evento â†’ conseguenza","Impara le date associandole a eventi memorabili"]
  },
  scienze:{
    esercizi_base:[
      "Descrivi le fasi della mitosi in ordine",
      "Qual Ã¨ la differenza tra cellula procariota ed eucariota?",
      "Completa: La fotosintesi produce ___ e ___ usando ___ e ___",
      "Elenca i 5 regni degli esseri viventi con un esempio per ciascuno",
      "Descrivi il ciclo dell'acqua in 4 fasi",
      "Qual Ã¨ la funzione di: nucleo, mitocondri, membrana cellulare?",
      "Differenza tra DNA e RNA: scrivi 3 differenze"
    ],
    esercizi_avanzati:[
      "Spiega la legge di Mendel usando l'esempio dei piselli",
      "Descrivi il processo di respirazione cellulare aerobica",
      "Cosa sono gli enzimi? Spiega il loro meccanismo d'azione",
      "Confronta fotosintesi e respirazione cellulare"
    ],
    teoria:["Ripassa i processi cellulari","Studia la classificazione degli organismi","Rileggi i cicli biogeochimici"],
    tips:["Disegna sempre gli schemi delle cellule","Collega struttura â†’ funzione","Usa flashcard per i termini scientifici"]
  },
  inglese:{
    esercizi_base:[
      "Metti i verbi al Past Simple: go, eat, write, run, have, see, make, take",
      "Trasforma al Present Perfect: 'I eat pizza' â†’ 'I ___ already ___ pizza'",
      "Scrivi le domande per: 'She works in Milan' / 'They went to Paris last year'",
      "Traduci: 'Se studiassi di piÃ¹, prenderesti voti migliori'",
      "Completa con la forma corretta: 'If I ___ (be) you, I ___ (study) more'",
      "Scrivi 5 frasi usando il Passive Voice al Present Simple",
      "Trasforma in reported speech: 'Tom said: I will call you tomorrow'"
    ],
    esercizi_avanzati:[
      "Scrivi un'email formale (100 parole) per candidarti a un lavoro",
      "Analizza il testo e rispondi: 'What is the main idea? What does the author imply?'",
      "Completa i phrasal verbs: give ___, take ___, look ___, put ___",
      "Scrivi un paragrafo con: although, however, therefore, in addition"
    ],
    teoria:["Ripassa i tempi verbali con esempi","Studia i connettori discorsivi","Rileggi le strutture condizionali"],
    tips:["Leggi le frasi ad alta voce per la pronuncia","Impara i phrasal verbs in contesto","Guarda video in inglese durante le pause"]
  },
  fisica:{
    esercizi_base:[
      "Un'auto percorre 150 km in 2 ore. Calcola la velocitÃ  media",
      "Calcola la forza necessaria per accelerare una massa di 5 kg a 3 m/sÂ²",
      "Un oggetto di 2 kg Ã¨ a 10 m di altezza. Calcola la sua energia potenziale (g=10 m/sÂ²)",
      "Applica la legge di Ohm: V=12V, R=4Î©, calcola I",
      "Converti: 72 km/h in m/s",
      "Un corpo cade da 20 m di altezza. Dopo quanto tempo tocca terra? (g=10 m/sÂ²)",
      "Calcola il peso di un oggetto di massa 8 kg"
    ],
    esercizi_avanzati:[
      "Un proiettile viene lanciato a 20 m/s. Calcola spazio e tempo per fermarsi (a=-4 m/sÂ²)",
      "Due cariche di +3Î¼C e -2Î¼C sono a 0,3 m. Calcola la forza elettrostatica",
      "Un circuito ha R1=6Î© e R2=3Î© in parallelo con V=12V. Calcola la resistenza totale e la corrente",
      "Enuncia e applica il principio di conservazione dell'energia in un esempio"
    ],
    teoria:["Ripassa le formule con le unitÃ  di misura","Studia le leggi fondamentali","Rileggi i grafici spazio-tempo e velocitÃ -tempo"],
    tips:["Scrivi SEMPRE le unitÃ  di misura","Disegna il diagramma delle forze","Controlla che il risultato abbia senso fisico"]
  },
  chimica:{
    esercizi_base:[
      "Scrivi la formula di: ossido di calcio, cloruro di sodio, acido solforico, idrossido di ferro(III)",
      "Bilancia: Hâ‚‚ + Oâ‚‚ â†’ Hâ‚‚O",
      "Bilancia: Fe + HCl â†’ FeClâ‚‚ + Hâ‚‚",
      "Quante moli ci sono in 44g di COâ‚‚? (M=44 g/mol)",
      "Qual Ã¨ il numero atomico e di massa del Carbonio? Quanti protoni, neutroni ed elettroni ha?",
      "Indica il gruppo e il periodo di: Na, Cl, Fe, O nella tavola periodica",
      "Scrivi la configurazione elettronica di: H, C, O, Na"
    ],
    esercizi_avanzati:[
      "Calcola la massa di NaCl necessaria per preparare 500 mL di soluzione 0,5 M",
      "Bilancia e classifica la reazione: CaCOâ‚ƒ â†’ CaO + COâ‚‚",
      "Spiega la differenza tra legame covalente polare e apolare con esempi",
      "Calcola il pH di una soluzione di HCl 0,01 M"
    ],
    teoria:["Ripassa la tavola periodica (gruppi e periodi)","Studia i tipi di legame chimico","Rileggi come bilanciare le equazioni"],
    tips:["Memorizza i simboli dei primi 20 elementi","Bilancia sempre atomo per atomo","Usa i coefficienti, non i pedici, per bilanciare"]
  },
  geografia:{
    esercizi_base:[
      "Indica su una mappa: i 5 oceani e i 7 continenti",
      "Qual Ã¨ la capitale di: Germania, Brasile, Australia, Giappone, Egitto?",
      "Descrivi il clima mediterraneo: caratteristiche, zone, vegetazione tipica",
      "Ordina per popolazione: Cina, India, USA, Indonesia, Brasile",
      "Cos'Ã¨ la densitÃ  di popolazione? Calcola quella di un paese con 60M abitanti e 300.000 kmÂ²",
      "Nomina i 3 fiumi piÃ¹ lunghi del mondo con i continenti in cui si trovano",
      "Differenza tra clima e tempo meteorologico: spiega con un esempio"
    ],
    esercizi_avanzati:[
      "Spiega il fenomeno El NiÃ±o e le sue conseguenze globali",
      "Analizza le cause dello spopolamento delle aree rurali italiane",
      "Confronta la densitÃ  demografica di Europa e Africa",
      "Descrivi la struttura interna della Terra e le sue conseguenze geologiche"
    ],
    teoria:["Ripassa le cartine fisiche e politiche","Studia i dati demografici principali","Rileggi i fenomeni climatici"],
    tips:["Studia SEMPRE con la cartina davanti","Collega geografia a storia ed economia","Usa mnemotecniche per le capitali"]
  },
  filosofia:{
    esercizi_base:[
      "Chi Ã¨ Socrate? Spiega il metodo maieutico in 5 righe",
      "Qual Ã¨ la differenza tra empirismo e razionalismo? Fai un esempio per ciascuno",
      "Riassumi la teoria delle Idee di Platone",
      "Cos'Ã¨ l'imperativo categorico di Kant? Fai un esempio pratico",
      "Spiega la dialettica hegeliana (tesi-antitesi-sintesi) con un esempio",
      "Chi Ã¨ Aristotele? Elenca 3 sue opere e i temi principali",
      "Differenza tra etica deontologica e consequenzialista"
    ],
    esercizi_avanzati:[
      "Confronta il pensiero di Platone e Aristotele sull'anima",
      "Analizza il pensiero di Nietzsche: volontÃ  di potenza e oltreuomo",
      "Spiega il problema mente-corpo nella filosofia moderna",
      "Commenta: 'Cogito ergo sum' di Cartesio â€” cosa significa e perchÃ© Ã¨ importante?"
    ],
    teoria:["Ripassa i filosofi per periodo storico","Studia i concetti chiave di ogni corrente","Rileggi le citazioni piÃ¹ famose"],
    tips:["Collega ogni filosofo al suo contesto storico","Spiega i concetti con esempi concreti","Fai schemi comparativi tra filosofi"]
  },
  latino:{
    esercizi_base:[
      "Declina al singolare e plurale: 'puella' (1Âª decl.) e 'dominus' (2Âª decl.)",
      "Coniuga 'amare' all'indicativo presente attivo (tutte le persone)",
      "Traduci: 'Puella in horto ambulat et flores videt'",
      "Indica il caso di ogni parola: 'Magistro discipuli libros dant'",
      "Trasforma dal singolare al plurale: 'Filius patri epistulam scribit'",
      "Riconosci le proposizioni in: 'Dico te errare quia multa ignoras'",
      "Coniuga 'esse' all'indicativo presente e imperfetto"
    ],
    esercizi_avanzati:[
      "Traduci e analizza: 'Caesar, postquam hostes vicit, Romam rediit'",
      "Individua e spiega l'ablativo assoluto in: 'Sole oriente, milites profecti sunt'",
      "Trasforma dalla proposizione infinitiva alla completiva con 'ut'",
      "Coniuga un verbo deponente (es. 'loquor') all'indicativo perfetto"
    ],
    teoria:["Ripassa tutte le declinazioni","Studia i tempi e modi verbali","Rileggi la sintassi dei casi"],
    tips:["Impara le desinenze come una tabella","Analizza prima di tradurre","Cerca i falsi amici con l'italiano"]
  },
  informatica:{
    esercizi_base:[
      "Converti il numero decimale 42 in binario",
      "Scrivi uno pseudocodice che calcola la somma dei numeri da 1 a 100",
      "Cosa fa questo codice? for i in range(5): print(i*2)",
      "Disegna il diagramma di flusso per: 'Leggi un numero, se Ã¨ pari stampa PARI altrimenti DISPARI'",
      "Qual Ã¨ la differenza tra RAM e ROM?",
      "Scrivi la query SQL per selezionare tutti gli studenti con voto > 7",
      "Cos'Ã¨ un algoritmo? Scrivi quello per fare una tazza di tÃ¨"
    ],
    esercizi_avanzati:[
      "Scrivi una funzione ricorsiva per calcolare il fattoriale di n",
      "Spiega la differenza tra lista e dizionario in Python con esempi",
      "Analizza la complessitÃ  di un algoritmo di ricerca lineare",
      "Scrivi una JOIN tra due tabelle: Studenti e Voti in SQL"
    ],
    teoria:["Ripassa i concetti di base dell'architettura","Studia i costrutti del linguaggio","Rileggi la teoria degli algoritmi"],
    tips:["Testa sempre il codice step by step","Usa i commenti per capire la logica","Parti da casi semplici e poi complica"]
  },
  arte:{
    esercizi_base:[
      "Descrivi la Gioconda di Leonardo: tecnica, soggetto, dettagli particolari",
      "Elenca le caratteristiche principali del Rinascimento italiano",
      "Chi Ã¨ Caravaggio? Spiega la tecnica del chiaroscuro con un suo dipinto",
      "Differenza tra Impressionismo e Post-impressionismo: artisti e caratteristiche",
      "Analizza La Notte Stellata di Van Gogh: colori, stile, stato d'animo",
      "Cosa rappresenta il Guernica di Picasso? In quale stile Ã¨ dipinto?",
      "Elenca 5 musei famosi nel mondo con le opere piÃ¹ importanti"
    ],
    esercizi_avanzati:[
      "Confronta la tecnica di Raffaello e Michelangelo nella Cappella Sistina",
      "Spiega come il Cubismo di Picasso rivoluzionÃ² l'arte del '900",
      "Analizza un'opera astratta: cosa comunica, quali tecniche usa",
      "Collega l'arte Barocca al suo contesto storico-religioso"
    ],
    teoria:["Ripassa i movimenti artistici in ordine cronologico","Studia gli artisti principali per periodo","Rileggi le caratteristiche delle tecniche pittoriche"],
    tips:["Guarda le immagini in alta risoluzione","Collega ogni opera al suo contesto","Usa le date per fissare i movimenti"]
  },
  musica:{
    esercizi_base:[
      "Scrivi le note della scala di Do maggiore in ordine",
      "Qual Ã¨ il valore di: semibreve, minima, semiminima, croma?",
      "Indica il tempo di: Allegro, Andante, Largo, Presto",
      "Chi Ã¨ Bach? Elenca 3 sue opere e il loro genere musicale",
      "Differenza tra musica barocca e classica: period, stile, compositori",
      "Cos'Ã¨ una sonata? E una sinfonia? Quanti movimenti hanno?",
      "Elenca gli strumenti dell'orchestra divisi per famiglia"
    ],
    esercizi_avanzati:[
      "Analizza la struttura di una fuga bachiana",
      "Confronta lo stile di Mozart e Beethoven con esempi di opere",
      "Spiega l'evoluzione dalla tonalitÃ  all'atonalitÃ  nel '900",
      "Descrivi le caratteristiche del Romanticismo musicale"
    ],
    teoria:["Ripassa le note e i valori ritmici","Studia i periodi storici della musica","Rileggi i generi musicali principali"],
    tips:["Ascolta le opere mentre studi","Batti il ritmo per memorizzare","Collega i compositori alla loro epoca"]
  },
  ed_fisica:{
    esercizi_base:[
      "Elenca e spiega le 5 capacitÃ  motorie fondamentali",
      "Quante persone giocano in una squadra di pallavolo? E di calcio? E di basket?",
      "Cos'Ã¨ il VOâ‚‚max? Come si misura e cosa indica?",
      "Spiega la differenza tra sport aerobico e anaerobico con 2 esempi ciascuno",
      "Descrivi le fasi di un corretto riscaldamento prima dell'attivitÃ  fisica",
      "Cosa sono le fibre muscolari lente e veloci? Quando vengono usate?",
      "Elenca i principi dell'allenamento sportivo (almeno 4)"
    ],
    esercizi_avanzati:[
      "Spiega il principio di supercompensazione nell'allenamento",
      "Analizza l'importanza dell'alimentazione per uno sportivo",
      "Descrivi le regole complete di uno sport a scelta",
      "Cos'Ã¨ il doping? Spiega effetti fisici e rischi per la salute"
    ],
    teoria:["Ripassa la fisiologia dell'esercizio","Studia le regole degli sport principali","Rileggi i principi dell'allenamento"],
    tips:["Collega sempre teoria e pratica","Usa schemi corporei per anatomia","Memorizza le regole con esempi di gioco"]
  },
  altra:{
    esercizi_base:[
      "Scrivi le 5 definizioni piÃ¹ importanti dell'argomento",
      "Elenca i 5 concetti chiave della materia e spiegali",
      "Crea 5 domande che potrebbe fare il professore e rispondici",
      "Spiega l'argomento come se dovessi insegnarlo a un compagno",
      "Scrivi un riassunto di 10 righe del capitolo principale",
      "Collega l'argomento a qualcosa che conosci giÃ  nella vita reale",
      "Crea una mappa concettuale con i collegamenti tra i temi"
    ],
    esercizi_avanzati:[
      "Analizza i pro e contro dell'argomento studiato",
      "Cerca un esempio pratico per ogni concetto teorico",
      "Scrivi 3 domande aperte con risposte complete",
      "Confronta due aspetti diversi dell'argomento"
    ],
    teoria:["Ripassa le definizioni fondamentali","Studia gli esempi principali","Rileggi le parti sottolineate"],
    tips:["Studia in blocchi da 25 minuti","Fai pause attive ogni ora","Spiega ad alta voce per fissare i concetti"]
  }
};

const MOTIVAZIONI_PER_LIVELLO=[
  ["ğŸ˜´","Partiamo dalle basi! Ogni esperto era un principiante. Anche 30 minuti oggi fanno la differenza. Ce la fai! ğŸ’ª"],
  ["ğŸ˜Ÿ","Hai giÃ  qualcosa su cui costruire! Concentrati sui punti deboli e vedrai miglioramenti rapidi. Forza! ğŸš€"],
  ["ğŸ˜","Sei a metÃ  strada, ottimo! Un po' di ripasso mirato e sarai pronto. Continua cosÃ¬! â­"],
  ["ğŸ˜Š","Quasi pronto! Ripassi veloci e riposo sono tutto quello che ti serve ora. Ottimo lavoro! ğŸ¯"],
  ["ğŸ”¥","Sei giÃ  preparato! Fai una revisione rapida, rilassati e dai il massimo domani. Sei una bomba! ğŸ†"]
];

function generaRipassoOffline(materia, argomento, tipo, livello){
  const db=RIPASSO_DB[materia]||RIPASSO_DB.altra;
  const [emoji, motivazione]=MOTIVAZIONI_PER_LIVELLO[livello-1];
  const mat=MATERIE.find(m=>m.id===materia);
  const matLabel=materia==="altra"?argomento:(mat?.label||"materia");
  const argTxt=argomento?` â€” "${argomento}"`:"";

  // Scegli gli esercizi in base al livello
  // Livello 1-2: esercizi base (piÃ¹ facili, con teoria prima)
  // Livello 3: metÃ  base metÃ  avanzati
  // Livello 4-5: esercizi avanzati (sfidanti)
  let pool=[];
  if(livello<=2){
    pool=[...db.esercizi_base];
  } else if(livello===3){
    pool=[...db.esercizi_base.slice(0,3),...(db.esercizi_avanzati||[]).slice(0,2)];
  } else {
    pool=[...(db.esercizi_avanzati||db.esercizi_base),...db.esercizi_base.slice(0,2)];
  }
  // Mescola un po' per variare
  pool.sort(()=>Math.random()-0.5);
  const numEsercizi=livello<=2?5:livello===3?4:4;
  const esercizi=pool.slice(0,numEsercizi);
  const teoria=db.teoria.slice(0,livello<=2?3:1);
  const tips=db.tips.slice(0,2);

  let piano=`${emoji} Ripasso: ${tipo||"Verifica"} di ${matLabel}${argTxt}\n`;
  piano+=`${"â”€".repeat(35)}\n\n`;

  if(livello<=2){
    piano+=`ğŸ“š PRIMA RIPASSA LA TEORIA\n`;
    teoria.forEach(t=>piano+=`â€¢ ${t}\n`);
    piano+=`\n`;
  }

  piano+=`âœï¸ ESERCIZI DA SVOLGERE\n\n`;
  esercizi.forEach((e,i)=>{
    piano+=`${i+1}. ${e}\n\n`;
  });

  if(argomento){
    piano+=`ğŸ¯ FOCUS SU: "${argomento}"\n`;
    piano+=`â€¢ Rileggi i tuoi appunti specifici su questo tema\n`;
    if(tipo==="Orale")piano+=`â€¢ Prova a spiegarlo ad alta voce senza guardare\n`;
    if(tipo==="Scritto"||tipo==="Test")piano+=`â€¢ Riscrivi le formule/regole principali a memoria\n`;
    piano+=`â€¢ Fai 2 esempi pratici sull'argomento\n`;
    piano+=`\n`;
  }

  piano+=`ğŸ’¡ CONSIGLI UTILI\n`;
  tips.forEach(t=>piano+=`â€¢ ${t}\n`);
  piano+=`\n${motivazione}`;
  return piano;
}

function generaListaSpesaOffline(piatti){
  const items=piatti.toLowerCase();
  const lista=[];
  const suggerimenti=[];

  if(items.includes("pasta")||items.includes("spaghetti")||items.includes("penne")){
    lista.push({nome:"Pasta",quantita:"500g",categoria:"ğŸ¥«"});
    lista.push({nome:"Pomodori pelati",quantita:"400g",categoria:"ğŸ¥«"});
    lista.push({nome:"Olio d'oliva",quantita:"q.b.",categoria:"ğŸ¥«"});
    lista.push({nome:"Aglio",quantita:"2 spicchi",categoria:"ğŸ¥¬"});
    suggerimenti.push({nome:"Parmigiano grattugiato",motivo:"Per condire la pasta"});
  }
  if(items.includes("pollo")){
    lista.push({nome:"Pollo",quantita:"600g",categoria:"ğŸ¥©"});
    lista.push({nome:"Rosmarino",quantita:"1 rametto",categoria:"ğŸ¥¬"});
    lista.push({nome:"Limone",quantita:"1",categoria:"ğŸ"});
    suggerimenti.push({nome:"Patate",motivo:"Ottimo contorno al forno"});
  }
  if(items.includes("insalata")||items.includes("verdure")){
    lista.push({nome:"Insalata mista",quantita:"200g",categoria:"ğŸ¥¬"});
    lista.push({nome:"Pomodori",quantita:"3",categoria:"ğŸ¥¬"});
    lista.push({nome:"Cetrioli",quantita:"1",categoria:"ğŸ¥¬"});
    suggerimenti.push({nome:"Olive",motivo:"Per arricchire l'insalata"});
  }
  if(items.includes("riso")||items.includes("risotto")){
    lista.push({nome:"Riso",quantita:"300g",categoria:"ğŸ¥«"});
    lista.push({nome:"Cipolla",quantita:"1",categoria:"ğŸ¥¬"});
    lista.push({nome:"Brodo vegetale",quantita:"1L",categoria:"ğŸ¥«"});
    lista.push({nome:"Burro",quantita:"50g",categoria:"ğŸ¥›"});
    suggerimenti.push({nome:"Parmigiano",motivo:"Indispensabile per il risotto"});
  }
  if(items.includes("pizza")){
    lista.push({nome:"Farina 00",quantita:"500g",categoria:"ğŸ¥«"});
    lista.push({nome:"Lievito di birra",quantita:"25g",categoria:"ğŸ¥«"});
    lista.push({nome:"Mozzarella",quantita:"250g",categoria:"ğŸ¥›"});
    lista.push({nome:"Pomodori pelati",quantita:"400g",categoria:"ğŸ¥«"});
    suggerimenti.push({nome:"Basilico fresco",motivo:"Per la pizza margherita"});
  }
  if(items.includes("tiramisu")||items.includes("tiramisÃ¹")){
    lista.push({nome:"Mascarpone",quantita:"250g",categoria:"ğŸ¥›"});
    lista.push({nome:"Savoiardi",quantita:"200g",categoria:"ğŸ§"});
    lista.push({nome:"Uova",quantita:"3",categoria:"ğŸ¥›"});
    lista.push({nome:"CaffÃ¨",quantita:"200ml",categoria:"ğŸ¥«"});
    lista.push({nome:"Cacao amaro",quantita:"2 cucchiai",categoria:"ğŸ§"});
  }
  if(items.includes("carne")||items.includes("bistecca")||items.includes("hamburger")){
    lista.push({nome:"Carne macinata/bistecca",quantita:"500g",categoria:"ğŸ¥©"});
    lista.push({nome:"Cipolla",quantita:"1",categoria:"ğŸ¥¬"});
    lista.push({nome:"Olio",quantita:"q.b.",categoria:"ğŸ¥«"});
    suggerimenti.push({nome:"Pane",motivo:"Per accompagnare la carne"});
  }
  if(items.includes("minestra")||items.includes("zuppa")||items.includes("minestrone")){
    lista.push({nome:"Verdure miste",quantita:"500g",categoria:"ğŸ¥¬"});
    lista.push({nome:"Legumi misti",quantita:"200g",categoria:"ğŸ¥«"});
    lista.push({nome:"Brodo",quantita:"1L",categoria:"ğŸ¥«"});
    suggerimenti.push({nome:"Pane tostato",motivo:"Ottimo con la zuppa"});
  }

  // Sempre aggiungi base
  if(lista.length===0){
    lista.push({nome:"Olio d'oliva",quantita:"q.b.",categoria:"ğŸ¥«"});
    lista.push({nome:"Sale e pepe",quantita:"q.b.",categoria:"ğŸ¥«"});
    lista.push({nome:"Ingredienti principali del piatto",quantita:"500g",categoria:"ğŸ¥©"});
    lista.push({nome:"Verdure di stagione",quantita:"300g",categoria:"ğŸ¥¬"});
  }
  // Suggerimenti generali
  suggerimenti.push({nome:"Acqua minerale",motivo:"Sempre utile in casa"});
  suggerimenti.push({nome:"Pane fresco",motivo:"Per accompagnare il pasto"});

  return {lista,suggerimenti};
}

// â”€â”€ METEO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function useMeteo(){
  const [meteo,setMeteo]=useState(null);
  useEffect(()=>{
    if(!navigator.geolocation){return;}
    navigator.geolocation.getCurrentPosition(async pos=>{
      try{
        const {latitude:lat,longitude:lon}=pos.coords;
        const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`);
        const d=await r.json();
        const temp=Math.round(d.current.temperature_2m);
        const code=d.current.weather_code;
        const icon=code<=1?"â˜€ï¸":code<=3?"â›…":code<=48?"ğŸŒ«ï¸":code<=67?"ğŸŒ§ï¸":code<=77?"ğŸŒ¨ï¸":code<=82?"ğŸŒ§ï¸":"â›ˆï¸";
        setMeteo({temp,icon});
      }catch{}
    },()=>{},{timeout:5000});
  },[]);
  return meteo;
}

// â”€â”€ SWIPEABLE CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SwipeCalendar({year,month,events,alerts,onDay,onMonthChange}){
  const containerRef=useRef(null);
  const startX=useRef(null);
  const startY=useRef(null);
  const currentX=useRef(0);
  const isDragging=useRef(false);
  const hasMoved=useRef(false);
  const [offset,setOffset]=useState(0);
  const [animating,setAnimating]=useState(false);
  const W=useRef(375);

  useEffect(()=>{if(containerRef.current)W.current=containerRef.current.offsetWidth;},[]);

  const onTouchStart=e=>{
    if(animating)return;
    startX.current=e.touches[0].clientX;
    startY.current=e.touches[0].clientY;
    isDragging.current=false;
    hasMoved.current=false;
  };
  const onTouchMove=e=>{
    if(startX.current===null)return;
    const dx=e.touches[0].clientX-startX.current;
    const dy=Math.abs(e.touches[0].clientY-startY.current);
    if(!isDragging.current){
      if(dy>Math.abs(dx)||Math.abs(dx)<8)return;
      isDragging.current=true;
    }
    e.preventDefault();
    hasMoved.current=Math.abs(dx)>12;
    currentX.current=dx;
    setOffset(dx);
  };
  const onTouchEnd=e=>{
    if(!isDragging.current){startX.current=null;return;}
    const dx=currentX.current;
    const threshold=W.current*0.28;
    setAnimating(true);
    if(dx<-threshold){
      setOffset(-W.current);
      setTimeout(()=>{const n=addMonths(year,month,1);onMonthChange(n.year,n.month);setOffset(0);setAnimating(false);},280);
    } else if(dx>threshold){
      setOffset(W.current);
      setTimeout(()=>{const n=addMonths(year,month,-1);onMonthChange(n.year,n.month);setOffset(0);setAnimating(false);},280);
    } else {
      setOffset(0);
      setTimeout(()=>setAnimating(false),280);
    }
    startX.current=null;
    isDragging.current=false;
    currentX.current=0;
  };

  // Only fire onDay if swipe did NOT move significantly
  const handleDayClick=useCallback((key)=>{
    if(!hasMoved.current&&!animating) onDay(key);
  },[animating]);

  const prev=addMonths(year,month,-1);
  const next=addMonths(year,month,1);

  return (
    <div ref={containerRef} style={{overflow:"hidden",touchAction:"pan-y"}}
      onTouchStart={onTouchStart} onTouchMove={onTouchMove} onTouchEnd={onTouchEnd}>
      <div style={{display:"flex",width:"300%",transform:`translateX(calc(-33.333% + ${offset}px))`,transition:animating?"transform 0.28s cubic-bezier(0.25,0.46,0.45,0.94)":"none",willChange:"transform"}}>
        <div style={{width:"33.333%",flexShrink:0}}><MonthGrid year={prev.year} month={prev.month} events={events} alerts={alerts} onDay={handleDayClick}/></div>
        <div style={{width:"33.333%",flexShrink:0}}><MonthGrid year={year} month={month} events={events} alerts={alerts} onDay={handleDayClick}/></div>
        <div style={{width:"33.333%",flexShrink:0}}><MonthGrid year={next.year} month={next.month} events={events} alerts={alerts} onDay={handleDayClick}/></div>
      </div>
    </div>
  );
}

function MonthGrid({year,month,events,alerts,onDay}){
  const {dark}=React.useContext(ThemeCtx);
  const fd=firstDay(year,month),td=daysIn(year,month);
  const getDay=k=>events[k]||[];
  return (
    <div style={{padding:"0 4px"}}>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",marginBottom:"4px"}}>
        {DAYS.map((d,i)=><div key={i} style={{textAlign:"center",fontSize:"11px",fontWeight:"600",color:i>=5?"#FF9500":dark?"rgba(255,255,255,0.3)":"rgba(60,60,67,0.38)",padding:"3px 0"}}>{d}</div>)}
      </div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",rowGap:"1px"}}>
        {Array.from({length:fd},(_,i)=><div key={`e${i}`}/>)}
        {Array.from({length:td},(_,i)=>{
          const day=i+1,key=fmt(year,month,day);
          const evs=getDay(key),isT=key===todayStr,isW=(fd+i)%7>=5;
          const isPast=key<todayStr;
          const cats=[...new Set(evs.map(e=>e.category))].slice(0,3);
          const hasAl=alerts.some(a=>a.day===key);
          const diff=daysBetween(key);
          return (
            <div key={key} onClick={()=>onDay(key)}
              style={{aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative",borderRadius:"50%",WebkitTapHighlightColor:"transparent"}}>
              {isT&&<div style={{position:"absolute",inset:"8%",borderRadius:"50%",background:"#FF3B30"}}/>}
              {hasAl&&!isT&&<div style={{position:"absolute",inset:"8%",borderRadius:"50%",border:"1.5px solid #FF3B30"}}/>}
              <div style={{fontSize:"15px",fontWeight:isT?"600":"400",color:isT?"#fff":isPast?(dark?"rgba(255,255,255,0.18)":"rgba(60,60,67,0.22)"):isW?"#FF9500":dark?"#fff":"#1C1C1E",position:"relative",zIndex:1,lineHeight:1,marginBottom:cats.length?"3px":"0"}}>{day}</div>
              {cats.length>0&&<div style={{display:"flex",gap:"2px",position:"relative",zIndex:1}}>{cats.map(cid=><div key={cid} style={{width:"4px",height:"4px",borderRadius:"50%",background:isT?"rgba(255,255,255,0.85)":getCat(cid).color}}/>)}</div>}
              {/* Countdown badge for verifiche */}
              {!isT&&diff>0&&diff<=5&&evs.some(e=>e.category==="verifica")&&(
                <div style={{position:"absolute",top:"-1px",right:"-1px",background:"#FF3B30",borderRadius:"6px",padding:"1px 3px",fontSize:"8px",fontWeight:"700",color:"#fff",zIndex:2,lineHeight:1}}>{diff}g</div>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”€â”€ GEMINI KEY SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function GeminiSetup({onDone,onClose,dark}){
  const [key,setKey]=useState(getGeminiKey());
  const [testing,setTesting]=useState(false);
  const [err,setErr]=useState("");
  const bg=dark?"#1C1C1E":"#F2F2F7";
  const card=dark?"#2C2C2E":"#fff";
  const txt=dark?"#fff":"#1C1C1E";
  const sub=dark?"rgba(255,255,255,0.4)":"rgba(60,60,67,0.45)";

  const test=async()=>{
    if(!key.trim())return;
    setTesting(true);setErr("");
    try{
      await callAI("Rispondi solo con: OK");
      saveGeminiKey(key.trim());
      onDone();
    }catch(e){
      if(e.message==="NO_KEY")
        setErr("âŒ Inserisci la chiave prima.");
      else if(e.message.startsWith("RETE:"))
        setErr("âŒ Errore di rete â€” controlla la connessione internet.");
      else if(e.message.startsWith("GEMINI:"))
        setErr("âŒ "+e.message.replace("GEMINI: ",""));
      else
        setErr("âŒ "+e.message);
    }
    setTesting(false);
  };

  return (
    <div style={{padding:"0 16px 16px"}}>
      <div style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"14px"}}>
        <div style={{fontSize:"15px",fontWeight:"700",color:txt,marginBottom:"6px"}}>ğŸ”‘ Configura Gemini AI</div>
        <div style={{fontSize:"13px",color:sub,lineHeight:1.5,marginBottom:"14px"}}>
          Per usare il Ripasso AI e la Lista Spesa ti serve una chiave gratuita di Google Gemini.
        </div>
        <div style={{background:dark?"rgba(0,122,255,0.15)":"rgba(0,122,255,0.08)",borderRadius:"12px",padding:"12px",marginBottom:"14px"}}>
          <div style={{fontSize:"13px",fontWeight:"600",color:"#007AFF",marginBottom:"6px"}}>Come ottenerla (2 min):</div>
          <div style={{fontSize:"13px",color:txt,lineHeight:1.7}}>
            1. Vai su <span style={{fontWeight:"600"}}>aistudio.google.com</span>{"\n"}
            2. Accedi con Google{"\n"}
            3. Clicca <span style={{fontWeight:"600"}}>"Get API Key"</span> â†’ <span style={{fontWeight:"600"}}>"Create API key"</span>{"\n"}
            4. Copia la chiave e incollala qui sotto
          </div>
        </div>
        <input
          value={key}
          onChange={e=>setKey(e.target.value)}
          placeholder="AIzaSy..."
          style={{width:"100%",padding:"12px 14px",border:`1.5px solid ${err?"#FF3B30":dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.15)"}`,borderRadius:"12px",fontSize:"14px",fontFamily:"monospace",color:txt,background:dark?"rgba(255,255,255,0.05)":"#fff",outline:"none",display:"block",userSelect:"text"}}
        />
        {err&&<div style={{fontSize:"12px",color:"#FF3B30",marginTop:"8px"}}>{err}</div>}
      </div>
      <button onClick={test} disabled={!key.trim()||testing} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:key.trim()?"#007AFF":"rgba(60,60,67,0.1)",color:key.trim()?"#fff":"rgba(60,60,67,0.3)",fontFamily:"inherit",fontSize:"15px",fontWeight:"600",cursor:key.trim()?"pointer":"default",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}}>
        {testing?<><span className="pulse">â³</span>Verifico la chiaveâ€¦</>:"Salva e continua â†’"}
      </button>
      <button onClick={onClose} style={{width:"100%",padding:"12px",borderRadius:"14px",border:"none",background:"transparent",color:sub,fontFamily:"inherit",fontSize:"14px",cursor:"pointer"}}>Annulla</button>
    </div>
  );
}

// â”€â”€ AI PANEL: ESERCIZI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ QUIZ PER MATERIA (domande vere a risposta multipla) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const QUIZ_DB={
  matematica:[
    // FACILE (lv:1)
    {d:"Quanto fa 7 Ã— 8?", r:["56","54","64","48"], c:"56", lv:1},
    {d:"Quanto fa 15% di 200?", r:["30","25","20","35"], c:"30", lv:1},
    {d:"Qual Ã¨ la radice quadrata di 144?", r:["12","11","13","14"], c:"12", lv:1},
    {d:"Risolvi: x + 5 = 12. Quanto vale x?", r:["7","8","5","6"], c:"7", lv:1},
    {d:"Quanto fa 2Â³?", r:["8","6","9","4"], c:"8", lv:1},
    {d:"Qual Ã¨ il perimetro di un quadrato di lato 5cm?", r:["20cm","25cm","15cm","10cm"], c:"20cm", lv:1},
    {d:"Quanto fa 3/4 + 1/4?", r:["1","1/2","3/8","4/8"], c:"1", lv:1},
    {d:"Qual Ã¨ il MCD di 12 e 18?", r:["6","3","9","12"], c:"6", lv:1},
    {d:"Quanto fa 0,5 Ã— 0,4?", r:["0,2","0,02","2","0,9"], c:"0,2", lv:1},
    {d:"In un triangolo rettangolo i cateti sono 3 e 4. L'ipotenusa Ã¨?", r:["5","7","6","4,5"], c:"5", lv:1},
    {d:"Quanto fa (âˆ’3) Ã— (âˆ’4)?", r:["12","âˆ’12","7","âˆ’7"], c:"12", lv:1},
    {d:"Qual Ã¨ il 20% di 150?", r:["30","25","20","35"], c:"30", lv:1},
    {d:"Quanto fa 2/3 di 90?", r:["60","45","30","75"], c:"60", lv:1},
    {d:"Qual Ã¨ l'area di un rettangolo 6Ã—4?", r:["24","20","28","12"], c:"24", lv:1},
    {d:"Quanto fa âˆš81?", r:["9","8","7","6"], c:"9", lv:1},
    // MEDIO (lv:2)
    {d:"Risolvi: 2x âˆ’ 3 = 7. Quanto vale x?", r:["5","4","6","3"], c:"5", lv:2},
    {d:"Qual Ã¨ il discriminante di xÂ² + 4x + 4 = 0?", r:["0","16","8","4"], c:"0", lv:2},
    {d:"L'area di un cerchio con r=3 Ã¨? (Ï€â‰ˆ3,14)", r:["28,26","18,84","9,42","12,56"], c:"28,26", lv:2},
    {d:"Semplifica: (xÂ²âˆ’4)/(xâˆ’2)", r:["x+2","xâˆ’2","xÂ²","2"], c:"x+2", lv:2},
    {d:"Quanto vale logâ‚â‚€(1000)?", r:["3","2","10","100"], c:"3", lv:2},
    {d:"Risolvi: xÂ² âˆ’ 5x + 6 = 0. Una soluzione Ã¨?", r:["2","4","5","1"], c:"2", lv:2},
    {d:"Qual Ã¨ la pendenza della retta y = 3x âˆ’ 2?", r:["3","âˆ’2","2","âˆ’3"], c:"3", lv:2},
    {d:"Quanto fa sen(90Â°)?", r:["1","0","âˆ’1","0,5"], c:"1", lv:2},
    {d:"Risolvi il sistema: 2x+y=5, xâˆ’y=1. Quanto vale x?", r:["2","3","1","4"], c:"2", lv:2},
    {d:"Semplifica: (aÂ²bÂ³)/(abÂ²)", r:["ab","aÂ²b","abÂ²","a/b"], c:"ab", lv:2},
    {d:"Qual Ã¨ l'equazione di una retta parallela a y=2x+1?", r:["y=2x+5","y=3x+1","y=x+2","y=âˆ’2x+1"], c:"y=2x+5", lv:2},
    {d:"Quanto fa âˆ«x dx? (integrale indefinito)", r:["xÂ²/2 + C","xÂ² + C","2x + C","x/2 + C"], c:"xÂ²/2 + C", lv:2},
    // DIFFICILE (lv:3)
    {d:"Qual Ã¨ il limite di (sin x)/x per xâ†’0?", r:["1","0","âˆ","non esiste"], c:"1", lv:3},
    {d:"Quante soluzioni reali ha xÂ² + 1 = 0?", r:["Nessuna","1","2","Infinite"], c:"Nessuna", lv:3},
    {d:"Se f(x)=xÂ³, quanto vale f'(x)?", r:["3xÂ²","3x","xÂ²","2xÂ³"], c:"3xÂ²", lv:3},
    {d:"Cosa rappresenta la derivata prima f'(x)?", r:["Tasso di variazione istantaneo","Area sotto la curva","Valore massimo","La media"], c:"Tasso di variazione istantaneo", lv:3},
    {d:"Qual Ã¨ la formula di De Moivre per i numeri complessi?", r:["(cosÎ¸+iÂ·sinÎ¸)â¿=cos(nÎ¸)+iÂ·sin(nÎ¸)","z=a+bi","|z|=âˆš(aÂ²+bÂ²)","zÂ·zÌ„=|z|Â²"], c:"(cosÎ¸+iÂ·sinÎ¸)â¿=cos(nÎ¸)+iÂ·sin(nÎ¸)", lv:3},
    {d:"Il teorema di Rolle richiede che f sia continua in [a,b] e...?", r:["Derivabile in (a,b) con f(a)=f(b)","Crescente","Derivabile ovunque","Positiva"], c:"Derivabile in (a,b) con f(a)=f(b)", lv:3},
    {d:"Quanto fa la somma della serie geometrica 1+1/2+1/4+...?", r:["2","1","3","âˆ"], c:"2", lv:3},
  ],

  chimica:[
    {d:"Qual Ã¨ il simbolo chimico dell'oro?", r:["Au","Or","Go","Ag"], c:"Au", lv:1},
    {d:"Quanti protoni ha il Carbonio?", r:["6","12","8","4"], c:"6", lv:1},
    {d:"Qual Ã¨ la formula dell'acqua?", r:["Hâ‚‚O","HO","Hâ‚‚Oâ‚‚","OH"], c:"Hâ‚‚O", lv:1},
    {d:"Come si chiama NaCl?", r:["Cloruro di sodio","Ossido di sodio","Acido cloridrico","Idrossido di sodio"], c:"Cloruro di sodio", lv:1},
    {d:"Qual Ã¨ il simbolo dell'ossigeno?", r:["O","Ox","Os","Og"], c:"O", lv:1},
    {d:"Quanti elettroni ha l'idrogeno?", r:["1","2","0","3"], c:"1", lv:1},
    {d:"Cos'Ã¨ un atomo?", r:["La piÃ¹ piccola unitÃ  di un elemento","Una molecola","Un ione","Un protone"], c:"La piÃ¹ piccola unitÃ  di un elemento", lv:1},
    {d:"Qual Ã¨ il simbolo del ferro?", r:["Fe","Fr","Fo","Fi"], c:"Fe", lv:1},
    {d:"Qual Ã¨ il numero atomico del Sodio?", r:["11","23","12","10"], c:"11", lv:1},
    {d:"Quanti stati di aggregazione della materia esistono (classici)?", r:["3","2","4","5"], c:"3", lv:1},
    {d:"Qual Ã¨ la formula del biossido di carbonio?", r:["COâ‚‚","CO","Câ‚‚O","Câ‚‚Oâ‚‚"], c:"COâ‚‚", lv:1},
    {d:"L'acqua bolle a quanti gradi Celsius a livello del mare?", r:["100","90","80","120"], c:"100", lv:1},
    {d:"Quante moli ci sono in 18g di Hâ‚‚O? (M=18g/mol)", r:["1","2","0,5","18"], c:"1", lv:2},
    {d:"Qual Ã¨ il pH di una soluzione neutra?", r:["7","0","14","1"], c:"7", lv:2},
    {d:"Bilancia Hâ‚‚+Oâ‚‚â†’Hâ‚‚O. Coefficiente di Hâ‚‚?", r:["2","1","3","4"], c:"2", lv:2},
    {d:"Quale legame si forma tra Na e Cl?", r:["Ionico","Covalente","Metallico","Van der Waals"], c:"Ionico", lv:2},
    {d:"Qual Ã¨ la formula dell'acido solforico?", r:["Hâ‚‚SOâ‚„","Hâ‚‚SOâ‚ƒ","HSOâ‚„","SOâ‚„"], c:"Hâ‚‚SOâ‚„", lv:2},
    {d:"Cosa indica il numero di massa di un atomo?", r:["Protoni+neutroni","Solo protoni","Elettroni+protoni","Solo neutroni"], c:"Protoni+neutroni", lv:2},
    {d:"Quanti grammi pesa 1 mole di COâ‚‚? (C=12,O=16)", r:["44g","28g","32g","22g"], c:"44g", lv:2},
    {d:"Cosa succede al pH aggiungendo un acido forte?", r:["Diminuisce","Aumenta","Rimane uguale","Diventa 14"], c:"Diminuisce", lv:2},
    {d:"Cos'Ã¨ una reazione di ossidoriduzione?", r:["Trasferimento di elettroni tra reagenti","Formazione di sali","Reazione con acidi","Combustione"], c:"Trasferimento di elettroni tra reagenti", lv:2},
    {d:"In quale gruppo della tavola periodica si trovano i metalli alcalini?", r:["Gruppo 1","Gruppo 2","Gruppo 17","Gruppo 18"], c:"Gruppo 1", lv:2},
    {d:"Calcola la concentrazione molare: 2 mol in 0,5 L", r:["4 M","1 M","2 M","0,25 M"], c:"4 M", lv:3},
    {d:"Cosa si conserva in una reazione chimica bilanciata?", r:["Massa e carica","Solo la massa","Solo le molecole","L'energia"], c:"Massa e carica", lv:3},
    {d:"Qual Ã¨ il pH di HCl 0,01 M?", r:["2","1","3","7"], c:"2", lv:3},
    {d:"Cosa sono gli isomeri?", r:["Composti con stessa formula molecolare ma struttura diversa","Stessa struttura formule diverse","Elementi dello stesso gruppo","Atomi con stesso numero di neutroni"], c:"Composti con stessa formula molecolare ma struttura diversa", lv:3},
    {d:"Qual Ã¨ la configurazione elettronica del Carbonio (Z=6)?", r:["1sÂ²2sÂ²2pÂ²","1sÂ²2sÂ²2pâ¶","1sÂ²2pâ´","2sÂ²2pÂ²"], c:"1sÂ²2sÂ²2pÂ²", lv:3},
  ],

  fisica:[
    {d:"Un'auto va a 60 km/h. Quanti km percorre in 2 ore?", r:["120","60","30","180"], c:"120", lv:1},
    {d:"Qual Ã¨ la formula della velocitÃ ?", r:["v=s/t","v=sÃ—t","v=t/s","v=mÃ—a"], c:"v=s/t", lv:1},
    {d:"Qual Ã¨ l'unitÃ  di misura della forza?", r:["Newton","Joule","Watt","Pascal"], c:"Newton", lv:1},
    {d:"Qual Ã¨ l'accelerazione di gravitÃ  sulla Terra?", r:["9,8 m/sÂ²","10 m/s","9,8 m/s","0,98 m/sÂ²"], c:"9,8 m/sÂ²", lv:1},
    {d:"Cosa enuncia il 1Â° principio della dinamica?", r:["Un corpo fermo rimane fermo senza forze","F=ma","Azione=Reazione","L'energia si conserva"], c:"Un corpo fermo rimane fermo senza forze", lv:1},
    {d:"Qual Ã¨ l'unitÃ  di misura dell'energia?", r:["Joule","Newton","Watt","Pascal"], c:"Joule", lv:1},
    {d:"Cosa misura il Watt?", r:["Potenza","Energia","Forza","Tensione"], c:"Potenza", lv:1},
    {d:"Converti 72 km/h in m/s", r:["20 m/s","18 m/s","25 m/s","72 m/s"], c:"20 m/s", lv:1},
    {d:"Qual Ã¨ la formula del peso?", r:["P=mÃ—g","P=m/g","P=g/m","P=m+g"], c:"P=mÃ—g", lv:1},
    {d:"L'energia cinetica dipende da?", r:["Massa e velocitÃ ","Solo dalla massa","Solo dalla velocitÃ ","Altezza e massa"], c:"Massa e velocitÃ ", lv:1},
    {d:"Oggetto di 5kg, F=20N. Accelerazione?", r:["4 m/sÂ²","100 m/sÂ²","0,25 m/sÂ²","15 m/sÂ²"], c:"4 m/sÂ²", lv:2},
    {d:"Energia cinetica di 2kg a 10 m/s?", r:["100 J","200 J","20 J","50 J"], c:"100 J", lv:2},
    {d:"V=24V, R=8Î©. Corrente con la legge di Ohm?", r:["3 A","16 A","192 A","0,33 A"], c:"3 A", lv:2},
    {d:"Due resistenze di 4Î© in parallelo. Resistenza totale?", r:["2Î©","8Î©","4Î©","1Î©"], c:"2Î©", lv:2},
    {d:"Potenza elettrica: formula?", r:["P=VÃ—I","P=V/I","P=I/V","P=VÂ²Ã—I"], c:"P=VÃ—I", lv:2},
    {d:"Da h=20m, tempo di caduta libera? (g=10)", r:["2 s","4 s","1 s","10 s"], c:"2 s", lv:2},
    {d:"Cosa afferma il principio di conservazione dell'energia?", r:["L'energia totale di un sistema isolato Ã¨ costante","L'energia si crea","La velocitÃ  Ã¨ costante","La massa si conserva"], c:"L'energia totale di un sistema isolato Ã¨ costante", lv:2},
    {d:"Forza di Coulomb: cosa dipende da essa?", r:["Distanza e cariche delle particelle","Solo dalla distanza","Solo dalla massa","Temperatura e pressione"], c:"Distanza e cariche delle particelle", lv:3},
    {d:"Cosa afferma il 2Â° principio della termodinamica?", r:["Il calore fluisce spontaneamente dal caldo al freddo","L'energia si conserva","La pressione aumenta con la temperatura","Il volume aumenta riscaldando"], c:"Il calore fluisce spontaneamente dal caldo al freddo", lv:3},
    {d:"VelocitÃ  di un oggetto che cade per 3s (g=10)?", r:["30 m/s","15 m/s","9 m/s","3 m/s"], c:"30 m/s", lv:3},
    {d:"Qual Ã¨ la formula dell'energia potenziale gravitazionale?", r:["Ep=mgh","Ep=mvÂ²/2","Ep=Fd","Ep=Pt"], c:"Ep=mgh", lv:3},
    {d:"Cos'Ã¨ la resistivitÃ ?", r:["ProprietÃ  del materiale che indica la sua resistenza al flusso di corrente","La resistenza totale del circuito","La corrente per unitÃ  di area","La tensione diviso corrente"], c:"ProprietÃ  del materiale che indica la sua resistenza al flusso di corrente", lv:3},
  ],

  storia:[
    {d:"In quale anno iniziÃ² la Prima Guerra Mondiale?", r:["1914","1918","1939","1900"], c:"1914", lv:1},
    {d:"Chi era il dittatore fascista dell'Italia?", r:["Mussolini","Hitler","Stalin","Franco"], c:"Mussolini", lv:1},
    {d:"In quale anno cadde il Muro di Berlino?", r:["1989","1991","1985","1961"], c:"1989", lv:1},
    {d:"Chi fu il primo presidente degli Stati Uniti?", r:["Washington","Lincoln","Jefferson","Adams"], c:"Washington", lv:1},
    {d:"La Rivoluzione Francese iniziÃ² nel:", r:["1789","1776","1815","1799"], c:"1789", lv:1},
    {d:"Chi era Napoleone Bonaparte?", r:["Generale e imperatore francese","Re di Spagna","Presidente americano","Zar di Russia"], c:"Generale e imperatore francese", lv:1},
    {d:"In quale anno finÃ¬ la Seconda Guerra Mondiale?", r:["1945","1944","1946","1943"], c:"1945", lv:1},
    {d:"Cosa fu la Resistenza italiana?", r:["Movimento partigiano contro il nazifascismo","Una battaglia navale","Un partito politico","Un trattato di pace"], c:"Movimento partigiano contro il nazifascismo", lv:1},
    {d:"In quale anno fu firmata la Costituzione italiana?", r:["1948","1946","1945","1950"], c:"1948", lv:1},
    {d:"Chi uccise Giulio Cesare?", r:["Bruto e Cassio","Marco Antonio","Ottaviano","Pompeo"], c:"Bruto e Cassio", lv:1},
    {d:"In quale anno iniziÃ² la Rivoluzione Industriale?", r:["Fine 1700 in Inghilterra","1850 in Francia","1900 in USA","1789 in Europa"], c:"Fine 1700 in Inghilterra", lv:1},
    {d:"Cosa scatenÃ² la Prima Guerra Mondiale?", r:["Assassinio dell'arciduca Francesco Ferdinando","Invasione della Polonia","Crollo della Borsa","Trattato di Versailles"], c:"Assassinio dell'arciduca Francesco Ferdinando", lv:2},
    {d:"Cos'era il Risorgimento italiano?", r:["Processo di unificazione dell'Italia nel XIX sec.","Una guerra mondiale","Una crisi economica","Un movimento artistico"], c:"Processo di unificazione dell'Italia nel XIX sec.", lv:2},
    {d:"Cosa fu la Guerra Fredda?", r:["Tensione politica tra USA e URSS dopo la WWII","Guerra in territori artici","Crisi economica globale","Conflitto militare europeo"], c:"Tensione politica tra USA e URSS dopo la WWII", lv:2},
    {d:"Chi era Stalin?", r:["Dittatore dell'Unione Sovietica","Presidente degli USA","Cancelliere tedesco","Duce italiano"], c:"Dittatore dell'Unione Sovietica", lv:2},
    {d:"Quando fu unificata l'Italia?", r:["1861","1848","1870","1900"], c:"1861", lv:2},
    {d:"Cosa fu l'Olocausto?", r:["Genocidio degli ebrei europei da parte dei nazisti","Una battaglia della WWI","Un campo di prigionia","Una legge razziale italiana"], c:"Genocidio degli ebrei europei da parte dei nazisti", lv:2},
    {d:"Qual fu la conseguenza principale del Trattato di Versailles per la Germania?", r:["Pesanti riparazioni e perdita di territori","Divisione in due stati","Occupazione alleata","Perdita delle colonie africane"], c:"Pesanti riparazioni e perdita di territori", lv:3},
    {d:"Cosa fu la Rivoluzione d'Ottobre del 1917?", r:["Rivoluzione bolscevica che portÃ² Lenin al potere in Russia","Rivolta operaia in Germania","Colpo di stato in Francia","Fine della Prima Guerra Mondiale"], c:"Rivoluzione bolscevica che portÃ² Lenin al potere in Russia", lv:3},
    {d:"Cos'era il Piano Marshall?", r:["Piano USA di aiuti economici all'Europa dopo la WWII","Un piano militare della NATO","Un accordo nucleare","Un trattato commerciale"], c:"Piano USA di aiuti economici all'Europa dopo la WWII", lv:3},
    {d:"Cosa sancÃ¬ la Pace di Westfalia (1648)?", r:["Fine della Guerra dei Trent'anni e nascita del sistema degli stati sovrani","Inizio dell'Impero Romano","Fine delle Crociate","Nascita della Repubblica Francese"], c:"Fine della Guerra dei Trent'anni e nascita del sistema degli stati sovrani", lv:3},
  ],

  scienze:[
    {d:"Qual Ã¨ la funzione del mitocondrio?", r:["Produrre energia (ATP)","Sintesi proteica","Digestione cellulare","Conservare il DNA"], c:"Produrre energia (ATP)", lv:1},
    {d:"Cosa produce la fotosintesi?", r:["Glucosio e ossigeno","COâ‚‚ e acqua","Proteine e grassi","ATP e COâ‚‚"], c:"Glucosio e ossigeno", lv:1},
    {d:"Quante paia di cromosomi ha l'uomo?", r:["23","46","22","24"], c:"23", lv:1},
    {d:"Cosa sono i batteri?", r:["Organismi procarioti unicellulari","Organismi eucarioti","Virus","Funghi"], c:"Organismi procarioti unicellulari", lv:1},
    {d:"Qual Ã¨ la molecola che porta le informazioni genetiche?", r:["DNA","RNA","ATP","Proteina"], c:"DNA", lv:1},
    {d:"Cosa fa la membrana cellulare?", r:["Regola cosa entra ed esce dalla cellula","Produce energia","Sintetizza proteine","Conserva il DNA"], c:"Regola cosa entra ed esce dalla cellula", lv:1},
    {d:"Cos'Ã¨ la fotosintesi clorofilliana?", r:["Processo che trasforma COâ‚‚ e acqua in glucosio usando luce solare","Processo che produce COâ‚‚","Respirazione delle piante","Movimento delle foglie"], c:"Processo che trasforma COâ‚‚ e acqua in glucosio usando luce solare", lv:1},
    {d:"Quanti regni classifica la biologia (sistema dei 5 regni)?", r:["5","3","4","6"], c:"5", lv:1},
    {d:"Qual Ã¨ la piÃ¹ grande struttura del nucleo cellulare?", r:["Nucleolo","Cromatina","Involucro nucleare","Ribosoma"], c:"Nucleolo", lv:1},
    {d:"Quante fasi ha la mitosi?", r:["4","2","6","8"], c:"4", lv:2},
    {d:"Differenza tra cellula animale e vegetale?", r:["La vegetale ha parete cellulare e cloroplasti","La animale ha vacuolo grande","La vegetale non ha nucleo","Nessuna differenza"], c:"La vegetale ha parete cellulare e cloroplasti", lv:2},
    {d:"Cosa sono gli enzimi?", r:["Catalizzatori biologici","Molecole energetiche","Tipi di DNA","Membrane cellulari"], c:"Catalizzatori biologici", lv:2},
    {d:"Cos'Ã¨ la catena alimentare?", r:["Sequenza di organismi in cui ognuno mangia il precedente","Un ciclo dell'azoto","Un processo cellulare","Una rete metabolica"], c:"Sequenza di organismi in cui ognuno mangia il precedente", lv:2},
    {d:"Differenza tra DNA e RNA?", r:["Il DNA Ã¨ a doppio filamento, l'RNA singolo","Il DNA Ã¨ nell'RNA","Il RNA ha piÃ¹ nucleotidi","Non ci sono differenze"], c:"Il DNA Ã¨ a doppio filamento, l'RNA singolo", lv:2},
    {d:"Cos'Ã¨ la selezione naturale?", r:["I piÃ¹ adatti all'ambiente si riproducono di piÃ¹","I piÃ¹ grandi sopravvivono","Gli animali si scelgono","Un processo casuale"], c:"I piÃ¹ adatti all'ambiente si riproducono di piÃ¹", lv:2},
    {d:"Cosa fa la respirazione cellulare aerobica?", r:["Converte glucosio in ATP usando ossigeno","Produce glucosio dalla COâ‚‚","Duplica il DNA","Sintetizza proteine"], c:"Converte glucosio in ATP usando ossigeno", lv:2},
    {d:"Cosa afferma la 1Âª legge di Mendel?", r:["I caratteri si trasmettono in forma dominante/recessiva","I geni si mescolano casualmente","Le specie evolvono per selezione","Il DNA si replica fedelmente"], c:"I caratteri si trasmettono in forma dominante/recessiva", lv:3},
    {d:"Cos'Ã¨ una mutazione genetica?", r:["Cambiamento nella sequenza del DNA","Duplicazione della cellula","Sintesi di una nuova proteina","Un errore nella divisione cellulare"], c:"Cambiamento nella sequenza del DNA", lv:3},
    {d:"Cosa sono le proteine in termini molecolari?", r:["Polimeri di amminoacidi","Polimeri di glucosio","Sequenze di DNA","Molecole lipidiche"], c:"Polimeri di amminoacidi", lv:3},
    {d:"Cos'Ã¨ l'omeostasi?", r:["CapacitÃ  di mantenere condizioni interne stabili","Processo di crescita","Ciclo riproduttivo","Tipo di respirazione"], c:"CapacitÃ  di mantenere condizioni interne stabili", lv:3},
  ],

  inglese:[
    {d:"Past Simple di 'go'?", r:["went","goed","gone","going"], c:"went", lv:1},
    {d:"Plurale di 'child'?", r:["children","childs","childes","child"], c:"children", lv:1},
    {d:"Traduci: 'I eat an apple every day'", r:["Mangio una mela ogni giorno","Ho mangiato una mela","Mangerei una mela","MangerÃ² una mela"], c:"Mangio una mela ogni giorno", lv:1},
    {d:"Past Simple di 'have'?", r:["had","haved","has","having"], c:"had", lv:1},
    {d:"Cosa significa 'beautiful'?", r:["Bello/bella","Brutto/a","Grande","Piccolo/a"], c:"Bello/bella", lv:1},
    {d:"Come si dice 'Sto mangiando' in inglese?", r:["I am eating","I eat","I was eating","I have eaten"], c:"I am eating", lv:1},
    {d:"Past Simple di 'run'?", r:["ran","runned","run","running"], c:"ran", lv:1},
    {d:"Cosa significa 'although'?", r:["Sebbene/nonostante","Quindi","Inoltre","PerchÃ©"], c:"Sebbene/nonostante", lv:1},
    {d:"Come si forma il comparativo di 'big'?", r:["bigger","more big","biggest","biger"], c:"bigger", lv:1},
    {d:"Quale tempo usa 'since/for'?", r:["Present Perfect","Simple Past","Future","Present Simple"], c:"Present Perfect", lv:1},
    {d:"Scegli: 'If I ___ rich, I would travel'", r:["were","am","was","be"], c:"were", lv:2},
    {d:"Trasforma al passivo: 'The chef cooks the meal'", r:["The meal is cooked by the chef","The meal was cooked","The chef is cooking","The meal cooks"], c:"The meal is cooked by the chef", lv:2},
    {d:"Present Perfect di 'I eat pizza'?", r:["I have eaten pizza","I ate pizza","I had eaten pizza","I was eating pizza"], c:"I have eaten pizza", lv:2},
    {d:"Cosa significa 'nevertheless'?", r:["Tuttavia","Inoltre","Quindi","PerciÃ²"], c:"Tuttavia", lv:2},
    {d:"Traduci: 'She has been studying for 3 hours'", r:["Studia da 3 ore","Ha studiato 3 ore fa","StudierÃ  3 ore","StudiÃ² per 3 ore"], c:"Studia da 3 ore", lv:2},
    {d:"'Give up' significa?", r:["Arrendersi","Regalare","Alzarsi","Crescere"], c:"Arrendersi", lv:2},
    {d:"Reported speech di 'I will come tomorrow'?", r:["He said he would come the next day","He said he will come tomorrow","He said he came tomorrow","He told me he comes"], c:"He said he would come the next day", lv:3},
    {d:"'By the time she arrived, we ___ dinner'", r:["had finished","finished","have finished","finish"], c:"had finished", lv:3},
    {d:"Cosa indica il Past Perfect?", r:["Un'azione avvenuta prima di un'altra nel passato","Un'azione futura rispetto al passato","Un'azione in corso nel passato","Un'azione abituale nel passato"], c:"Un'azione avvenuta prima di un'altra nel passato", lv:3},
    {d:"'Despite' Ã¨ seguito da?", r:["Sostantivo o gerundio","Che + soggetto + verbo","Solo verbo all'infinito","Solo un aggettivo"], c:"Sostantivo o gerundio", lv:3},
  ],

  geografia:[
    {d:"Capitale dell'Australia?", r:["Canberra","Sydney","Melbourne","Perth"], c:"Canberra", lv:1},
    {d:"Fiume piÃ¹ lungo del mondo?", r:["Nilo","Amazzonia","Mississippi","Congo"], c:"Nilo", lv:1},
    {d:"In quale continente si trova l'Egitto?", r:["Africa","Asia","Europa","Medio Oriente"], c:"Africa", lv:1},
    {d:"Paese piÃ¹ grande del mondo per superficie?", r:["Russia","Canada","USA","Cina"], c:"Russia", lv:1},
    {d:"Quanti oceani ci sono?", r:["5","4","6","3"], c:"5", lv:1},
    {d:"Montagna piÃ¹ alta del mondo?", r:["Everest","K2","Monte Bianco","Kilimanjaro"], c:"Everest", lv:1},
    {d:"Capitale del Brasile?", r:["Brasilia","Rio de Janeiro","San Paolo","Salvador"], c:"Brasilia", lv:1},
    {d:"In quale paese si trova il Rio delle Amazzoni?", r:["Brasile","Colombia","Peru","Venezuela"], c:"Brasile", lv:1},
    {d:"Capitale del Giappone?", r:["Tokyo","Osaka","Kyoto","Hiroshima"], c:"Tokyo", lv:1},
    {d:"Quale deserto Ã¨ il piÃ¹ grande del mondo (caldo)?", r:["Sahara","Gobi","Kalahari","Atacama"], c:"Sahara", lv:1},
    {d:"DensitÃ  di un paese con 50M abitanti e 500.000 kmÂ²?", r:["100 ab/kmÂ²","250 ab/kmÂ²","10 ab/kmÂ²","50 ab/kmÂ²"], c:"100 ab/kmÂ²", lv:2},
    {d:"Cos'Ã¨ il clima mediterraneo?", r:["Estati calde/secche, inverni miti/piovosi","Piogge tutto l'anno","Estati fredde, inverni nevosi","Caldo umido tutto l'anno"], c:"Estati calde/secche, inverni miti/piovosi", lv:2},
    {d:"Qual Ã¨ il paese piÃ¹ popoloso del mondo?", r:["India","Cina","USA","Indonesia"], c:"India", lv:2},
    {d:"Dove si trova il Canale di Panama?", r:["America Centrale","America del Sud","Caraibi","Messico"], c:"America Centrale", lv:2},
    {d:"Quali stati confinano con l'Italia?", r:["Francia, Svizzera, Austria, Slovenia","Francia, Spagna, Germania","Austria, Germania, Croazia","Svizzera, Germania, Ungheria"], c:"Francia, Svizzera, Austria, Slovenia", lv:2},
    {d:"Cos'Ã¨ la placca tettonica?", r:["Porzione rigida della crosta terrestre in movimento","Un tipo di roccia","Una corrente oceanica","Un tipo di terremoto"], c:"Porzione rigida della crosta terrestre in movimento", lv:3},
    {d:"PerchÃ© si formano i deserti nel Sahara e in zone simili?", r:["Alte pressioni atmosferiche e poca umiditÃ ","Vicinanza all'equatore","Venti freddi dal nord","Lontananza dagli oceani"], c:"Alte pressioni atmosferiche e poca umiditÃ ", lv:3},
    {d:"Cos'Ã¨ l'indice di sviluppo umano (ISU)?", r:["Misura che combina speranza di vita, istruzione e reddito","Solo il PIL pro capite","La densitÃ  di popolazione","Il tasso di natalitÃ "], c:"Misura che combina speranza di vita, istruzione e reddito", lv:3},
  ],

  filosofia:[
    {d:"Chi scrisse 'La Repubblica'?", r:["Platone","Aristotele","Socrate","Kant"], c:"Platone", lv:1},
    {d:"'Cogito ergo sum' significa?", r:["Penso dunque sono","Sono dunque penso","Esisto dunque ragiono","Agisco dunque penso"], c:"Penso dunque sono", lv:1},
    {d:"Chi Ã¨ considerato il padre della filosofia?", r:["Socrate","Platone","Aristotele","Talete"], c:"Socrate", lv:1},
    {d:"Chi scrisse la 'Critica della Ragion Pura'?", r:["Kant","Hegel","Nietzsche","Hume"], c:"Kant", lv:1},
    {d:"Cos'Ã¨ l'etica?", r:["Studio del bene e del male, dei valori morali","Studio della conoscenza","Studio della natura","Studio della politica"], c:"Studio del bene e del male, dei valori morali", lv:1},
    {d:"Chi fu Aristotele?", r:["Filosofo greco, allievo di Platone","Filosofo romano","Matematico greco","Re di Macedonia"], c:"Filosofo greco, allievo di Platone", lv:1},
    {d:"Cos'Ã¨ la metafisica?", r:["Studio dell'essere e della realtÃ  oltre la fisica","Studio della natura","Studio della morale","Studio della politica"], c:"Studio dell'essere e della realtÃ  oltre la fisica", lv:1},
    {d:"Chi inventÃ² la maieutica?", r:["Socrate","Platone","Aristotele","Sofisti"], c:"Socrate", lv:1},
    {d:"Cos'Ã¨ l'imperativo categorico di Kant?", r:["Principio morale universale e incondizionato","Legge dello stato","Istinto naturale","Comando divino"], c:"Principio morale universale e incondizionato", lv:2},
    {d:"La dialettica hegeliana si compone di?", r:["Tesi, antitesi, sintesi","Tesi, ipotesi, conclusione","Problema, analisi, soluzione","Input, processo, output"], c:"Tesi, antitesi, sintesi", lv:2},
    {d:"Cos'Ã¨ il dualismo cartesiano?", r:["Distinzione tra res cogitans (mente) e res extensa (corpo)","Unione di anima e corpo","Negazione della materia","La teoria delle idee innate"], c:"Distinzione tra res cogitans (mente) e res extensa (corpo)", lv:2},
    {d:"Cosa intende Platone per 'mondo delle idee'?", r:["Un mondo eterno e perfetto di cui la realtÃ  Ã¨ copia","Il mondo fisico che vediamo","I pensieri umani","I sogni collettivi"], c:"Un mondo eterno e perfetto di cui la realtÃ  Ã¨ copia", lv:2},
    {d:"Cos'Ã¨ l'empirismo?", r:["Teoria che basa la conoscenza sull'esperienza sensoriale","Teoria che basa la conoscenza sulla ragione pura","Studio dell'empiria","Filosofia del linguaggio"], c:"Teoria che basa la conoscenza sull'esperienza sensoriale", lv:2},
    {d:"L'Ãœbermensch di Nietzsche Ã¨?", r:["Un essere che supera la morale tradizionale creando nuovi valori","Un uomo fisicamente superiore","Un ideale di perfezione greca","Un leader politico"], c:"Un essere che supera la morale tradizionale creando nuovi valori", lv:3},
    {d:"Cos'Ã¨ il nichilismo?", r:["Negazione di valori assoluti e significati universali","Studio del nulla fisico","Filosofia orientale","Negazione dell'esistenza di Dio"], c:"Negazione di valori assoluti e significati universali", lv:3},
    {d:"Cosa distingue empirismo da razionalismo?", r:["Empirismo=esperienza, razionalismo=ragione pura","Sono la stessa cosa","Empirismo usa la logica, razionalismo i sensi","Empirismo greco, razionalismo moderno"], c:"Empirismo=esperienza, razionalismo=ragione pura", lv:3},
    {d:"Cosa intende Marx per 'alienazione'?", r:["Il lavoratore Ã¨ separato dal prodotto del suo lavoro","Un disturbo psicologico","La lontananza dalla natura","Un concetto hegeliano puro"], c:"Il lavoratore Ã¨ separato dal prodotto del suo lavoro", lv:3},
  ],

  latino:[
    {d:"Come si dice 'il libro' in latino (nominativo)?", r:["liber","libri","libro","librum"], c:"liber", lv:1},
    {d:"Genitivo singolare di 'puella'?", r:["puellae","puella","puellam","puellarum"], c:"puellae", lv:1},
    {d:"'Amo' in italiano significa?", r:["Io amo","Tu ami","Egli ama","Noi amiamo"], c:"Io amo", lv:1},
    {d:"Come si dice 'essere' alla 3Âª persona singolare presente?", r:["est","sunt","erat","sit"], c:"est", lv:1},
    {d:"Nominativo plurale di 'dominus'?", r:["domini","dominos","dominum","dominorum"], c:"domini", lv:1},
    {d:"'Veni, vidi, vici' fu detto da?", r:["Giulio Cesare","Augusto","Cicerone","Virgilio"], c:"Giulio Cesare", lv:1},
    {d:"Quale caso indica il complemento oggetto in latino?", r:["Accusativo","Nominativo","Genitivo","Ablativo"], c:"Accusativo", lv:1},
    {d:"'Pater' in latino significa?", r:["Padre","Madre","Fratello","Figlio"], c:"Padre", lv:1},
    {d:"Traduci: 'Puella in horto ambulat'", r:["La ragazza cammina nel giardino","Il ragazzo corre nel campo","La donna lavora in casa","La fanciulla dorme"], c:"La ragazza cammina nel giardino", lv:2},
    {d:"In 'Caesar hostes vicit', 'hostes' Ã¨?", r:["Complemento oggetto (accusativo plurale)","Soggetto","Complemento di luogo","Attributo"], c:"Complemento oggetto (accusativo plurale)", lv:2},
    {d:"Come si forma il perfetto di 'amo'?", r:["amavi","amabo","amarem","amatus sum"], c:"amavi", lv:2},
    {d:"Quale proposizione usa il congiuntivo in latino?", r:["Cum narrativo","Proposizione principale","Relativa semplice","Temporale con 'ubi'"], c:"Cum narrativo", lv:2},
    {d:"Cos'Ã¨ l'ablativo assoluto?", r:["Costruzione con participio + nome/pronome all'ablativo","Un caso verbale","Una forma di imperativo","Un tipo di subordinata con 'ut'"], c:"Costruzione con participio + nome/pronome all'ablativo", lv:3},
    {d:"'Milites, oppido capto, discesserunt' â€” oppido capto Ã¨?", r:["Ablativo assoluto","Complemento oggetto","Proposizione causale","Cum + congiuntivo"], c:"Ablativo assoluto", lv:3},
    {d:"Come si traduce il gerundivo?", r:["Indica necessitÃ  o obbligo (es. 'da fare')","Ãˆ uguale al gerundio","Indica un'azione passata","Ãˆ solo decorativo"], c:"Indica necessitÃ  o obbligo (es. 'da fare')", lv:3},
  ],

  informatica:[
    {d:"Quanto fa 1010 in binario convertito in decimale?", r:["10","12","8","14"], c:"10", lv:1},
    {d:"Cosa significa 'CPU'?", r:["UnitÃ  di elaborazione centrale","UnitÃ  di memoria centrale","Porta universale","UnitÃ  di controllo"], c:"UnitÃ  di elaborazione centrale", lv:1},
    {d:"Differenza tra RAM e ROM?", r:["RAM volatile, ROM permanente","ROM volatile, RAM permanente","Sono uguali","RAM piÃ¹ lenta"], c:"RAM volatile, ROM permanente", lv:1},
    {d:"Cosa fa un ciclo 'for'?", r:["Ripete codice n volte","Esegue se condizione vera","Definisce funzione","Termina programma"], c:"Ripete codice n volte", lv:1},
    {d:"Cosa significa HTML?", r:["HyperText Markup Language","High Transfer Machine Language","HyperText Making Language","Home Text Markup Language"], c:"HyperText Markup Language", lv:1},
    {d:"Quale simbolo indica un commento in Python?", r:["#","//","/*","--"], c:"#", lv:1},
    {d:"Cosa significa 'bug' in informatica?", r:["Errore nel codice","Un tipo di virus","Una variabile","Un comando"], c:"Errore nel codice", lv:1},
    {d:"Cosa fa il tag <br> in HTML?", r:["Interruzione di riga","Testo in grassetto","Link","Immagine"], c:"Interruzione di riga", lv:1},
    {d:"In Python, cosa stampa: print(len('ciao'))?", r:["4","3","5","'ciao'"], c:"4", lv:2},
    {d:"Cosa fa SELECT * FROM studenti WHERE voto > 7?", r:["Seleziona studenti con voto >7","Cancella studenti","Aggiorna voto","Conta studenti"], c:"Seleziona studenti con voto >7", lv:2},
    {d:"Cos'Ã¨ la ricorsione?", r:["Funzione che chiama se stessa","Ciclo infinito","Tipo di variabile","Errore di sistema"], c:"Funzione che chiama se stessa", lv:2},
    {d:"Quale struttura dati usa LIFO?", r:["Stack (pila)","Queue (coda)","Array","Lista"], c:"Stack (pila)", lv:2},
    {d:"Cos'Ã¨ un algoritmo?", r:["Sequenza finita di istruzioni per risolvere un problema","Un tipo di dato","Un linguaggio di programmazione","Un errore di sistema"], c:"Sequenza finita di istruzioni per risolvere un problema", lv:2},
    {d:"Qual Ã¨ la complessitÃ  di una ricerca lineare?", r:["O(n)","O(1)","O(log n)","O(nÂ²)"], c:"O(n)", lv:3},
    {d:"Cos'Ã¨ una JOIN in SQL?", r:["Combina righe di due tabelle in base a una condizione comune","Cancella righe duplicate","Ordina i risultati","Raggruppa per valore"], c:"Combina righe di due tabelle in base a una condizione comune", lv:3},
    {d:"Differenza tra processo e thread?", r:["Un processo Ã¨ indipendente, il thread condivide memoria con altri thread dello stesso processo","Sono la stessa cosa","Il thread Ã¨ piÃ¹ pesante","Il processo Ã¨ piÃ¹ veloce"], c:"Un processo Ã¨ indipendente, il thread condivide memoria con altri thread dello stesso processo", lv:3},
  ],

  arte:[
    {d:"Chi dipinse la Gioconda?", r:["Leonardo da Vinci","Michelangelo","Raffaello","Botticelli"], c:"Leonardo da Vinci", lv:1},
    {d:"Cosa rappresenta il David di Michelangelo?", r:["Re biblico David prima di Golia","Un guerriero romano","Apollo","Un atleta greco"], c:"Re biblico David prima di Golia", lv:1},
    {d:"In quale cittÃ  si trova la Cappella Sistina?", r:["Roma","Firenze","Venezia","Milano"], c:"Roma", lv:1},
    {d:"Chi dipinse La Notte Stellata?", r:["Van Gogh","Picasso","Monet","DalÃ¬"], c:"Van Gogh", lv:1},
    {d:"In quale periodo artistico lavorÃ² Leonardo da Vinci?", r:["Rinascimento","Barocco","Impressionismo","Romanticismo"], c:"Rinascimento", lv:1},
    {d:"Chi scolpÃ¬ La PietÃ ?", r:["Michelangelo","Donatello","Bernini","Canova"], c:"Michelangelo", lv:1},
    {d:"In quale museo si trova la Gioconda?", r:["Louvre, Parigi","Uffizi, Firenze","Prado, Madrid","Hermitage, San Pietroburgo"], c:"Louvre, Parigi", lv:1},
    {d:"Cosa rappresenta il Guernica di Picasso?", r:["Bombardamento di Guernica durante la guerra civile spagnola","La Prima Guerra Mondiale","L'Olocausto","Una battaglia napoleonica"], c:"Bombardamento di Guernica durante la guerra civile spagnola", lv:2},
    {d:"Qual Ã¨ la tecnica del chiaroscuro?", r:["Contrasto luce/ombra per dare profonditÃ ","Un tipo di scultura","Una tecnica di stampa","Un movimento artistico"], c:"Contrasto luce/ombra per dare profonditÃ ", lv:2},
    {d:"Chi fondÃ² l'Impressionismo?", r:["Monet, Renoir e pittori francesi dell'800","Picasso","Van Gogh","DalÃ¬"], c:"Monet, Renoir e pittori francesi dell'800", lv:2},
    {d:"Cos'Ã¨ il Cubismo?", r:["Movimento che scompone oggetti in forme geometriche da piÃ¹ punti di vista","Arte basata su cubi","Movimento astratto americano","Stile architettonico"], c:"Movimento che scompone oggetti in forme geometriche da piÃ¹ punti di vista", lv:2},
    {d:"Caratteristica principale dell'arte Barocca?", r:["Dinamismo, teatralitÃ  e contrasto drammatico","SemplicitÃ  e ordine","Geometria e astrazione","Colori pastello e leggerezza"], c:"Dinamismo, teatralitÃ  e contrasto drammatico", lv:2},
    {d:"Cos'Ã¨ la prospettiva in pittura?", r:["Tecnica per rappresentare la profonditÃ  su superficie piana","Un tipo di colore","Un movimento artistico","Una tecnica scultorea"], c:"Tecnica per rappresentare la profonditÃ  su superficie piana", lv:3},
    {d:"Differenza tra Impressionismo e Post-impressionismo?", r:["Il Post-impressionismo Ã¨ piÃ¹ personale e simbolico, meno legato alla luce del momento","Sono identici","Il Post-impressionismo venne prima","L'Impressionismo Ã¨ piÃ¹ astratto"], c:"Il Post-impressionismo Ã¨ piÃ¹ personale e simbolico, meno legato alla luce del momento", lv:3},
  ],

  musica:[
    {d:"Quante note ci sono nella scala musicale?", r:["7 (do re mi fa sol la si)","5","8","12"], c:"7 (do re mi fa sol la si)", lv:1},
    {d:"Chi compose la Quinta Sinfonia?", r:["Beethoven","Mozart","Bach","Vivaldi"], c:"Beethoven", lv:1},
    {d:"Cosa indica 'Allegro'?", r:["Veloce e vivace","Lento","Moderato","Molto lento"], c:"Veloce e vivace", lv:1},
    {d:"Chi compose Le Quattro Stagioni?", r:["Vivaldi","Bach","Mozart","Haydn"], c:"Vivaldi", lv:1},
    {d:"Cosa indica 'Largo'?", r:["Molto lento","Veloce","Moderato","Vivo"], c:"Molto lento", lv:1},
    {d:"Quante corde ha una chitarra standard?", r:["6","4","5","7"], c:"6", lv:1},
    {d:"Quale strumento suona Beethoven?", r:["Pianoforte","Violino","Flauto","Organo"], c:"Pianoforte", lv:1},
    {d:"Quanti movimenti ha tipicamente una sinfonia classica?", r:["4","3","2","5"], c:"4", lv:2},
    {d:"Cos'Ã¨ il Do maggiore?", r:["Scala senza alterazioni","Scala con 3 diesis","Scala minore","Accordo di 4 note"], c:"Scala senza alterazioni", lv:2},
    {d:"Cosa distingue Barocco e periodo Classico in musica?", r:["Barocco piÃ¹ ornamentato, Classico piÃ¹ sobrio ed equilibrato","Barocco piÃ¹ semplice","Sono lo stesso periodo","Classico usa strumenti antichi"], c:"Barocco piÃ¹ ornamentato, Classico piÃ¹ sobrio ed equilibrato", lv:2},
    {d:"Cosa sono le dinamiche in musica?", r:["Indicazioni di intensitÃ  sonora (forte/piano)","La velocitÃ  del brano","Il ritmo","La tonalitÃ "], c:"Indicazioni di intensitÃ  sonora (forte/piano)", lv:2},
    {d:"Cos'Ã¨ una fugÄƒ bachiana?", r:["Composizione polifonica basata su un tema che si ripete in diverse voci","Una danza barocca","Un tipo di sonata","Un'aria operistica"], c:"Composizione polifonica basata su un tema che si ripete in diverse voci", lv:3},
    {d:"Cosa rappresenta il simbolo 'p' in uno spartito?", r:["Piano (suona piano/quieto)","Pausa","Presto","PiÃ¹ forte"], c:"Piano (suona piano/quieto)", lv:3},
  ],

  ed_fisica:[
    {d:"Quanti giocatori ci sono in campo nella pallavolo?", r:["6","5","7","9"], c:"6", lv:1},
    {d:"Quanti minuti dura un tempo nel calcio?", r:["45","40","50","30"], c:"45", lv:1},
    {d:"Quanti punti vale una tripla nel basket?", r:["3","2","1","4"], c:"3", lv:1},
    {d:"Quante persone sono in una squadra di rugby union?", r:["15","11","13","7"], c:"15", lv:1},
    {d:"Quante medaglie olimpiche esistono?", r:["3 (oro, argento, bronzo)","2","4","5"], c:"3 (oro, argento, bronzo)", lv:1},
    {d:"Ogni quanti anni si tengono le Olimpiadi estive?", r:["4","2","6","8"], c:"4", lv:1},
    {d:"Quanto Ã¨ lunga una gara dei 100m piani?", r:["100 metri","200 metri","1000 metri","10km"], c:"100 metri", lv:1},
    {d:"Cos'Ã¨ uno sport aerobico?", r:["Usa ossigeno per produrre energia a lungo termine","Ãˆ esplosivo e breve","Ãˆ uno sport acquatico","Si pratica al chiuso"], c:"Usa ossigeno per produrre energia a lungo termine", lv:2},
    {d:"Cosa sono le fibre muscolari lente (rosse)?", r:["Per sforzi prolungati, resistenti alla fatica","Per sforzi esplosivi","Per la forza massimale","Solo per il cuore"], c:"Per sforzi prolungati, resistenti alla fatica", lv:2},
    {d:"Cos'Ã¨ il riscaldamento?", r:["Preparazione graduale del corpo all'attivitÃ  fisica","Un tipo di stretching","L'allenamento principale","Il defaticamento finale"], c:"Preparazione graduale del corpo all'attivitÃ  fisica", lv:2},
    {d:"Quanti set si giocano in una partita di pallavolo (al meglio)?", r:["5","3","4","7"], c:"5", lv:2},
    {d:"Cos'Ã¨ il VOâ‚‚max?", r:["Massima quantitÃ  di ossigeno che il corpo puÃ² utilizzare","VelocitÃ  massima di un atleta","Forza massima di un muscolo","Battito cardiaco massimo"], c:"Massima quantitÃ  di ossigeno che il corpo puÃ² utilizzare", lv:3},
    {d:"Cos'Ã¨ la supercompensazione nell'allenamento?", r:["Il corpo si adatta allo stress superando il livello iniziale di prestazione","Il muscolo si stanca troppo","Un tipo di infortunio","La fase di riscaldamento"], c:"Il corpo si adatta allo stress superando il livello iniziale di prestazione", lv:3},
    {d:"Cosa sono le fibre muscolari veloci (bianche)?", r:["Per sforzi brevi ed esplosivi, si affaticano velocemente","Per la resistenza aerobica","Solo per il cuore","Per la coordinazione"], c:"Per sforzi brevi ed esplosivi, si affaticano velocemente", lv:3},
  ],

  altra:[
    {d:"Capitale d'Italia?", r:["Roma","Milano","Napoli","Torino"], c:"Roma", lv:1},
    {d:"Quanti secondi in un'ora?", r:["3600","360","600","1800"], c:"3600", lv:1},
    {d:"Chi scrisse la Divina Commedia?", r:["Dante Alighieri","Petrarca","Boccaccio","Leopardi"], c:"Dante Alighieri", lv:1},
    {d:"In quale anno Colombo scoprÃ¬ l'America?", r:["1492","1453","1517","1776"], c:"1492", lv:1},
    {d:"Qual Ã¨ l'elemento piÃ¹ abbondante nell'universo?", r:["Idrogeno","Ossigeno","Carbonio","Elio"], c:"Idrogeno", lv:1},
    {d:"Quanti sensi ha l'essere umano (tradizionali)?", r:["5","4","6","7"], c:"5", lv:1},
    {d:"Chi dipinse la Notte Stellata?", r:["Van Gogh","Picasso","Monet","DalÃ¬"], c:"Van Gogh", lv:1},
    {d:"Quanti pianeti ci sono nel sistema solare?", r:["8","9","7","10"], c:"8", lv:1},
    {d:"Cos'Ã¨ la fotosintesi?", r:["Processo che trasforma luce in energia nelle piante","Movimento degli animali","Digestione negli insetti","Respirazione dei funghi"], c:"Processo che trasforma luce in energia nelle piante", lv:1},
    {d:"Qual Ã¨ la formula chimica del sale da cucina?", r:["NaCl","HCl","NaOH","KCl"], c:"NaCl", lv:2},
    {d:"Chi fu Einstein?", r:["Fisico che formulÃ² la teoria della relativitÃ ","Chimico che scoprÃ¬ la penicillina","Biologo che scrisse sull'evoluzione","Matematico che inventÃ² il calcolo"], c:"Fisico che formulÃ² la teoria della relativitÃ ", lv:2},
    {d:"Cosa studia l'astronomia?", r:["Corpi celesti e fenomeni dell'universo","La struttura della Terra","Le rocce e i minerali","I fenomeni atmosferici"], c:"Corpi celesti e fenomeni dell'universo", lv:2},
    {d:"Cos'Ã¨ il PIL?", r:["Valore totale di beni e servizi prodotti in un paese in un anno","Il debito pubblico","La moneta nazionale","Il tasso di occupazione"], c:"Valore totale di beni e servizi prodotti in un paese in un anno", lv:3},
    {d:"Cosa afferma la teoria dell'evoluzione di Darwin?", r:["Le specie si evolvono per selezione naturale adattandosi all'ambiente","Le specie sono immutabili","Dio creÃ² le specie","Le specie si evolvono per volontÃ  propria"], c:"Le specie si evolvono per selezione naturale adattandosi all'ambiente", lv:3},
  ]
};

// Seleziona domande in base a materia e livello preparazione
// â”€â”€ WIKIPEDIA + FALLBACK LOCALE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Parole chiave Wikipedia per materia
const WIKI_TOPICS = {
  matematica: ["Equazione","Funzione matematica","Teorema di Pitagora","Numeri primi","Geometria euclidea","Derivata","Integrale","ProbabilitÃ ","Statistica","Trigonometria"],
  chimica:    ["Tavola periodica degli elementi","Legame chimico","Reazione chimica","Acido","Base (chimica)","Mole (chimica)","Ossidazione","Atomo","Molecola","Soluzione chimica"],
  fisica:     ["VelocitÃ ","Forza","Energia","Legge di Ohm","Circuito elettrico","Gravitazione universale","Termodinamica","Ottica","Magnetismo","Meccanica classica"],
  storia:     ["Prima guerra mondiale","Seconda guerra mondiale","Rivoluzione francese","Risorgimento italiano","Fascismo","Nazismo","Guerra fredda","Rivoluzione industriale","Rinascimento","Illuminismo"],
  scienze:    ["Cellula","Fotosintesi","DNA","Mitosi","Ecosistema","Evoluzione","Respirazione cellulare","Virus","Batteri","Sistema nervoso"],
  inglese:    ["Lingua inglese","William Shakespeare","George Orwell","Jane Austen","Charles Dickens","Oscar Wilde","Mark Twain","Virginia Woolf","Ernest Hemingway","James Joyce"],
  geografia:  ["Europa","Asia","Africa","America","Oceania","Clima","Vulcano","Terremoto","Oceano Pacifico","Popolazione mondiale"],
  filosofia:  ["Platone","Aristotele","Immanuel Kant","Friedrich Nietzsche","RenÃ© Descartes","Socrate","Georg Wilhelm Friedrich Hegel","Karl Marx","Jean-Paul Sartre","Empirismo"],
  latino:     ["Latino","Impero romano","Giulio Cesare","Cicerone","Virgilio","Lingua latina","Repubblica romana","Augusto","Tacito","Ovidio"],
  informatica:["Algoritmo","Intelligenza artificiale","Internet","Programmazione","Sistema operativo","Database","Rete informatica","Sicurezza informatica","Python","Java"],
  arte:       ["Leonardo da Vinci","Michelangelo","Raffaello Sanzio","Pablo Picasso","Vincent van Gogh","Rinascimento","Impressionismo","Arte contemporanea","Barocco","Scultura"],
  musica:     ["Ludwig van Beethoven","Wolfgang Amadeus Mozart","Johann Sebastian Bach","Opera (musica)","Sinfonia","Musica classica","Musica barocca","Chitarra","Pianoforte","Jazz"],
  ed_fisica:  ["Pallavolo","Calcio","Basket","Atletica leggera","Olimpiadi","Nuoto","Tennis","Ginnastica","Sport","Allenamento sportivo"],
  altra:      ["Scienza","Arte","Cultura","Storia","Tecnologia","Letteratura","Filosofia","Matematica","Biologia","Fisica"]
};

// Scarica estratto Wikipedia in italiano
async function fetchWikiExtract(topic) {
  const url = `https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`;
  const r = await fetch(url, {headers:{"Accept":"application/json"}});
  if(!r.ok) throw new Error("wiki error");
  const d = await r.json();
  if(!d.extract || d.extract.length < 100) throw new Error("estratto troppo corto");
  return {titolo: d.title, testo: d.extract};
}

// Genera domande vere dal testo Wikipedia
function generaDomandeWiki(titolo, testo, livello, materia) {
  // Pulisci il testo
  const t = testo.replace(/\([^)]*\)/g,'').replace(/\[[^\]]*\]/g,'').trim();
  // Spezza in frasi
  const frasi = t.split(/[.!?]+/).map(f=>f.trim()).filter(f=>f.length>40 && f.length<300);
  if(frasi.length < 3) return null;

  const domande = [];
  const usate = new Set();

  // Strategia: prendi frasi diverse e crea domande "cosa afferma il testo su X?"
  const frasiMescol = [...frasi].sort(()=>Math.random()-0.5);

  for(const frase of frasiMescol) {
    if(domande.length >= 5) break;

    // Cerca parole chiave nella frase (sostantivi lunghi, nomi propri)
    const parole = frase.split(/\s+/).filter(p=>p.length>4 && /^[A-ZÃ€-Ãœ]/.test(p) || p.length>7);
    if(parole.length === 0) continue;

    // Scegli una parola da "nascondere" per fare la domanda
    const parolaChiave = parole[Math.floor(Math.random()*parole.length)];
    if(usate.has(parolaChiave)) continue;
    usate.add(parolaChiave);

    // Crea domanda
    const domanda = `Riguardo a "${titolo}": ${frase.replace(parolaChiave, '___________')}`;
    const corretta = parolaChiave;

    // Crea 3 distrattori plausibili pescando da altre frasi
    const distrattori = [];
    for(const altraFrase of frasiMescol) {
      if(altraFrase === frase) continue;
      const altreParole = altraFrase.split(/\s+/).filter(p=>p.length>4 && p!==parolaChiave);
      for(const p of altreParole) {
        if(!distrattori.includes(p) && p!==corretta && distrattori.length<3) {
          distrattori.push(p);
        }
      }
      if(distrattori.length>=3) break;
    }
    // Fallback distrattori generici per materia
    const fallbackDist = {
      storia:["Napoleone","Roma","1848","Francia"],
      scienze:["mitocondrio","DNA","glucosio","ossigeno"],
      chimica:["sodio","carbonio","ossigeno","azoto"],
      fisica:["forza","energia","velocitÃ ","massa"],
      default:["primo","secondo","principale","generale"]
    };
    const fb = fallbackDist[materia]||fallbackDist.default;
    while(distrattori.length<3) distrattori.push(fb[distrattori.length]||"altro");

    const risposte = [corretta,...distrattori.slice(0,3)].sort(()=>Math.random()-0.5);
    domande.push({domanda, risposte, corretta, scelta:null, daWiki:true});
  }

  return domande.length>=3 ? domande : null;
}

// Funzione principale: prova Wikipedia, fallback locale
async function getDomandeIbride(materia, argomento, livello, onStatus) {
  // 1. Prova Wikipedia
  try {
    onStatus("ğŸŒ Cerco su Wikipediaâ€¦");
    // Scegli topic: usa l'argomento specifico se disponibile, altrimenti un topic casuale della materia
    const topics = WIKI_TOPICS[materia] || WIKI_TOPICS.altra;
    // Preferisci l'argomento della verifica se Ã¨ rilevante
    let topicDaCercare;
    if(argomento && argomento.length>2) {
      topicDaCercare = argomento;
    } else {
      topicDaCercare = topics[Math.floor(Math.random()*topics.length)];
    }

    const {titolo, testo} = await fetchWikiExtract(topicDaCercare);
    onStatus("ğŸ“– Genero domande dal testoâ€¦");
    await new Promise(r=>setTimeout(r,300));

    const domande = generaDomandeWiki(titolo, testo, livello, materia);
    if(domande && domande.length>=3) {
      return {domande, fonte:"wiki", titolo};
    }
    throw new Error("domande insufficienti");

  } catch(e) {
    // 2. Fallback locale
    onStatus("ğŸ“š Uso domande localiâ€¦");
    await new Promise(r=>setTimeout(r,300));
    const pool = QUIZ_DB[materia] || QUIZ_DB.altra;
    let filtrate;
    if(livello<=2)       filtrate = pool.filter(q=>q.lv===1);
    else if(livello===3) filtrate = pool.filter(q=>q.lv<=2);
    else                 filtrate = pool.filter(q=>q.lv>=2);
    if(filtrate.length<3) filtrate = pool;
    const domande = [...filtrate].sort(()=>Math.random()-0.5).slice(0,5).map(q=>({
      domanda:q.d, risposte:[...q.r].sort(()=>Math.random()-0.5), corretta:q.c, scelta:null, daWiki:false
    }));
    return {domande, fonte:"locale", titolo:null};
  }
}

function EserciziPanel({event,onClose}){
  const {dark}=React.useContext(ThemeCtx);
  const [livello,setLivello]=useState(3);
  const [step,setStep]=useState("livello");
  const [domande,setDomande]=useState([]);
  const [loadMsg,setLoadMsg]=useState("");
  const [fonte,setFonte]=useState("locale");
  const [wikiTitolo,setWikiTitolo]=useState(null);
  const [vis,setVis]=useState(false);
  useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
  const close=()=>{setVis(false);setTimeout(onClose,320)};
  const bg=dark?"#1C1C1E":"#F2F2F7";
  const card=dark?"#2C2C2E":"#fff";
  const txt=dark?"#fff":"#1C1C1E";
  const sub=dark?"rgba(255,255,255,0.4)":"rgba(60,60,67,0.45)";
  const livelli=["ğŸ˜´ Per niente","ğŸ˜Ÿ Poco","ğŸ˜ Abbastanza","ğŸ˜Š Bene","ğŸ”¥ Pronto!"];
  const livelloLabel=["Facile","Facile","Medio","Difficile","Difficile"];

  const genera=async()=>{
    setStep("loading");
    setLoadMsg("â³ Preparoâ€¦");
    const {domande:d, fonte:f, titolo:t} = await getDomandeIbride(
      event.materia||"altra",
      event.argomento||"",
      livello,
      msg=>setLoadMsg(msg)
    );
    setDomande(d);
    setFonte(f);
    setWikiTitolo(t);
    setStep("quiz");
  };

  const rispondi=(iDom,scelta)=>{
    setDomande(prev=>prev.map((d,i)=>i===iDom?{...d,scelta}:d));
  };

  const punteggio=domande.filter(d=>d.scelta===d.corretta).length;
  const tutteRisposte=domande.length>0&&domande.every(d=>d.scelta!==null);

  return (
    <div onClick={e=>e.target===e.currentTarget&&close()} style={{position:"fixed",inset:0,zIndex:600,background:vis?"rgba(0,0,0,0.5)":"rgba(0,0,0,0)",backdropFilter:"blur(8px)",transition:"background 0.3s",display:"flex",flexDirection:"column",justifyContent:"flex-end"}}>
      <div style={{background:bg,borderRadius:"20px 20px 0 0",maxHeight:"92vh",display:"flex",flexDirection:"column",transform:vis?"translateY(0)":"translateY(100%)",transition:"transform 0.4s cubic-bezier(0.32,0.72,0,1)",paddingBottom:"env(safe-area-inset-bottom,24px)"}}>
        <div style={{display:"flex",justifyContent:"center",padding:"10px 0 0"}}><div style={{width:"36px",height:"4px",background:dark?"rgba(255,255,255,0.15)":"rgba(60,60,67,0.15)",borderRadius:"2px"}}/></div>
        <div style={{padding:"14px 20px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}}>
          <div>
            <div style={{fontSize:"20px",fontWeight:"700",color:txt}}>ğŸ§  Ripasso</div>
            <div style={{fontSize:"13px",color:sub,marginTop:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"240px"}}>{event.title}</div>
          </div>
          <button onClick={close} style={{background:dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)",border:"none",borderRadius:"50%",width:"30px",height:"30px",cursor:"pointer",color:sub,fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center"}}>Ã—</button>
        </div>

        <div style={{overflowY:"auto",flex:1,padding:"0 16px 16px"}}>

          {step==="livello"&&(
            <div style={{animation:"fadeUp 0.2s ease"}}>
              <div style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"12px"}}>
                <div style={{fontSize:"14px",fontWeight:"600",color:txt,marginBottom:"4px"}}>Come ti senti preparato?</div>
                <div style={{fontSize:"12px",color:sub,marginBottom:"12px"}}>Le domande cambiano ogni volta ğŸ”„</div>
                <div style={{display:"flex",flexDirection:"column",gap:"8px"}}>
                  {livelli.map((l,i)=>(
                    <div key={i} onClick={()=>setLivello(i+1)} style={{padding:"12px 16px",borderRadius:"12px",border:`2px solid ${livello===i+1?"#FF3B30":"transparent"}`,background:livello===i+1?"rgba(255,59,48,0.1)":dark?"rgba(255,255,255,0.05)":"rgba(60,60,67,0.04)",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"}}>
                      <span style={{fontSize:"20px"}}>{l.split(" ")[0]}</span>
                      <div style={{flex:1}}>
                        <div style={{fontSize:"15px",fontWeight:livello===i+1?"600":"400",color:livello===i+1?"#FF3B30":txt}}>{l.split(" ").slice(1).join(" ")}</div>
                        <div style={{fontSize:"11px",color:sub,marginTop:"1px"}}>Domande {livelloLabel[i]}</div>
                      </div>
                      {livello===i+1&&<div style={{width:"20px",height:"20px",borderRadius:"50%",background:"#FF3B30",display:"flex",alignItems:"center",justifyContent:"center"}}><span style={{color:"#fff",fontSize:"12px"}}>âœ“</span></div>}
                    </div>
                  ))}
                </div>
              </div>
              <div style={{display:"flex",gap:"6px",marginBottom:"10px"}}>
                <div style={{flex:1,background:dark?"rgba(52,199,89,0.12)":"rgba(52,199,89,0.08)",borderRadius:"10px",padding:"8px",textAlign:"center"}}>
                  <div style={{fontSize:"16px"}}>ğŸŒ</div>
                  <div style={{fontSize:"11px",color:"#34C759",fontWeight:"600",marginTop:"2px"}}>Wikipedia</div>
                  <div style={{fontSize:"10px",color:sub}}>con internet</div>
                </div>
                <div style={{flex:1,background:dark?"rgba(255,149,0,0.12)":"rgba(255,149,0,0.08)",borderRadius:"10px",padding:"8px",textAlign:"center"}}>
                  <div style={{fontSize:"16px"}}>ğŸ“š</div>
                  <div style={{fontSize:"11px",color:"#FF9500",fontWeight:"600",marginTop:"2px"}}>Locale</div>
                  <div style={{fontSize:"10px",color:sub}}>senza internet</div>
                </div>
              </div>
              <button onClick={genera} style={{width:"100%",padding:"15px",borderRadius:"14px",border:"none",background:"#FF3B30",color:"#fff",fontFamily:"inherit",fontSize:"16px",fontWeight:"600",cursor:"pointer"}}>
                Inizia il quiz âœ¨
              </button>
            </div>
          )}

          {step==="loading"&&(
            <div style={{textAlign:"center",padding:"60px 0"}}>
              <div style={{fontSize:"44px",marginBottom:"16px"}} className="pulse">ğŸ§ </div>
              <div style={{fontSize:"15px",fontWeight:"600",color:txt,marginBottom:"6px"}}>{loadMsg}</div>
              <div style={{fontSize:"12px",color:sub}}>Qualche secondoâ€¦</div>
            </div>
          )}

          {step==="quiz"&&(
            <div style={{animation:"fadeUp 0.2s ease"}}>
              {/* Badge fonte */}
              <div style={{background:fonte==="wiki"?(dark?"rgba(52,199,89,0.12)":"rgba(52,199,89,0.08)"):(dark?"rgba(255,149,0,0.12)":"rgba(255,149,0,0.08)"),borderRadius:"10px",padding:"8px 12px",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                <span style={{fontSize:"12px",color:fonte==="wiki"?"#34C759":"#FF9500",fontWeight:"600"}}>
                  {fonte==="wiki"?`ğŸŒ Da Wikipedia: "${wikiTitolo}"`:"ğŸ“š Domande locali"}
                </span>
                <span style={{fontSize:"12px",color:sub}}>{livelloLabel[livello-1]}</span>
              </div>

              {/* Domande */}
              {domande.map((d,i)=>(
                <div key={i} style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"12px"}}>
                  <div style={{fontSize:"11px",fontWeight:"700",color:sub,marginBottom:"6px",letterSpacing:"0.05em"}}>DOMANDA {i+1} / {domande.length}</div>
                  <div style={{fontSize:"15px",fontWeight:"600",color:txt,marginBottom:"14px",lineHeight:1.5}}>{d.domanda}</div>
                  <div style={{display:"flex",flexDirection:"column",gap:"8px"}}>
                    {d.risposte.map((r,j)=>{
                      const risp=d.scelta;
                      const isC=r===d.corretta, isS=r===risp;
                      let bgR=dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)";
                      let bord="2px solid transparent";
                      let colR=txt;
                      if(risp!==null){
                        if(isC){bgR="rgba(52,199,89,0.15)";bord="2px solid #34C759";colR="#34C759";}
                        else if(isS){bgR="rgba(255,59,48,0.12)";bord="2px solid #FF3B30";colR="#FF3B30";}
                      }
                      return (
                        <div key={j} onClick={()=>risp===null&&rispondi(i,r)}
                          style={{padding:"11px 14px",borderRadius:"12px",border:bord,background:bgR,cursor:risp===null?"pointer":"default",display:"flex",alignItems:"center",gap:"10px",transition:"all 0.15s"}}>
                          <div style={{width:"24px",height:"24px",borderRadius:"50%",background:risp!==null?(isC?"#34C759":isS?"#FF3B30":dark?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.06)"):"rgba(0,122,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:"11px",fontWeight:"700",color:risp!==null?(isC||isS?"#fff":"#888"):"#007AFF"}}>
                            {risp!==null?(isC?"âœ“":isS?"âœ—":String.fromCharCode(65+j)):String.fromCharCode(65+j)}
                          </div>
                          <span style={{fontSize:"14px",color:colR,fontWeight:(isS||isC)&&risp!==null?"600":"400",lineHeight:1.3,flex:1}}>{r}</span>
                        </div>
                      );
                    })}
                  </div>
                  {d.scelta!==null&&(
                    <div style={{marginTop:"10px",padding:"8px 12px",borderRadius:"10px",background:d.scelta===d.corretta?"rgba(52,199,89,0.1)":"rgba(255,59,48,0.08)"}}>
                      <span style={{fontSize:"13px",fontWeight:"600",color:d.scelta===d.corretta?"#34C759":"#FF3B30"}}>
                        {d.scelta===d.corretta?"âœ… Corretto! Ottimo!":"âŒ Risposta esatta: "+d.corretta}
                      </span>
                    </div>
                  )}
                </div>
              ))}

              {/* Risultato finale */}
              {tutteRisposte&&(
                <div style={{background:card,borderRadius:"16px",padding:"20px",marginBottom:"12px",textAlign:"center",border:`2px solid ${punteggio===domande.length?"#34C759":punteggio>=domande.length*0.6?"#FF9500":"#FF3B30"}`}}>
                  <div style={{fontSize:"40px",marginBottom:"8px"}}>{punteggio===domande.length?"ğŸ†":punteggio>=domande.length*0.6?"â­":"ğŸ’ª"}</div>
                  <div style={{fontSize:"26px",fontWeight:"700",color:txt,letterSpacing:"-0.5px"}}>{punteggio}/{domande.length}</div>
                  <div style={{fontSize:"14px",color:sub,marginTop:"4px",marginBottom:punteggio<domande.length?"10px":"0"}}>
                    {punteggio===domande.length?"Perfetto! Sei pronto per la verifica! ğŸ¯":
                     punteggio>=domande.length*0.6?"Bene! Ripassa i punti sbagliati":"Studia ancora, poi riprova!"}
                  </div>
                  {punteggio<domande.length&&(
                    <div style={{fontSize:"12px",color:"#FF9500",fontWeight:"600",background:"rgba(255,149,0,0.1)",borderRadius:"8px",padding:"6px 10px"}}>
                      ğŸ’¡ Rileggi le risposte verdi â€” sono quelle corrette
                    </div>
                  )}
                </div>
              )}

              <div style={{display:"flex",gap:"8px"}}>
                <button onClick={()=>{setDomande([]);setStep("livello");}} style={{flex:1,padding:"13px",borderRadius:"14px",border:`2px solid ${dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)"}`,background:"transparent",color:txt,fontFamily:"inherit",fontSize:"14px",fontWeight:"600",cursor:"pointer"}}>â†º Nuovo quiz</button>
                <button onClick={close} style={{flex:1,padding:"13px",borderRadius:"14px",border:"none",background:"#FF3B30",color:"#fff",fontFamily:"inherit",fontSize:"14px",fontWeight:"600",cursor:"pointer"}}>Fine ğŸ¯</button>
              </div>
            </div>
          )}

        </div>
      </div>
    </div>
  );
}

// â”€â”€ AI PANEL: LISTA SPESA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ListaSpesaPanel({event,onClose,onSaveNote}){
  const {dark}=React.useContext(ThemeCtx);
  const [piatti,setPiatti]=useState("");
  const [step,setStep]=useState("input");
  const [lista,setLista]=useState([]);
  const [vis,setVis]=useState(false);
  useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
  const close=()=>{setVis(false);setTimeout(onClose,320)};
  const bg=dark?"#1C1C1E":"#F2F2F7";
  const card=dark?"#2C2C2E":"#fff";
  const txt=dark?"#fff":"#1C1C1E";
  const sub=dark?"rgba(255,255,255,0.4)":"rgba(60,60,67,0.45)";

  const genera=()=>{
    if(!piatti.trim())return;
    setStep("loading");
    setTimeout(()=>{
      const result=generaListaSpesaOffline(piatti);
      setLista(result);
      setStep("lista");
    },700);
  };

  const [checked,setChecked]=useState({});
  const toggle=n=>setChecked(p=>({...p,[n]:!p[n]}));

  return (
    <div onClick={e=>e.target===e.currentTarget&&close()} style={{position:"fixed",inset:0,zIndex:600,background:vis?"rgba(0,0,0,0.5)":"rgba(0,0,0,0)",backdropFilter:"blur(8px)",transition:"background 0.3s",display:"flex",flexDirection:"column",justifyContent:"flex-end"}}>
      <div style={{background:bg,borderRadius:"20px 20px 0 0",maxHeight:"90vh",display:"flex",flexDirection:"column",transform:vis?"translateY(0)":"translateY(100%)",transition:"transform 0.4s cubic-bezier(0.32,0.72,0,1)",paddingBottom:"env(safe-area-inset-bottom,24px)"}}>
        <div style={{display:"flex",justifyContent:"center",padding:"10px 0 0"}}><div style={{width:"36px",height:"4px",background:dark?"rgba(255,255,255,0.15)":"rgba(60,60,67,0.15)",borderRadius:"2px"}}/></div>
        <div style={{padding:"14px 20px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}}>
          <div>
            <div style={{fontSize:"20px",fontWeight:"700",color:txt,letterSpacing:"-0.3px"}}>ğŸ›’ Lista della spesa</div>
            <div style={{fontSize:"13px",color:sub,marginTop:"2px"}}>Generata dall'AI</div>
          </div>
          <button onClick={close} style={{background:dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)",border:"none",borderRadius:"50%",width:"30px",height:"30px",cursor:"pointer",color:sub,fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center"}}>Ã—</button>
        </div>

        <div style={{overflowY:"auto",flex:1,padding:"0 16px 16px"}}>
          
          {step==="input"&&(
            <div style={{animation:"fadeUp 0.2s ease"}}>
              <div style={{background:card,borderRadius:"16px",padding:"16px",marginBottom:"16px"}}>
                <div style={{fontSize:"14px",fontWeight:"600",color:txt,marginBottom:"10px"}}>Cosa vuoi cucinare? ğŸ³</div>
                <textarea value={piatti} onChange={e=>setPiatti(e.target.value)} placeholder="Es. pasta al pomodoro, insalata di pollo, tiramisuâ€¦" style={{width:"100%",minHeight:"80px",border:"none",background:dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)",borderRadius:"12px",padding:"12px",fontSize:"15px",fontFamily:"inherit",color:txt,outline:"none",resize:"none",display:"block",userSelect:"text"}}/>
              </div>
              <button onClick={genera} disabled={!piatti.trim()} style={{width:"100%",padding:"15px",borderRadius:"14px",border:"none",background:piatti.trim()?"#34C759":"rgba(60,60,67,0.1)",color:piatti.trim()?"#fff":"rgba(60,60,67,0.3)",fontFamily:"inherit",fontSize:"16px",fontWeight:"600",cursor:piatti.trim()?"pointer":"default"}}>
                Genera lista ğŸ›’
              </button>
            </div>
          )}

          {step==="loading"&&(
            <div style={{textAlign:"center",padding:"50px 0"}}>
              <div style={{fontSize:"40px",marginBottom:"16px"}} className="pulse">ğŸ›’</div>
              <div style={{fontSize:"15px",fontWeight:"600",color:txt,marginBottom:"8px"}}>Preparo la listaâ€¦</div>
              <div style={{fontSize:"13px",color:sub}}>Sto pensando agli ingredienti</div>
            </div>
          )}

          {step==="lista"&&lista.lista&&(
            <div style={{animation:"fadeUp 0.2s ease"}}>
              {/* Lista principale */}
              <div style={{background:card,borderRadius:"16px",overflow:"hidden",marginBottom:"12px"}}>
                <div style={{padding:"12px 16px",borderBottom:`1px solid ${dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.08)"}`,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                  <span style={{fontSize:"13px",fontWeight:"700",color:sub,letterSpacing:"0.04em"}}>DA COMPRARE</span>
                  <span style={{fontSize:"12px",color:sub}}>{Object.values(checked).filter(Boolean).length}/{lista.lista.length}</span>
                </div>
                {lista.lista.map((item,i)=>(
                  <div key={i} onClick={()=>toggle(item.nome)} style={{padding:"11px 16px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<lista.lista.length-1?`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`:"none",cursor:"pointer",background:checked[item.nome]?(dark?"rgba(255,255,255,0.03)":"rgba(60,60,67,0.02)"):"transparent"}}>
                    <div style={{width:"22px",height:"22px",borderRadius:"50%",border:`2px solid ${checked[item.nome]?"#34C759":"rgba(60,60,67,0.25)"}`,background:checked[item.nome]?"#34C759":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,transition:"all 0.15s"}}>
                      {checked[item.nome]&&<span style={{color:"#fff",fontSize:"12px",fontWeight:"700"}}>âœ“</span>}
                    </div>
                    <div style={{flex:1}}>
                      <span style={{fontSize:"15px",fontWeight:"500",color:checked[item.nome]?sub:txt,textDecoration:checked[item.nome]?"line-through":"none"}}>{item.categoria} {item.nome}</span>
                    </div>
                    <span style={{fontSize:"12px",color:sub}}>{item.quantita}</span>
                  </div>
                ))}
              </div>

              {/* Suggerimenti */}
              {lista.suggerimenti?.length>0&&(
                <div style={{marginBottom:"12px"}}>
                  <div style={{fontSize:"11px",fontWeight:"600",color:sub,letterSpacing:"0.05em",marginBottom:"8px",paddingLeft:"4px"}}>POTRESTI AGGIUNGERE</div>
                  <div style={{background:card,borderRadius:"16px",overflow:"hidden"}}>
                    {lista.suggerimenti.map((s,i)=>(
                      <div key={i} onClick={()=>toggle("sugg_"+s.nome)} style={{padding:"11px 16px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<lista.suggerimenti.length-1?`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`:"none",cursor:"pointer"}}>
                        <div style={{width:"22px",height:"22px",borderRadius:"50%",border:`2px solid ${checked["sugg_"+s.nome]?"#34C759":"rgba(52,199,89,0.4)"}`,background:checked["sugg_"+s.nome]?"#34C759":"rgba(52,199,89,0.08)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                          {checked["sugg_"+s.nome]?<span style={{color:"#fff",fontSize:"12px"}}>âœ“</span>:<span style={{color:"#34C759",fontSize:"14px"}}>+</span>}
                        </div>
                        <div style={{flex:1}}>
                          <div style={{fontSize:"14px",fontWeight:"500",color:txt}}>{s.nome}</div>
                          <div style={{fontSize:"11px",color:sub,marginTop:"1px"}}>{s.motivo}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              <div style={{display:"flex",gap:"8px"}}>
                <button onClick={()=>{setStep("input");setChecked({});}} style={{flex:1,padding:"13px",borderRadius:"14px",border:`2px solid ${dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)"}`,background:"transparent",color:txt,fontFamily:"inherit",fontSize:"14px",fontWeight:"600",cursor:"pointer"}}>â†º Ricomincia</button>
                <button onClick={close} style={{flex:1,padding:"13px",borderRadius:"14px",border:"none",background:"#34C759",color:"#fff",fontFamily:"inherit",fontSize:"14px",fontWeight:"600",cursor:"pointer"}}>âœ“ Fatto!</button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// â”€â”€ NOTE VOCALI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function VoiceNoteBtn({onNote}){
  const {dark}=React.useContext(ThemeCtx);
  const [recording,setRecording]=useState(false);
  const [supported]=useState(()=>'SpeechRecognition' in window||'webkitSpeechRecognition' in window);
  const recRef=useRef(null);

  const start=()=>{
    if(!supported)return alert("Il riconoscimento vocale non Ã¨ supportato su questo browser.");
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    const rec=new SR();
    rec.lang="it-IT";
    rec.continuous=false;
    rec.interimResults=false;
    rec.onresult=e=>{const text=e.results[0][0].transcript;onNote(text);};
    rec.onend=()=>setRecording(false);
    rec.onerror=()=>setRecording(false);
    recRef.current=rec;
    rec.start();
    setRecording(true);
  };
  const stop=()=>{recRef.current?.stop();setRecording(false);};

  if(!supported)return null;
  return (
    <button onClick={recording?stop:start} style={{background:recording?"#FF3B30":"rgba(60,60,67,0.08)",border:"none",borderRadius:"20px",padding:"7px 14px",cursor:"pointer",fontFamily:"inherit",fontSize:"13px",fontWeight:"600",color:recording?"#fff":dark?"#fff":"#1C1C1E",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"}}>
      {recording?<><span className="pulse">ğŸ”´</span>Stop</>:<><span>ğŸ¤</span>Voce</>}
    </button>
  );
}

// â”€â”€ ALERTS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AlertsPanel({alerts,onClose,onGo}){
  const {dark}=React.useContext(ThemeCtx);
  const [vis,setVis]=useState(false);
  useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
  const close=()=>{setVis(false);setTimeout(onClose,320)};
  const US={urgent:{color:"#FF3B30",label:"URGENTE"},high:{color:"#FF9500",label:"IMPORTANTE"},medium:{color:"#FFCC00",label:"ATTENZIONE"},low:{color:"#007AFF",label:"PROMEMORIA"}};
  return (
    <div onClick={e=>e.target===e.currentTarget&&close()} style={{position:"fixed",inset:0,zIndex:500,background:vis?"rgba(0,0,0,0.4)":"rgba(0,0,0,0)",transition:"background 0.3s",display:"flex",flexDirection:"column",justifyContent:"flex-end"}}>
      <div style={{background:"#1C1C1E",borderRadius:"20px 20px 0 0",maxHeight:"88vh",display:"flex",flexDirection:"column",transform:vis?"translateY(0)":"translateY(100%)",transition:"transform 0.4s cubic-bezier(0.32,0.72,0,1)",paddingBottom:"env(safe-area-inset-bottom,24px)"}}>
        <div style={{display:"flex",justifyContent:"center",padding:"10px 0 0"}}><div style={{width:"36px",height:"4px",background:"rgba(255,255,255,0.15)",borderRadius:"2px"}}/></div>
        <div style={{padding:"16px 20px 14px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
          <div>
            <div style={{fontSize:"22px",fontWeight:"700",color:"#fff",letterSpacing:"-0.5px"}}>Promemoria</div>
            <div style={{fontSize:"13px",color:"rgba(255,255,255,0.35)",marginTop:"2px"}}>{alerts.length} avvisi</div>
          </div>
          <button onClick={close} style={{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"30px",height:"30px",cursor:"pointer",color:"rgba(255,255,255,0.5)",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"center"}}>Ã—</button>
        </div>
        <div style={{overflowY:"auto",flex:1,padding:"0 16px 16px",display:"flex",flexDirection:"column",gap:"8px"}}>
          {alerts.map((a,i)=>{
            const s=US[a.u],[,am,ad]=a.day.split("-");
            const dl=a.d===0?"Oggi":a.d===1?"Domani":`${parseInt(ad)} ${MONTHS_S[parseInt(am)-1]}`;
            return (
              <div key={i} className="tap" onClick={()=>{onGo(a.day);close();}} style={{background:"#2C2C2E",borderRadius:"14px",padding:"14px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:"14px"}}>
                <div style={{width:"40px",height:"40px",borderRadius:"12px",background:s.color+"20",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",flexShrink:0}}>{a.icon}</div>
                <div style={{flex:1,minWidth:0}}>
                  <div style={{display:"flex",gap:"6px",alignItems:"center",marginBottom:"3px"}}>
                    <span style={{fontSize:"10px",fontWeight:"700",color:s.color,letterSpacing:"0.05em"}}>{s.label}</span>
                    <span style={{fontSize:"11px",color:"rgba(255,255,255,0.3)"}}>Â· {dl}</span>
                  </div>
                  <div style={{fontWeight:"600",fontSize:"14px",color:"#fff",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{a.e.title}</div>
                  <div style={{fontSize:"12px",color:"rgba(255,255,255,0.35)",marginTop:"2px"}}>{a.msg}</div>
                </div>
                <span style={{color:"rgba(255,255,255,0.2)",fontSize:"16px"}}>â€º</span>
              </div>
            );
          })}
        </div>
        <div style={{padding:"0 16px"}}><button onClick={close} style={{width:"100%",padding:"15px",borderRadius:"14px",border:"none",background:"#007AFF",color:"#fff",fontFamily:"inherit",fontSize:"16px",fontWeight:"600",cursor:"pointer"}}>OK</button></div>
      </div>
    </div>
  );
}

// â”€â”€ MODAL EVENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Modal({dayKey,onClose,onSave,editEvent}){
  const {dark}=React.useContext(ThemeCtx);
  const [step,setStep]=useState(editEvent?"details":"category");
  const [cat,setCat]=useState(editEvent?.category||null);
  const [materia,setMat]=useState(editEvent?.materia||null);
  const [cMat,setCMat]=useState(editEvent?.customMateria||"");
  const [arg,setArg]=useState(editEvent?.argomento||"");
  const [tipo,setTipo]=useState(editEvent?.tipoVerifica||"");
  const [name,setName]=useState(editEvent?.personName||"");
  const [age,setAge]=useState(editEvent?.personAge||"");
  const [sugg,setSugg]=useState(editEvent?.selectedSugg||null);
  const [ctitle,setCtitle]=useState(editEvent?.customTitle||"");
  const [time,setTime]=useState(editEvent?.time||"");
  const [note,setNote]=useState(editEvent?.note||"");
  const [vis,setVis]=useState(false);
  useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
  const close=()=>{setVis(false);setTimeout(onClose,320)};
  const C=CATS.find(c=>c.id===cat);
  const [,km,kd]=dayKey.split("-");
  const bg=dark?"#1C1C1E":"#F2F2F7";
  const card=dark?"#2C2C2E":"#fff";
  const txt=dark?"#fff":"#1C1C1E";
  const sub=dark?"rgba(255,255,255,0.4)":"rgba(60,60,67,0.45)";
  const steps=cat==="verifica"?["category","materia","argomento","details"]:cat==="compleanno"?["category","compleanno","details"]:["category","suggerimenti","details"];
  const si=steps.indexOf(step);

  const SUGG_MAP={
    commissione:[{label:"Fare la spesa",emoji:"ğŸ›’"},{label:"Farmacia",emoji:"ğŸ’Š"},{label:"Pagare bollette",emoji:"ğŸ’°"},{label:"Posta",emoji:"ğŸ“®"},{label:"Ritirare pacco",emoji:"ğŸ“¦"},{label:"Banca / ATM",emoji:"ğŸ¦"},{label:"Meccanico",emoji:"ğŸ”§"},{label:"Shopping",emoji:"ğŸ›ï¸"},{label:"Veterinario",emoji:"ğŸ¾"},{label:"Referti medici",emoji:"ğŸ“‹"},{label:"Altro",emoji:"âœï¸"}],
    appuntamento:[{label:"Medico",emoji:"ğŸ‘¨â€âš•ï¸"},{label:"Dentista",emoji:"ğŸ¦·"},{label:"Specialista",emoji:"ğŸ¥"},{label:"Fisioterapia",emoji:"ğŸ’†"},{label:"Analisi sangue",emoji:"ğŸ©¸"},{label:"Oculista",emoji:"ğŸ‘ï¸"},{label:"Colloquio scuola",emoji:"ğŸ«"},{label:"Riunione",emoji:"ğŸ’¼"},{label:"Colloquio lavoro",emoji:"ğŸ‘”"},{label:"Parrucchiere",emoji:"âœ‚ï¸"},{label:"Altro",emoji:"âœï¸"}],
    todo:[{label:"Studiare",emoji:"ğŸ“š"},{label:"Fare sport",emoji:"ğŸƒ"},{label:"Chiamare qualcuno",emoji:"ğŸ“"},{label:"Pulire casa",emoji:"ğŸ§¹"},{label:"Lavanderia",emoji:"ğŸ‘•"},{label:"Cucinare",emoji:"ğŸ³"},{label:"Leggere",emoji:"ğŸ“–"},{label:"Organizzare",emoji:"ğŸ—‚ï¸"},{label:"Meditare",emoji:"ğŸ§˜"},{label:"Progetto",emoji:"ğŸ’¡"},{label:"Altro",emoji:"âœï¸"}],
  };

  const buildTitle=()=>{
    if(cat==="verifica"){const m=MATERIE.find(x=>x.id===materia);const ml=materia==="altra"?cMat:m?.label;return arg?`${m?.emoji||"ğŸ“š"} ${tipo||"Verifica"} ${ml} â€” ${arg}`:`${m?.emoji||"ğŸ“š"} ${tipo||"Verifica"} di ${ml}`;}
    if(cat==="compleanno")return `ğŸ‚ Compleanno di ${name}${age?` (${age} anni)`:""}`;
    return sugg==="Altro"?ctitle:(sugg||"");
  };
  const ok=()=>{
    if(step==="argomento")return materia!=="altra"||cMat.trim();
    if(step==="compleanno")return name.trim();
    if(step==="suggerimenti")return sugg&&(sugg!=="Altro"||ctitle.trim());
    return true;
  };
  const save=()=>{const t=buildTitle();if(!t.trim())return;onSave({id:editEvent?.id||Date.now(),category:cat,title:t,time,note,materia,customMateria:cMat,argomento:arg,tipoVerifica:tipo,personName:name,personAge:age,selectedSugg:sugg,customTitle:ctitle});close();};
  const go=s=>setStep(s);

  return (
    <div onClick={e=>e.target===e.currentTarget&&close()} style={{position:"fixed",inset:0,zIndex:400,background:vis?"rgba(0,0,0,0.4)":"rgba(0,0,0,0)",backdropFilter:"blur(8px)",transition:"all 0.3s",display:"flex",flexDirection:"column",justifyContent:"flex-end"}}>
      <div style={{background:bg,borderRadius:"20px 20px 0 0",maxHeight:"92vh",overflowY:"auto",paddingBottom:"env(safe-area-inset-bottom,20px)",transform:vis?"translateY(0)":"translateY(100%)",transition:"transform 0.4s cubic-bezier(0.32,0.72,0,1)"}}>
        <div style={{display:"flex",justifyContent:"center",padding:"10px 0 0"}}><div style={{width:"36px",height:"4px",background:dark?"rgba(255,255,255,0.15)":"rgba(60,60,67,0.15)",borderRadius:"2px"}}/></div>
        <div style={{padding:"14px 20px 10px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
          <div>
            <div style={{fontSize:"12px",color:sub}}>{parseInt(kd)} {MONTHS[parseInt(km)-1]}</div>
            <div style={{fontSize:"20px",fontWeight:"700",color:txt,letterSpacing:"-0.3px",marginTop:"2px"}}>{C?`${C.emoji} ${C.label}`:"Nuovo evento"}</div>
          </div>
          <button onClick={close} style={{background:dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)",border:"none",borderRadius:"50%",width:"30px",height:"30px",cursor:"pointer",color:sub,fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center"}}>Ã—</button>
        </div>
        {cat&&<div style={{display:"flex",gap:"3px",padding:"0 20px 12px"}}>{steps.map((s,i)=><div key={s} style={{height:"3px",flex:1,borderRadius:"2px",background:i<=si?(C?.color||"#007AFF"):dark?"rgba(255,255,255,0.1)":"rgba(60,60,67,0.1)",transition:"background 0.3s"}}/>)}</div>}

        <div style={{padding:"0 16px 20px"}}>
          {step==="category"&&<div style={{animation:"fadeUp 0.2s ease"}}>
            <div style={{fontSize:"13px",color:sub,marginBottom:"10px",paddingLeft:"4px"}}>Seleziona categoria</div>
            {CATS.map(c=>(
              <div key={c.id} className="tap" onClick={()=>{setCat(c.id);c.id==="verifica"?go("materia"):c.id==="compleanno"?go("compleanno"):go("suggerimenti")}} style={{background:card,borderRadius:"14px",padding:"14px 16px",marginBottom:"8px",display:"flex",alignItems:"center",gap:"14px",cursor:"pointer"}}>
                <div style={{width:"44px",height:"44px",borderRadius:"12px",background:c.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px"}}>{c.emoji}</div>
                <div style={{flex:1}}>
                  <div style={{fontWeight:"600",fontSize:"16px",color:txt}}>{c.label}</div>
                  <div style={{fontSize:"12px",color:sub,marginTop:"2px"}}>
                    {c.id==="verifica"&&"Materia + esercizi AI"}{c.id==="compleanno"&&"Nome di chi festeggia"}
                    {c.id==="commissione"&&"Lista spesa AI inclusa"}{c.id==="appuntamento"&&"Medico, dentistaâ€¦"}
                    {c.id==="todo"&&"Cose da non dimenticare"}
                  </div>
                </div>
                <span style={{color:sub,fontSize:"20px"}}>â€º</span>
              </div>
            ))}
          </div>}

          {step==="materia"&&<div style={{animation:"fadeUp 0.18s ease"}}>
            <button onClick={()=>go("category")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}>
              {MATERIE.map(m=>(
                <div key={m.id} className="tap" onClick={()=>{setMat(m.id);go("argomento")}} style={{background:materia===m.id?"#007AFF":card,borderRadius:"12px",padding:"12px 8px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",transition:"all 0.15s"}}>
                  <span style={{fontSize:"22px"}}>{m.emoji}</span>
                  <span style={{fontSize:"11px",textAlign:"center",color:materia===m.id?"#fff":txt,fontWeight:"500",lineHeight:1.2}}>{m.label}</span>
                </div>
              ))}
            </div>
          </div>}

          {step==="argomento"&&<div style={{animation:"fadeUp 0.18s ease"}}>
            <button onClick={()=>go("materia")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
            {materia==="altra"&&<div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><label style={{...LB,color:sub}}>Materia</label><input value={cMat} onChange={e=>setCMat(e.target.value)} placeholder="Es. Dirittoâ€¦" style={{...IP,color:txt}} autoFocus/></div>}
            <div style={{background:card,borderRadius:"14px",padding:"14px 16px",marginBottom:"10px"}}>
              <label style={{...LB,color:sub}}>Tipo di verifica</label>
              <div style={{display:"flex",gap:"6px",flexWrap:"wrap",marginTop:"8px"}}>{TIPI.map(t=><button key={t} onClick={()=>setTipo(tipo===t?"":t)} style={{padding:"7px 14px",borderRadius:"20px",fontFamily:"inherit",border:"none",background:tipo===t?"#FF3B30":dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.08)",color:tipo===t?"#fff":txt,fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"}}>{t}</button>)}</div>
            </div>
            <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"8px"}}>
              <label style={{...LB,color:sub}}>Argomento <span style={{fontWeight:"400",opacity:0.5}}>(opzionale)</span></label>
              <input value={arg} onChange={e=>setArg(e.target.value)} placeholder="Es. Equazioni, Risorgimentoâ€¦" style={{...IP,color:txt}}/>
            </div>
            <div style={{display:"flex",gap:"8px",marginBottom:"16px",alignItems:"center"}}>
              <VoiceNoteBtn onNote={v=>setArg(v)}/>
              <span style={{fontSize:"12px",color:sub}}>Ditta l'argomento</span>
            </div>
            <button onClick={()=>ok()&&go("details")} style={{...BB,background:ok()?"#FF3B30":"rgba(60,60,67,0.1)",color:ok()?"#fff":sub}}>Continua</button>
          </div>}

          {step==="compleanno"&&<div style={{animation:"fadeUp 0.18s ease"}}>
            <button onClick={()=>go("category")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
            <div style={{textAlign:"center",fontSize:"50px",margin:"8px 0 14px"}}>ğŸ‚</div>
            <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><label style={{...LB,color:sub}}>Nome</label><input value={name} onChange={e=>setName(e.target.value)} placeholder="Es. Marcoâ€¦" style={{...IP,color:txt}} autoFocus/></div>
            <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"16px"}}><label style={{...LB,color:sub}}>Quanti anni?</label><input value={age} onChange={e=>setAge(e.target.value)} placeholder="Es. 18â€¦" style={{...IP,color:txt}} type="number"/></div>
            <button onClick={()=>name.trim()&&go("details")} style={{...BB,background:name.trim()?"#FF9500":"rgba(60,60,67,0.1)",color:name.trim()?"#fff":sub}}>Continua</button>
          </div>}

          {step==="suggerimenti"&&<div style={{animation:"fadeUp 0.18s ease"}}>
            <button onClick={()=>go("category")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
            <div style={{fontSize:"13px",color:sub,marginBottom:"10px",paddingLeft:"4px"}}>{cat==="commissione"&&"Cosa devi fare?"}{cat==="appuntamento"&&"Che tipo di appuntamento?"}{cat==="todo"&&"Cosa vuoi ricordarti?"}</div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"10px"}}>
              {SUGG_MAP[cat]?.map(s=>(
                <div key={s.label} className="tap" onClick={()=>setSugg(s.label)} style={{background:sugg===s.label?(C?.color||"#007AFF"):card,borderRadius:"12px",padding:"12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",transition:"all 0.15s"}}>
                  <span style={{fontSize:"20px"}}>{s.emoji}</span>
                  <span style={{fontSize:"13px",fontWeight:"500",color:sugg===s.label?"#fff":txt,lineHeight:1.2}}>{s.label}</span>
                </div>
              ))}
            </div>
            {sugg==="Altro"&&<div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><input value={ctitle} onChange={e=>setCtitle(e.target.value)} placeholder="Scrivi cosa devi fareâ€¦" style={{...IP,color:txt}} autoFocus/></div>}
            <button onClick={()=>ok()&&go("details")} style={{...BB,background:ok()?(C?.color||"#007AFF"):"rgba(60,60,67,0.1)",color:ok()?"#fff":sub}}>Continua</button>
          </div>}

          {step==="details"&&<div style={{animation:"fadeUp 0.18s ease"}}>
            <button onClick={()=>cat==="verifica"?go("argomento"):cat==="compleanno"?go("compleanno"):go("suggerimenti")} style={{...BK,color:"#007AFF"}}>â€¹ Indietro</button>
            <div style={{background:card,borderRadius:"14px",padding:"14px 16px",marginBottom:"10px",borderLeft:`4px solid ${C?.color||"#007AFF"}`}}>
              <div style={{fontSize:"11px",color:sub,fontWeight:"600",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.04em"}}>{C?.label}</div>
              <div style={{fontWeight:"600",fontSize:"15px",color:txt}}>{buildTitle()}</div>
            </div>
            <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"10px"}}><label style={{...LB,color:sub}}>Orario</label><input type="time" value={time} onChange={e=>setTime(e.target.value)} style={{...IP,color:txt}}/></div>
            <div style={{background:card,borderRadius:"14px",padding:"4px 16px",marginBottom:"8px"}}><label style={{...LB,color:sub}}>Note</label><textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Aggiungi dettagliâ€¦" style={{...IP,color:txt,height:"60px",resize:"none",paddingTop:"8px"}}/></div>
            <div style={{display:"flex",gap:"8px",marginBottom:"16px",alignItems:"center"}}>
              <VoiceNoteBtn onNote={v=>setNote(v)}/>
              <span style={{fontSize:"12px",color:sub}}>Ditta le note</span>
            </div>
            <button onClick={save} style={{...BB,background:C?.color||"#007AFF"}}>Salva evento</button>
          </div>}
        </div>
      </div>
    </div>
  );
}

// â”€â”€ DAY SHEET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DaySheet({dayKey,events,onAdd,onEdit,onDel,onClose}){
  const {dark}=React.useContext(ThemeCtx);
  const [vis,setVis]=useState(false);
  const [aiEvent,setAiEvent]=useState(null);
  const [aiType,setAiType]=useState(null);
  const [,km,kd]=dayKey.split("-");
  const isT=dayKey===todayStr;
  const diff=daysBetween(dayKey);
  useEffect(()=>{requestAnimationFrame(()=>setVis(true))},[]);
  const close=()=>{setVis(false);setTimeout(onClose,320)};
  const bg=dark?"#1C1C1E":"#F2F2F7";
  const card=dark?"#2C2C2E":"#fff";
  const txt=dark?"#fff":"#1C1C1E";
  const sub=dark?"rgba(255,255,255,0.4)":"rgba(60,60,67,0.45)";
  return (
    <>
    <div onClick={e=>e.target===e.currentTarget&&close()} style={{position:"fixed",inset:0,zIndex:300,background:vis?"rgba(0,0,0,0.25)":"rgba(0,0,0,0)",transition:"background 0.3s",display:"flex",flexDirection:"column",justifyContent:"flex-end"}}>
      <div style={{background:bg,borderRadius:"20px 20px 0 0",maxHeight:"75vh",display:"flex",flexDirection:"column",transform:vis?"translateY(0)":"translateY(100%)",transition:"transform 0.4s cubic-bezier(0.32,0.72,0,1)",paddingBottom:"env(safe-area-inset-bottom,16px)"}}>
        <div style={{display:"flex",justifyContent:"center",padding:"10px 0 0"}}><div style={{width:"36px",height:"4px",background:dark?"rgba(255,255,255,0.15)":"rgba(60,60,67,0.15)",borderRadius:"2px"}}/></div>
        <div style={{padding:"12px 20px 12px",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:`1px solid ${dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.1)"}`}}>
          <div>
            <div style={{fontSize:"21px",fontWeight:"700",color:txt,letterSpacing:"-0.4px",display:"flex",alignItems:"center",gap:"8px"}}>
              {parseInt(kd)} {MONTHS[parseInt(km)-1]}
              {isT&&<span style={{fontSize:"12px",background:"#FF3B30",color:"#fff",padding:"2px 10px",borderRadius:"10px",fontWeight:"600"}}>oggi</span>}
            </div>
            <div style={{fontSize:"13px",color:sub,marginTop:"2px"}}>{events.length} {events.length===1?"evento":"eventi"}</div>
          </div>
          <button onClick={onAdd} style={{background:"#007AFF",color:"#fff",border:"none",borderRadius:"20px",padding:"8px 18px",fontSize:"14px",fontWeight:"600",cursor:"pointer",fontFamily:"inherit"}}>+ Aggiungi</button>
        </div>
        <div style={{overflowY:"auto",flex:1,padding:"12px 16px"}}>
          {events.length===0?(
            <div style={{textAlign:"center",padding:"32px 0"}}>
              <div style={{fontSize:"38px",marginBottom:"8px"}}>ğŸ“‹</div>
              <div style={{color:sub,fontSize:"15px",fontWeight:"500"}}>Nessun evento</div>
              <div style={{color:dark?"rgba(255,255,255,0.2)":"rgba(60,60,67,0.25)",fontSize:"13px",marginTop:"4px"}}>Tocca + Aggiungi</div>
            </div>
          ):(
            <div style={{background:card,borderRadius:"14px",overflow:"hidden"}}>
              {events.map((ev,i)=>{
                const c=getCat(ev.category);
                const evDiff=daysBetween(dayKey);
                const showAiBtn=ev.category==="verifica"||(ev.category==="commissione"&&ev.title?.includes("spesa"));
                return (
                  <div key={ev.id}>
                    <div style={{padding:"12px 14px",display:"flex",alignItems:"center",gap:"12px",borderBottom:`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`}}>
                      <div style={{width:"10px",height:"10px",borderRadius:"50%",background:c.color,flexShrink:0}}/>
                      <div style={{flex:1,minWidth:0}}>
                        <div style={{fontWeight:"500",fontSize:"15px",color:txt,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                        <div style={{fontSize:"12px",color:sub,marginTop:"2px",display:"flex",alignItems:"center",gap:"6px"}}>
                          <span>{c.label}{ev.time?` Â· ${ev.time}`:""}</span>
                          {ev.category==="verifica"&&evDiff>0&&<span style={{background:"#FF3B30",color:"#fff",borderRadius:"6px",padding:"1px 5px",fontSize:"10px",fontWeight:"700"}}>-{evDiff}g</span>}
                        </div>
                      </div>
                      <button onClick={()=>onEdit(ev)} style={{background:"none",border:"none",cursor:"pointer",color:sub,fontSize:"15px",padding:"4px"}}>âœï¸</button>
                      <button onClick={()=>onDel(ev.id)} style={{background:"none",border:"none",cursor:"pointer",color:dark?"rgba(255,255,255,0.2)":"rgba(60,60,67,0.2)",fontSize:"20px",padding:"4px"}}>Ã—</button>
                    </div>
                    {/* AI buttons */}
                    {showAiBtn&&(
                      <div style={{padding:"8px 14px 10px",display:"flex",gap:"8px",borderBottom:i<events.length-1?`1px solid ${dark?"rgba(255,255,255,0.06)":"rgba(60,60,67,0.06)"}`:"none"}}>
                        {ev.category==="verifica"&&(
                          <button onClick={()=>{setAiEvent(ev);setAiType("esercizi");}} style={{padding:"6px 12px",borderRadius:"12px",border:"none",background:"rgba(255,59,48,0.1)",color:"#FF3B30",fontSize:"12px",fontWeight:"600",cursor:"pointer",fontFamily:"inherit",display:"flex",alignItems:"center",gap:"4px"}}>
                            ğŸ§  Ripasso AI
                          </button>
                        )}
                        {ev.category==="commissione"&&(ev.selectedSugg==="Fare la spesa"||ev.title?.toLowerCase().includes("spesa"))&&(
                          <button onClick={()=>{setAiEvent(ev);setAiType("spesa");}} style={{padding:"6px 12px",borderRadius:"12px",border:"none",background:"rgba(52,199,89,0.1)",color:"#34C759",fontSize:"12px",fontWeight:"600",cursor:"pointer",fontFamily:"inherit",display:"flex",alignItems:"center",gap:"4px"}}>
                            ğŸ›’ Lista spesa AI
                          </button>
                        )}
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    </div>
    {aiEvent&&aiType==="esercizi"&&<EserciziPanel event={aiEvent} onClose={()=>setAiEvent(null)}/>}
    {aiEvent&&aiType==="spesa"&&<ListaSpesaPanel event={aiEvent} onClose={()=>setAiEvent(null)}/>}
    </>
  );
}

// â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App(){
  const [pref,setPref]=useState(loadPref);
  const [year,setYear]=useState(today.getFullYear());
  const [month,setMonth]=useState(today.getMonth());
  const [events,setEvents]=useState(loadEv);
  const [selDay,setSelDay]=useState(null);
  const [showModal,setShowModal]=useState(false);
  const [editEv,setEditEv]=useState(null);
  const [view,setView]=useState("month");
  const [fCat,setFCat]=useState(null);
  const [showAl,setShowAl]=useState(false);
  const meteo=useMeteo();
  const dark=pref.dark;

  const toggleDark=()=>{const np={...pref,dark:!dark};setPref(np);savePref(np);document.body.className=np.dark?"dark":"light";};
  useEffect(()=>{document.body.className=dark?"dark":"light";},[dark]);
  useEffect(()=>{saveEv(events)},[events]);
  useEffect(()=>{const a=getAlerts(events);if(a.length>0)setTimeout(()=>setShowAl(true),700);},[]);

  const alerts=getAlerts(events);
  const getDay=k=>events[k]||[];
  const handleSave=ev=>{setEvents(p=>{const d=p[selDay]||[];if(editEv)return{...p,[selDay]:d.map(e=>e.id===ev.id?ev:e)};return{...p,[selDay]:[...d,ev]};});};
  const delEv=(k,id)=>setEvents(p=>({...p,[k]:(p[k]||[]).filter(e=>e.id!==id)}));

  const bg=dark?"#000":"#fff";
  const bgSub=dark?"#1C1C1E":"#F2F2F7";
  const txt=dark?"#fff":"#1C1C1E";
  const sub=dark?"rgba(255,255,255,0.35)":"rgba(60,60,67,0.45)";
  const border=dark?"rgba(255,255,255,0.08)":"rgba(60,60,67,0.1)";
  const card=dark?"#1C1C1E":"#F2F2F7";

  const totM=Object.entries(events).filter(([k])=>k.startsWith(`${year}-${String(month+1).padStart(2,'0')}`)).flatMap(([,e])=>e).length;
  const allEv=Object.entries(events).flatMap(([day,evs])=>evs.map(e=>({...e,day}))).filter(e=>e.day.startsWith(String(year))).filter(e=>!fCat||e.category===fCat).sort((a,b)=>a.day.localeCompare(b.day));
  const upcoming=Object.entries(events).flatMap(([day,evs])=>evs.map(e=>({...e,day}))).filter(e=>e.day>=todayStr).sort((a,b)=>a.day.localeCompare(b.day)).slice(0,5);
  const wDays=Array.from({length:7},(_,i)=>{const d=new Date(),dow=d.getDay()===0?6:d.getDay()-1,dd=new Date(d);dd.setDate(d.getDate()-dow+i);return dd;});

  return (
    <ThemeCtx.Provider value={{dark,toggle:toggleDark}}>
    <div style={{fontFamily:"-apple-system,'SF Pro Text','Helvetica Neue',sans-serif",background:bg,height:"100vh",maxWidth:"430px",margin:"0 auto",display:"flex",flexDirection:"column",overflow:"hidden",transition:"background 0.3s,color 0.3s"}}>

      {/* HEADER */}
      <div style={{background:dark?"rgba(0,0,0,0.95)":"rgba(255,255,255,0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",paddingTop:"env(safe-area-inset-top,44px)",flexShrink:0,borderBottom:`1px solid ${border}`}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px 6px"}}>
          <div style={{display:"flex",alignItems:"center",gap:"6px"}}>
            <button className="tap" onClick={()=>{const n=addMonths(year,month,-1);setYear(n.year);setMonth(n.month);}} style={{background:"none",border:"none",cursor:"pointer",fontSize:"24px",color:"#007AFF",padding:"2px 6px",lineHeight:1}}>â€¹</button>
            {/* Meteo */}
            {meteo&&<div style={{fontSize:"13px",color:sub,display:"flex",alignItems:"center",gap:"3px"}}><span>{meteo.icon}</span><span>{meteo.temp}Â°</span></div>}
          </div>
          <button onClick={()=>{setYear(today.getFullYear());setMonth(today.getMonth());}} style={{background:"none",border:"none",cursor:"pointer",textAlign:"center",padding:"2px 8px"}}>
            <div style={{fontSize:"17px",fontWeight:"700",color:txt,letterSpacing:"-0.3px",lineHeight:1}}>{MONTHS[month]} {year}</div>
            {totM>0&&<div style={{fontSize:"11px",color:sub,marginTop:"1px"}}>{totM} eventi</div>}
          </button>
          <div style={{display:"flex",alignItems:"center",gap:"2px"}}>
            <button className="tap" onClick={toggleDark} style={{background:"none",border:"none",cursor:"pointer",padding:"2px 6px",fontSize:"18px"}}>{dark?"â˜€ï¸":"ğŸŒ™"}</button>
            <button className="tap" onClick={()=>setShowAl(true)} style={{background:"none",border:"none",cursor:"pointer",padding:"2px 6px",position:"relative"}}>
              <span style={{fontSize:"18px"}}>ğŸ””</span>
              {alerts.length>0&&<div style={{position:"absolute",top:"-2px",right:"2px",minWidth:"15px",height:"15px",background:"#FF3B30",borderRadius:"8px",fontSize:"9px",color:"#fff",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 3px",border:`1.5px solid ${bg}`}}>{alerts.length}</div>}
            </button>
            <button className="tap" onClick={()=>{const n=addMonths(year,month,1);setYear(n.year);setMonth(n.month);}} style={{background:"none",border:"none",cursor:"pointer",fontSize:"24px",color:"#007AFF",padding:"2px 6px",lineHeight:1}}>â€º</button>
          </div>
        </div>
        <div style={{display:"flex",padding:"0 16px"}}>
          {[["month","Calendario"],["list","Lista"]].map(([v,l])=>(
            <button key={v} onClick={()=>setView(v)} style={{flex:1,padding:"6px 0 8px",border:"none",background:"transparent",fontFamily:"inherit",fontSize:"13px",fontWeight:view===v?"600":"400",color:view===v?"#007AFF":sub,cursor:"pointer",borderBottom:view===v?"2px solid #007AFF":"2px solid transparent",transition:"all 0.2s"}}>{l}</button>
          ))}
        </div>
      </div>

      {/* CONTENT */}
      <div style={{flex:1,overflowY:"auto",paddingBottom:"80px"}}>
        {view==="month"&&(
          <div>
            <div style={{padding:"8px 8px 4px"}}>
              <SwipeCalendar year={year} month={month} events={events} alerts={alerts}
                onDay={setSelDay} onMonthChange={(y,m)=>{setYear(y);setMonth(m);}}/>
            </div>

            {upcoming.length>0&&(
              <div style={{padding:"0 12px",marginTop:"8px"}}>
                <div style={{fontSize:"11px",fontWeight:"600",color:sub,letterSpacing:"0.06em",marginBottom:"8px",paddingLeft:"4px"}}>PROSSIMI EVENTI</div>
                <div style={{background:dark?"#1C1C1E":"#F2F2F7",borderRadius:"14px",overflow:"hidden"}}>
                  {upcoming.map((ev,i)=>{
                    const c=getCat(ev.category),d=daysBetween(ev.day),[,em,ed]=ev.day.split("-");
                    return (
                      <div key={`${ev.day}-${ev.id}`} className="tap" onClick={()=>setSelDay(ev.day)} style={{padding:"10px 14px",display:"flex",alignItems:"center",gap:"12px",cursor:"pointer",borderBottom:i<upcoming.length-1?`1px solid ${border}`:"none",background:dark?"#2C2C2E":"#fff"}}>
                        <div style={{width:"32px",height:"32px",borderRadius:"8px",background:c.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                          <div style={{fontSize:"13px",fontWeight:"700",color:c.color,lineHeight:1}}>{parseInt(ed)}</div>
                          <div style={{fontSize:"8px",color:c.color,fontWeight:"500"}}>{MONTHS_S[parseInt(em)-1]}</div>
                        </div>
                        <div style={{flex:1,minWidth:0}}>
                          <div style={{fontWeight:"500",fontSize:"14px",color:txt,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                          <div style={{fontSize:"11px",color:sub,marginTop:"1px",display:"flex",alignItems:"center",gap:"5px"}}>
                            {d===0?<span style={{color:c.color,fontWeight:"600"}}>Oggi</span>:d===1?<span style={{color:"#FF9500",fontWeight:"600"}}>Domani</span>:<span>{c.label}</span>}
                            {ev.time&&` Â· ${ev.time}`}
                            {ev.category==="verifica"&&d>0&&d<=15&&<span style={{background:"#FF3B30",color:"#fff",borderRadius:"5px",padding:"1px 5px",fontSize:"10px",fontWeight:"700"}}>-{d}g</span>}
                          </div>
                        </div>
                        <span style={{color:sub,fontSize:"14px"}}>â€º</span>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            <div style={{margin:"10px 12px 0",background:dark?"#1C1C1E":"#F2F2F7",borderRadius:"14px",padding:"12px 14px"}}>
              <div style={{fontSize:"10px",fontWeight:"600",color:sub,letterSpacing:"0.06em",marginBottom:"8px"}}>CATEGORIE</div>
              <div style={{display:"flex",flexWrap:"wrap",gap:"6px 18px"}}>
                {CATS.map(c=><div key={c.id} style={{display:"flex",alignItems:"center",gap:"5px"}}><div style={{width:"7px",height:"7px",borderRadius:"50%",background:c.color}}/><span style={{fontSize:"12px",color:sub}}>{c.label}</span></div>)}
              </div>
            </div>
          </div>
        )}

        {view==="list"&&(
          <div style={{padding:"12px"}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"}}>
              <button className="tap" onClick={()=>setYear(y=>y-1)} style={{background:"none",border:"none",fontSize:"22px",color:"#007AFF",cursor:"pointer",padding:"4px 10px"}}>â€¹</button>
              <span style={{fontSize:"17px",fontWeight:"700",color:txt}}>{year}</span>
              <button className="tap" onClick={()=>setYear(y=>y+1)} style={{background:"none",border:"none",fontSize:"22px",color:"#007AFF",cursor:"pointer",padding:"4px 10px"}}>â€º</button>
            </div>
            <div style={{display:"flex",gap:"6px",overflowX:"auto",paddingBottom:"4px",marginBottom:"12px"}}>
              <button onClick={()=>setFCat(null)} style={{padding:"5px 14px",borderRadius:"20px",border:"none",flexShrink:0,background:!fCat?"#007AFF":dark?"#2C2C2E":"#F2F2F7",color:!fCat?"#fff":sub,fontSize:"13px",fontWeight:"500",cursor:"pointer",fontFamily:"inherit"}}>Tutti</button>
              {CATS.map(c=><button key={c.id} onClick={()=>setFCat(fCat===c.id?null:c.id)} style={{padding:"5px 12px",borderRadius:"20px",border:"none",flexShrink:0,background:fCat===c.id?c.color:dark?"#2C2C2E":"#F2F2F7",color:fCat===c.id?"#fff":c.color,fontSize:"13px",fontWeight:"500",cursor:"pointer",fontFamily:"inherit"}}>{c.emoji} {c.label}</button>)}
            </div>
            {allEv.length===0?(
              <div style={{textAlign:"center",padding:"50px 0"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>ğŸ“‹</div><div style={{color:sub,fontSize:"15px"}}>Nessun evento</div></div>
            ):(
              <div style={{background:dark?"#1C1C1E":"#fff",borderRadius:"14px",overflow:"hidden"}}>
                {allEv.map((ev,i)=>{
                  const c=getCat(ev.category),[,em,ed]=ev.day.split("-"),d=daysBetween(ev.day);
                  return (
                    <div key={`${ev.day}-${ev.id}`} style={{padding:"11px 14px",display:"flex",alignItems:"center",gap:"12px",borderBottom:i<allEv.length-1?`1px solid ${border}`:"none"}}>
                      <div style={{width:"32px",height:"32px",borderRadius:"8px",background:c.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                        <div style={{fontSize:"13px",fontWeight:"700",color:c.color,lineHeight:1}}>{parseInt(ed)}</div>
                        <div style={{fontSize:"8px",color:c.color,fontWeight:"500"}}>{MONTHS_S[parseInt(em)-1]}</div>
                      </div>
                      <div style={{flex:1,minWidth:0}}>
                        <div style={{fontWeight:"500",fontSize:"14px",color:txt,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ev.title}</div>
                        <div style={{fontSize:"11px",color:sub,marginTop:"1px",display:"flex",alignItems:"center",gap:"5px"}}>
                          <span>{c.label}{ev.time?` Â· ${ev.time}`:""}</span>
                          {ev.category==="verifica"&&d>0&&d<=15&&<span style={{background:"#FF3B30",color:"#fff",borderRadius:"5px",padding:"1px 5px",fontSize:"10px",fontWeight:"700"}}>-{d}g</span>}
                        </div>
                      </div>
                      <button onClick={()=>delEv(ev.day,ev.id)} style={{background:"none",border:"none",cursor:"pointer",color:sub,fontSize:"20px",padding:"4px"}}>Ã—</button>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        )}
      </div>

      {/* BOTTOM WEEK */}
      <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:"430px",background:dark?"rgba(0,0,0,0.95)":"rgba(255,255,255,0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:`1px solid ${border}`,padding:"6px 10px env(safe-area-inset-bottom,16px)",zIndex:150}}>
        <div style={{display:"flex",justifyContent:"space-between"}}>
          {wDays.map((d,i)=>{
            const key=fmt(d.getFullYear(),d.getMonth(),d.getDate()),evs=getDay(key),isT=key===todayStr,hasAl=alerts.some(a=>a.day===key);
            return (
              <div key={i} className="tap" onClick={()=>setSelDay(key)} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"3px 1px",cursor:"pointer",position:"relative"}}>
                {hasAl&&!isT&&<div style={{position:"absolute",top:"0",right:"4px",width:"5px",height:"5px",borderRadius:"50%",background:"#FF3B30"}}/>}
                <div style={{fontSize:"10px",fontWeight:"500",color:isT?"#FF3B30":sub,marginBottom:"3px"}}>{DAYS[i]}</div>
                <div style={{width:"30px",height:"30px",borderRadius:"50%",background:isT?"#FF3B30":"transparent",display:"flex",alignItems:"center",justifyContent:"center"}}>
                  <div style={{fontSize:"15px",fontWeight:isT?"700":"400",color:isT?"#fff":i>=5?"#FF9500":txt}}>{d.getDate()}</div>
                </div>
                <div style={{width:"4px",height:"4px",borderRadius:"50%",marginTop:"2px",background:evs.length>0?(isT?"rgba(255,255,255,0.8)":getCat(evs[0].category).color):"transparent"}}/>
              </div>
            );
          })}
        </div>
      </div>

      {showAl&&<AlertsPanel alerts={alerts} onClose={()=>setShowAl(false)} onGo={day=>{setSelDay(day);setMonth(parseInt(day.split("-")[1])-1);setYear(parseInt(day.split("-")[0]));setView("month");}}/>}
      {selDay&&!showModal&&!showAl&&<DaySheet dayKey={selDay} events={getDay(selDay)} onAdd={()=>{setEditEv(null);setShowModal(true)}} onEdit={ev=>{setEditEv(ev);setShowModal(true)}} onDel={id=>delEv(selDay,id)} onClose={()=>setSelDay(null)}/>}
      {showModal&&selDay&&<Modal dayKey={selDay} onClose={()=>setShowModal(false)} onSave={handleSave} editEvent={editEv}/>}
    </div>
    </ThemeCtx.Provider>
  );
}

const BK={background:"none",border:"none",cursor:"pointer",fontFamily:"inherit",fontSize:"15px",padding:"0 0 14px 0",display:"block"};
const LB={display:"block",fontSize:"11px",fontWeight:"600",padding:"10px 0 0",textTransform:"uppercase",letterSpacing:"0.05em"};
const IP={width:"100%",padding:"8px 0 12px",border:"none",fontSize:"16px",fontFamily:"inherit",outline:"none",background:"transparent",display:"block"};
const BB={width:"100%",padding:"15px",borderRadius:"14px",border:"none",fontFamily:"inherit",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.15s",color:"#fff"};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
