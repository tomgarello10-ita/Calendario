<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="apple-mobile-web-app-title" content="Calendario"/>
<title>Calendario</title>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",sans-serif;
  background:#f2f2f7;
  -webkit-tap-highlight-color:transparent;
}
.app{
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
.header{
  padding-top:env(safe-area-inset-top);
  background:white;
  border-bottom:1px solid #e5e5ea;
}
.header-inner{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
}
.month-title{
  font-weight:600;
  font-size:20px;
}
.nav-btn{
  font-size:26px;
  background:none;
  border:none;
  color:#007aff;
}
.calendar{
  padding:16px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.day{
  background:white;
  border-radius:14px;
  text-align:center;
  padding:16px 0;
  font-size:16px;
  position:relative;
  user-select:none;
}
.day.selected{
  background:#007aff;
  color:white;
}
.dot{
  width:6px;
  height:6px;
  background:#ff3b30;
  border-radius:50%;
  position:absolute;
  bottom:6px;
  left:50%;
  transform:translateX(-50%);
}
.event-list{
  background:white;
  margin:16px;
  border-radius:20px;
  padding:20px;
}
.event-item{
  padding:12px 0;
  border-bottom:1px solid #e5e5ea;
}
.event-item:last-child{
  border:none;
}
.add-btn{
  position:fixed;
  bottom:30px;
  right:25px;
  background:#007aff;
  color:white;
  border:none;
  border-radius:50%;
  width:64px;
  height:64px;
  font-size:34px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  display:flex;
  align-items:flex-end;
}
.sheet{
  background:white;
  width:100%;
  border-radius:30px 30px 0 0;
  padding:24px;
  max-height:85vh;
  overflow:auto;
}
.category{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:18px;
  background:#f2f2f7;
  border-radius:18px;
  margin-bottom:14px;
  font-size:18px;
}
.back{
  color:#007aff;
  margin-bottom:16px;
  font-size:18px;
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

const {useState,useRef}=React;

const MONTHS=[
"Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno",
"Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"
];

function getDays(year,month){
  const first=new Date(year,month,1).getDay();
  const total=new Date(year,month+1,0).getDate();
  let arr=[];
  for(let i=0;i<first;i++) arr.push(null);
  for(let i=1;i<=total;i++) arr.push(i);
  return arr;
}function App(){

const today=new Date();
const [year,setYear]=useState(today.getFullYear());
const [month,setMonth]=useState(today.getMonth());
const [selectedDay,setSelectedDay]=useState(today.getDate());
const [events,setEvents]=useState(JSON.parse(localStorage.getItem("events")||"{}"));

const [showModal,setShowModal]=useState(false);
const [step,setStep]=useState("main");
const [selectedCategory,setSelectedCategory]=useState(null);

const touchStart=useRef(null);
const isSwiping=useRef(false);

const days=getDays(year,month);
const key=`${year}-${month}-${selectedDay}`;
const dayEvents=events[key]||[];

function saveEvents(newEvents){
  setEvents(newEvents);
  localStorage.setItem("events",JSON.stringify(newEvents));
}

function addEvent(text){
  const updated={...events};
  if(!updated[key]) updated[key]=[];
  updated[key].push(text);
  saveEvents(updated);
  setShowModal(false);
  setStep("main");
}

function changeMonth(dir){
  let newMonth=month+dir;
  let newYear=year;
  if(newMonth<0){ newMonth=11; newYear--; }
  if(newMonth>11){ newMonth=0; newYear++; }
  setMonth(newMonth);
  setYear(newYear);
}

function handleTouchStart(e){
  touchStart.current=e.touches[0].clientX;
  isSwiping.current=false;
}

function handleTouchMove(e){
  if(!touchStart.current) return;
  const diff=e.touches[0].clientX-touchStart.current;
  if(Math.abs(diff)>15){
    isSwiping.current=true;
  }
}

function handleTouchEnd(e){
  if(!touchStart.current) return;
  const diff=e.changedTouches[0].clientX-touchStart.current;
  if(Math.abs(diff)>70){
    if(diff>0) changeMonth(-1);
    else changeMonth(1);
  }
  touchStart.current=null;
  setTimeout(()=>{isSwiping.current=false},100);
}

return(
<div className="app">

<div className="header">
  <div className="header-inner">
    <button className="nav-btn" onClick={()=>changeMonth(-1)}>‚Äπ</button>
    <div className="month-title">
      {MONTHS[month]} {year}
    </div>
    <button className="nav-btn" onClick={()=>changeMonth(1)}>‚Ä∫</button>
  </div>
</div>

<div className="calendar"
onTouchStart={handleTouchStart}
onTouchMove={handleTouchMove}
onTouchEnd={handleTouchEnd}
>
  <div className="grid">
    {days.map((d,i)=>(
      <div
        key={i}
        className={`day ${d===selectedDay?"selected":""}`}
        onClick={()=>{ if(!isSwiping.current && d) setSelectedDay(d)}}
      >
        {d}
        {events[`${year}-${month}-${d}`] && <div className="dot"></div>}
      </div>
    ))}
  </div>
</div>

<div className="event-list">
  <h3>Eventi del {selectedDay} {MONTHS[month]}</h3>
  {dayEvents.length===0 && <div>Nessun evento</div>}
  {dayEvents.map((ev,i)=>(
    <div key={i} className="event-item">{ev}</div>
  ))}
</div>

<button className="add-btn" onClick={()=>setShowModal(true)}>+</button>

{showModal && (
<div className="modal" onClick={()=>setShowModal(false)}>
<div className="sheet" onClick={e=>e.stopPropagation()}>

{step==="main" && (
<>
<div className="category" onClick={()=>{setStep("verifica");setSelectedCategory("Verifica")}}>üìò Verifica</div>
<div className="category" onClick={()=>addEvent("üéÇ Compleanno")}>üéÇ Compleanno</div>
<div className="category" onClick={()=>addEvent("üõí Commissione")}>üõí Commissione</div>
<div className="category" onClick={()=>addEvent("üè• Appuntamento")}>üè• Appuntamento</div>
<div className="category" onClick={()=>addEvent("‚úÖ Da fare")}>‚úÖ Da fare</div>
</>
)}

{step==="verifica" && (
<>
<div className="back" onClick={()=>setStep("main")}>‚Äπ Indietro</div>
{["Matematica","Italiano","Storia","Scienze","Inglese","Fisica","Chimica","Geografia","Arte","Musica","Filosofia","Informatica","Ed. Fisica","Latino","Altra"].map(m=>(
<div key={m} className="category" onClick={()=>addEvent(`üìò Verifica di ${m}`)}>
{m}
</div>
))}
</>
)}

</div>
</div>
)}

</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
